<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolos y Formatos en Sistemas Distribuidos</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>◉</text></svg>">
    <link rel="stylesheet" href="presentacion.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: false, theme: 'dark', securityLevel: 'loose',
            themeVariables: {
                darkMode: true, primaryColor: '#E9AB21', primaryTextColor: '#ffffff',
                primaryBorderColor: '#ffffff', lineColor: '#ffffff', secondaryColor: '#23356E',
                tertiaryColor: '#910048', background: '#0f1419', mainBkg: '#0f1419', secondBkg: '#1a1f2e'
            },
            flowchart: { useMaxWidth: true, htmlLabels: false, curve: 'basis' }
        });
    </script>

    <!-- Prism.js para Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-protobuf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-xml-doc.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
</head>

<body>
    <div class="uide-logo">
        <img src="../../Logo%20UIDE.png" alt="UIDE Logo">
    </div>
    <div class="presentation-container">
        <!-- Slide 1: Title -->
        <div class="slide active title-slide">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h3 style="color: #e2e8f0; font-size: 1.3rem; font-weight: 700; margin-bottom: 1rem;">
                    Presentación Semana 3
                </h3>
                <h2 style="color: var(--uide-accent); font-size: 2.2rem; font-weight: 600; margin-bottom: 0.5rem;">
                    Protocolos y Formatos en Sistemas Distribuidos
                </h2>
                <p style="color: #ffffff; font-size: 1.4rem; font-weight: 500;">
                    LTI_05A_458 PMSBD • Cuarto Nivel
                </p>
                <p style="color: #e2e8f0; font-size: 1.2rem; margin-top: 0.5rem;">
                    Programación Middleware y Sistemas Basados en Datos
                </p>
            </div>
            <div style="text-align: center; margin: 2rem 0;">
                <p style="color: #ffffff; font-size: 1.3rem; font-weight: 600;">
                    Prof. Charlie Cárdenas Toledo, M.Sc.
                </p>
                <p style="color: var(--uide-primary); font-size: 1.2rem; font-weight: 500; margin-top: 0.5rem;">
                    Octubre 2025 – Febrero 2026
                </p>
            </div>
            <div
                style="text-align: center; margin-top: 2.5rem; padding: 25px; background: rgba(15, 20, 25, 0.6); border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.1);">
                <h3 style="color: var(--uide-accent); font-size: 1.4rem; margin-bottom: 1rem;">
                    <i class="fas fa-network-wired"></i> Comunicación de Alto Rendimiento y Serialización
                </h3>
                <p style="color: #e2e8f0; font-size: 1.1rem; line-height: 1.4; margin: 0.5rem 0;">
                    <strong>Semana 3</strong> • HTTP/2 • WebSockets • gRPC • JSON • Protobuf • MessagePack • XML
                </p>
                <p style="color: #cbd5e1; font-size: 1rem; margin-top: 1rem; font-style: italic;">
                    Dominar protocolos modernos y formatos de serialización para sistemas distribuidos eficientes
                </p>
            </div>
        </div>

        <!-- Slide 2: Objetivos -->
        <div class="slide">
            <h2><i class="fas fa-bullseye"></i> Objetivos de la Presentación</h2>
            <ul>
                <li>Dominar <span class="highlight">protocolos de comunicación de alto rendimiento</span> (HTTP/2,
                    WebSockets, gRPC)</li>
                <li>Analizar <span class="highlight">formatos de serialización</span> modernos (JSON, Protobuf,
                    MessagePack)</li>
                <li>Comprender el <span class="highlight">rol básico y empresarial de XML</span></li>
                <li>Evaluar <span class="highlight">ventajas y limitaciones</span> de cada tecnología</li>
                <li>Aplicar criterios de <span class="highlight">selección tecnológica</span> según contexto</li>
            </ul>
        </div>

        <!-- Slide 3: Agenda -->
        <div class="slide">
            <h2><i class="fas fa-list-check"></i> Agenda</h2>
            <div class="content-grid">
                <div class="feature-card">
                    <h3><i class="fas fa-bolt"></i> 1. HTTP/2</h3>
                    <p>Protocolo moderno de transporte</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-plug"></i> 2. WebSockets</h3>
                    <p>Conexión persistente bidireccional</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-rocket"></i> 3. gRPC</h3>
                    <p>RPC moderno de alto rendimiento</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-file-code"></i> 4. Serialización</h3>
                    <p>JSON, Protobuf, MessagePack</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-code"></i> 5. XML</h3>
                    <p>Rol básico y empresarial</p>
                </div>
            </div>
        </div>

        <!-- Slide DEMO: Ejemplo de Bloques de Código -->
        <div class="slide">
            <h2><i class="fas fa-code"></i> Ejemplo: Sistema de Código Integrado</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; height: calc(100vh - 200px);">
                <!-- Bloque de código simple -->
                <div>
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--uide-accent);">
                        <i class="fas fa-terminal"></i> Bloque de Código Simple
                    </h3>

                    <div class="code-container">
                        <div class="code-header">
                            <div class="code-title">
                                <i class="fas fa-file-code"></i>
                                Cliente WebSocket
                            </div>
                            <span class="code-language">JavaScript</span>
                        </div>
                        <div class="code-content">
                            <pre class="line-numbers"><code class="language-javascript">// Cliente WebSocket básico
const ws = new WebSocket('ws://localhost:8080');

ws.onopen = () => {
  console.log('Conectado al servidor');
  ws.send('Hola desde el Banco de Loja');
};

ws.onmessage = (event) => {
  console.log('Mensaje recibido:', event.data);
};

ws.onerror = (error) => {
  console.error('Error WebSocket:', error);
};

ws.onclose = () => {
  console.log('Conexión cerrada');
};</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Sistema de tabs -->
                <div>
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--uide-accent);">
                        <i class="fas fa-layer-group"></i> Tabs Multi-Código
                    </h3>

                    <div class="code-tabs-container">
                        <div class="code-tabs-header">
                            <button class="code-tab-btn active" data-tab="cliente">
                                <i class="fas fa-desktop"></i> Cliente
                            </button>
                            <button class="code-tab-btn" data-tab="servidor">
                                <i class="fas fa-server"></i> Servidor
                            </button>
                            <button class="code-tab-btn" data-tab="proto">
                                <i class="fas fa-file-contract"></i> .proto
                            </button>
                        </div>

                        <!-- Tab Cliente -->
                        <div class="code-tab-content active" data-tab="cliente">
                            <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                <div class="code-header">
                                    <div class="code-title">
                                        <i class="fas fa-desktop"></i> cliente.js
                                    </div>
                                    <span class="code-language">Node.js</span>
                                </div>
                                <div class="code-content">
                                    <pre class="line-numbers"><code class="language-javascript">const WebSocket = require('ws');

const cliente = new WebSocket('ws://localhost:8080');

cliente.on('open', () => {
  console.log('✓ Conectado');
  cliente.send(JSON.stringify({
    tipo: 'transferencia',
    monto: 1500.00,
    destino: 'CTA-001'
  }));
});

cliente.on('message', (data) => {
  const respuesta = JSON.parse(data);
  console.log('Respuesta:', respuesta);
});</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Servidor -->
                        <div class="code-tab-content" data-tab="servidor">
                            <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                <div class="code-header">
                                    <div class="code-title">
                                        <i class="fas fa-server"></i> servidor.js
                                    </div>
                                    <span class="code-language">Node.js</span>
                                </div>
                                <div class="code-content">
                                    <pre class="line-numbers"><code class="language-javascript">const WebSocket = require('ws');

const wss = new WebSocket.Server({ port: 8080 });

wss.on('connection', (ws) => {
  console.log('Cliente conectado');

  ws.on('message', (mensaje) => {
    const datos = JSON.parse(mensaje);
    console.log('Recibido:', datos);

    // Procesar transferencia
    ws.send(JSON.stringify({
      estado: 'exitoso',
      id: 'TRX-' + Date.now(),
      monto: datos.monto
    }));
  });
});</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Proto -->
                        <div class="code-tab-content" data-tab="proto">
                            <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                <div class="code-header">
                                    <div class="code-title">
                                        <i class="fas fa-file-contract"></i> banco.proto
                                    </div>
                                    <span class="code-language">Protocol Buffers</span>
                                </div>
                                <div class="code-content">
                                    <pre class="line-numbers"><code class="language-protobuf">syntax = "proto3";

package banco;

service BancoService {
  rpc Transferir(TransferenciaRequest)
    returns (TransferenciaResponse);
}

message TransferenciaRequest {
  string cuenta_origen = 1;
  string cuenta_destino = 2;
  double monto = 3;
  string concepto = 4;
}

message TransferenciaResponse {
  bool exitoso = 1;
  string transaccion_id = 2;
  double saldo_disponible = 3;
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: rgba(233, 171, 33, 0.1); border-radius: 8px;">
                <p style="color: var(--uide-accent); font-size: 0.9rem;">
                    <i class="fas fa-lightbulb"></i>
                    <strong>Sistema modular</strong>: Cada slide puede incluir código real con syntax highlighting,
                    tabs interactivos y botones para copiar
                </p>
            </div>
        </div>

        <!-- Slide 4: HTTP/2 -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-globe"></i> HTTP/2: Protocolo de Transporte Moderno</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Características -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "La app móvil del Banco de Loja carga 8 recursos simultáneamente"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Características</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Binario</strong>: Más eficiente</li>
                            <li><strong>Multiplexación</strong>: Streams paralelos</li>
                            <li><strong>HPACK</strong>: Compresión headers</li>
                            <li><strong>Server push</strong>: Envío proactivo</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Base para gRPC y app móvil
                        </p>
                    </div>

                    <!-- Pestañas de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="http2-tab active" data-demo="multiplex"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Multiplexación
                        </button>
                        <button class="http2-tab" data-demo="hpack"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            HPACK
                        </button>
                        <button class="http2-tab" data-demo="push"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Server Push
                        </button>
                        <button class="http2-tab" data-demo="diagrama"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Diagrama
                        </button>
                        <button class="http2-tab" data-demo="http2-codigo"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Código
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startHttp2Demo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                        <div id="http2Controls" style="margin-top: 6px; font-size: 0.75rem;">
                            <label style="color: #e2e8f0;">Requests: </label>
                            <input type="number" id="http2Requests" value="6" min="3" max="10"
                                style="width: 50px; padding: 3px; background: rgba(255,255,255,0.1); border: 1px solid var(--uide-accent); color: white; border-radius: 4px; font-size: 0.75rem;">
                        </div>
                    </div>
                </div>

                <!-- Columna Derecha: Visualización Comparativa -->
                <div id="http2DemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Multiplexación -->
                    <div id="demoMultiplex" class="http2-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <!-- HTTP/1.1 -->
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; min-height: 0; max-height: 45%;">
                            <h3
                                style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem; flex-shrink: 0;">
                                <i class="fas fa-times-circle"></i> HTTP/1.1 - Conexiones Secuenciales
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; position: relative; overflow: hidden; min-height: 0; height: 200px;">
                                <canvas id="http1Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="http1Time"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171; flex-shrink: 0;">
                                Tiempo: -</div>
                        </div>

                        <!-- HTTP/2 -->
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; min-height: 0; max-height: 45%;">
                            <h3
                                style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem; flex-shrink: 0;">
                                <i class="fas fa-check-circle"></i> HTTP/2 - Multiplexación (Streams Paralelos)
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; position: relative; overflow: hidden; min-height: 0; height: 200px;">
                                <canvas id="http2Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="http2Time"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80; flex-shrink: 0;">
                                Tiempo: -</div>
                        </div>

                        <!-- Comparación de mejora -->
                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="http2Improvement"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Comparación de rendimiento HTTP/1.1 vs HTTP/2
                            </div>
                        </div>
                    </div>

                    <!-- Demo HPACK -->
                    <div id="demoHpack" class="http2-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-times-circle"></i> HTTP/1.1 - Headers Sin Comprimir
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="hpackHttp1Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="hpackHttp1Size"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Tamaño: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-check-circle"></i> HTTP/2 - Headers Comprimidos (HPACK)
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="hpackHttp2Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="hpackHttp2Size"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Tamaño: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px;">
                            <div id="hpackImprovement"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Compresión de headers con algoritmo HPACK
                            </div>
                        </div>
                    </div>

                    <!-- Demo Server Push -->
                    <div id="demoPush" class="http2-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-times-circle"></i> HTTP/1.1 - Request/Response Tradicional
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; position: relative; overflow: hidden; height: 200px;">
                                <canvas id="pushHttp1Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="pushHttp1Time"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Tiempo: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-check-circle"></i> HTTP/2 - Server Push Proactivo
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; position: relative; overflow: hidden; height: 200px;">
                                <canvas id="pushHttp2Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="pushHttp2Time"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Tiempo: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px;">
                            <div id="pushImprovement"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Envío proactivo de recursos sin solicitud previa
                            </div>
                        </div>
                    </div>

                    <!-- Demo Diagrama HTTP/2 -->
                    <div id="demoDiagrama" class="http2-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%; overflow-y: auto;">
                        <div style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; padding: 16px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: var(--uide-accent); margin: 0 0 12px 0; font-size: 0.9rem;">
                                <i class="fas fa-sitemap"></i> Arquitectura HTTP/2 - Multiplexing
                            </h3>
                            <div class="mermaid" style="background: white; border-radius: 8px; padding: 16px; flex: 1; display: flex; align-items: center; justify-content: center;">
sequenceDiagram
    participant Cliente as Cliente<br/>(App Banco de Loja)
    participant Conn as Conexión TCP<br/>Única
    participant Server as Servidor HTTP/2

    Note over Cliente,Server: Conexión TLS establecida

    rect rgb(233, 171, 33, 0.1)
        Note over Cliente,Server: Multiplexing - Streams Paralelos

        par Stream 1: Saldo
            Cliente->>+Server: GET /api/saldo<br/>Stream ID: 1
            Server-->>-Cliente: 200 OK {balance: 5000}<br/>Stream ID: 1
        and Stream 3: Transacciones
            Cliente->>+Server: GET /api/transactions<br/>Stream ID: 3
            Server-->>-Cliente: 200 OK [...]<br/>Stream ID: 3
        and Stream 5: Perfil
            Cliente->>+Server: GET /api/profile<br/>Stream ID: 5
            Server-->>-Cliente: 200 OK {name: "..."}<br/>Stream ID: 5
        end
    end

    rect rgb(100, 200, 100, 0.1)
        Note over Server,Cliente: Server Push - Proactivo
        Server->>Cliente: PUSH /static/logo.png<br/>Stream ID: 2
        Server->>Cliente: PUSH /static/styles.css<br/>Stream ID: 4
    end

    rect rgb(100, 150, 255, 0.1)
        Note over Cliente,Server: HPACK - Compresión de Headers
        Note left of Cliente: Header Table<br/>:method: GET<br/>:scheme: https<br/>authorization: ...
        Note right of Server: Header Table<br/>(mismo contenido)
        Cliente->>Server: Solo índices de tabla<br/>(ahorro 70-80%)
    end
            </div>
        </div>
                    </div>

                    <!-- Demo Código HTTP/2 -->
                    <div id="demoHttp2-codigo" class="http2-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%; overflow-y: auto;">

                        <!-- Tabs de código -->
                        <div class="code-tabs-container" style="margin: 0;">
                            <div class="code-tabs-header">
                                <button class="code-tab-btn active" data-tab="http2-server">
                                    <i class="fas fa-server"></i> Servidor
                                </button>
                                <button class="code-tab-btn" data-tab="http2-client">
                                    <i class="fas fa-desktop"></i> Cliente
                                </button>
                                <button class="code-tab-btn" data-tab="http2-push">
                                    <i class="fas fa-rocket"></i> Server Push
                                </button>
                            </div>

                            <!-- Tab Servidor HTTP/2 -->
                            <div class="code-tab-content active" data-tab="http2-server">
                                <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-server"></i> servidor-http2.js
                                        </div>
                                        <span class="code-language">Node.js ES2025</span>
                                    </div>
                                    <div class="code-content" style="max-height: 450px;">
                                        <pre class="line-numbers"><code class="language-javascript">// Servidor HTTP/2 del Banco de Loja - ES2025
import http2 from 'http2';
import fs from 'fs/promises';
import { createReadStream } from 'fs';
import path from 'path';

class ServidorHTTP2 {
  #server = null;
  #config = {
    port: 8443,
    keyPath: './certs/server.key',
    certPath: './certs/server.crt'
  };

  constructor(config = {}) {
    this.#config = { ...this.#config, ...config };
  }

  async iniciar() {
    // Leer certificados SSL para HTTP/2
    const [key, cert] = await Promise.all([
      fs.readFile(this.#config.keyPath),
      fs.readFile(this.#config.certPath)
    ]);

    // Crear servidor HTTP/2 seguro
    this.#server = http2.createSecureServer({
      key,
      cert,
      allowHTTP1: false // Solo HTTP/2
    });

    this.#server.on('stream', this.#handleStream.bind(this));
    this.#server.on('error', this.#handleError.bind(this));

    return new Promise((resolve) => {
      this.#server.listen(this.#config.port, () => {
        console.log(`Servidor HTTP/2 en puerto ${this.#config.port}`);
        resolve();
      });
    });
  }

  #handleStream(stream, headers) {
    const path = headers[':path'];
    const method = headers[':method'];

    console.log(`${method} ${path}`);

    // Enrutamiento simple
    const routes = {
      '/': () => this.#servirHTML(stream),
      '/api/cuenta': () => this.#servirJSON(stream),
      '/api/transferencias': () => this.#servirTransferencias(stream)
    };

    const handler = routes[path] ?? (() => this.#error404(stream));
    handler();
  }

  async #servirHTML(stream) {
    stream.respond({
      ':status': 200,
      'content-type': 'text/html; charset=utf-8'
    });

    stream.end(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Banco de Loja - HTTP/2</title>
          <link rel="stylesheet" href="/css/styles.css">
          <script src="/js/app.js"></script>
        </head>
        <body>
          <h1>Bienvenido al Banco de Loja</h1>
          <p>Conexión segura HTTP/2</p>
        </body>
      </html>
    `);
  }

  #servirJSON(stream) {
    stream.respond({
      ':status': 200,
      'content-type': 'application/json'
    });

    stream.end(JSON.stringify({
      cuenta: 'CTA-00123456',
      titular: 'Juan Pérez',
      saldo: 5000.00,
      tipo: 'Ahorros'
    }));
  }

  async #servirTransferencias(stream) {
    // Simulación de consulta a base de datos
    const transferencias = [
      { id: 1, monto: 500, fecha: '2025-01-10', tipo: 'DEBITO' },
      { id: 2, monto: 1500, fecha: '2025-01-09', tipo: 'CREDITO' }
    ];

    stream.respond({
      ':status': 200,
      'content-type': 'application/json'
    });

    stream.end(JSON.stringify(transferencias));
  }

  #error404(stream) {
    stream.respond({ ':status': 404 });
    stream.end('No encontrado');
  }

  #handleError(error) {
    console.error('Error en servidor:', error);
  }

  async detener() {
    return new Promise((resolve) => {
      this.#server?.close(() => {
        console.log('Servidor HTTP/2 detenido');
        resolve();
      });
    });
  }
}

// Uso
const servidor = new ServidorHTTP2();
await servidor.iniciar();</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Cliente HTTP/2 -->
                            <div class="code-tab-content" data-tab="http2-client">
                                <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-desktop"></i> cliente-http2.js
                                        </div>
                                        <span class="code-language">Node.js ES2025</span>
                                    </div>
                                    <div class="code-content" style="max-height: 450px;">
                                        <pre class="line-numbers"><code class="language-javascript">// Cliente HTTP/2 del Banco de Loja - ES2025
import http2 from 'http2';

class ClienteHTTP2 {
  #client = null;
  #config = {
    serverUrl: 'https://localhost:8443'
  };

  constructor(config = {}) {
    this.#config = { ...this.#config, ...config };
  }

  conectar() {
    this.#client = http2.connect(this.#config.serverUrl, {
      rejectUnauthorized: false // Solo para desarrollo
    });

    this.#client.on('error', (error) => {
      console.error('Error de conexión:', error);
    });
  }

  // Realizar múltiples requests simultáneos (Multiplexación)
  async requestsMultiples(rutas) {
    console.log('Iniciando requests múltiples en paralelo...');

    const promises = rutas.map((ruta) => this.#request(ruta));

    const inicio = Date.now();
    const resultados = await Promise.all(promises);
    const duracion = Date.now() - inicio;

    console.log(`Completados ${rutas.length} requests en ${duracion}ms`);

    return resultados;
  }

  #request(path) {
    return new Promise((resolve, reject) => {
      const req = this.#client.request({
        ':path': path,
        ':method': 'GET'
      });

      let data = '';

      req.on('response', (headers) => {
        console.log(`Respuesta de ${path}: ${headers[':status']}`);
      });

      req.on('data', (chunk) => {
        data += chunk;
      });

      req.on('end', () => {
        resolve({
          path,
          data: data.toString()
        });
      });

      req.on('error', reject);
      req.end();
    });
  }

  desconectar() {
    this.#client?.close();
  }
}

// Uso: Multiplexación HTTP/2
const cliente = new ClienteHTTP2();
cliente.conectar();

// Realizar 6 requests simultáneos (Multiplexación)
const rutas = [
  '/api/cuenta',
  '/api/transferencias',
  '/api/movimientos',
  '/api/saldo',
  '/api/beneficiarios',
  '/api/notificaciones'
];

const resultados = await cliente.requestsMultiples(rutas);
console.log('Resultados:', resultados);

cliente.desconectar();</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Server Push -->
                            <div class="code-tab-content" data-tab="http2-push">
                                <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-rocket"></i> server-push.js
                                        </div>
                                        <span class="code-language">Node.js ES2025</span>
                                    </div>
                                    <div class="code-content" style="max-height: 450px;">
                                        <pre class="line-numbers"><code class="language-javascript">// Server Push HTTP/2 - ES2025
import http2 from 'http2';
import fs from 'fs/promises';

class ServidorConPush {
  #server = null;

  async iniciar() {
    const [key, cert] = await Promise.all([
      fs.readFile('./certs/server.key'),
      fs.readFile('./certs/server.crt')
    ]);

    this.#server = http2.createSecureServer({ key, cert });

    this.#server.on('stream', (stream, headers) => {
      const path = headers[':path'];

      if (path === '/') {
        this.#servirConPush(stream);
      }
    });

    this.#server.listen(8443);
  }

  #servirConPush(stream) {
    // Server Push: Enviar recursos antes de que el cliente los pida

    // 1. Push de CSS
    stream.pushStream({
      ':path': '/css/styles.css'
    }, (err, pushStream) => {
      if (err) return;

      pushStream.respond({
        ':status': 200,
        'content-type': 'text/css'
      });

      pushStream.end(`
        body {
          font-family: Arial, sans-serif;
          background: #0f1419;
          color: white;
        }
      `);
    });

    // 2. Push de JavaScript
    stream.pushStream({
      ':path': '/js/app.js'
    }, (err, pushStream) => {
      if (err) return;

      pushStream.respond({
        ':status': 200,
        'content-type': 'application/javascript'
      });

      pushStream.end(`
        console.log('App cargada desde Server Push');

        // Inicializar app del Banco de Loja
        document.addEventListener('DOMContentLoaded', () => {
          console.log('DOM Ready - HTTP/2 Server Push activo');
        });
      `);
    });

    // 3. Push de datos JSON
    stream.pushStream({
      ':path': '/api/cuenta'
    }, (err, pushStream) => {
      if (err) return;

      pushStream.respond({
        ':status': 200,
        'content-type': 'application/json'
      });

      pushStream.end(JSON.stringify({
        cuenta: 'CTA-00123456',
        saldo: 5000.00,
        nombre: 'Juan Pérez'
      }));
    });

    // Enviar HTML principal
    stream.respond({
      ':status': 200,
      'content-type': 'text/html'
    });

    stream.end(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Banco de Loja</title>
          <link rel="stylesheet" href="/css/styles.css">
          <script src="/js/app.js"></script>
        </head>
        <body>
          <h1>Server Push Activo</h1>
          <p>Los recursos fueron enviados proactivamente</p>
        </body>
      </html>
    `);

    console.log('HTML enviado con 3 recursos en Server Push');
  }
}

// Uso
const servidor = new ServidorConPush();
await servidor.iniciar();
console.log('Servidor con Server Push en puerto 8443');</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; margin-top: 8px;">
                            <p style="color: var(--uide-accent); font-size: 0.8rem; margin: 0;">
                                <i class="fas fa-bolt"></i>
                                <strong>HTTP/2</strong> permite multiplexación (múltiples streams en una conexión),
                                compresión HPACK de headers y Server Push proactivo de recursos.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== FUNCIÓN HELPER PARA CANVAS DE ALTA RESOLUCIÓN =====
            function setupHighDPICanvas(canvas, width, height) {
                const dpr = window.devicePixelRatio || 1;

                // Configurar dimensiones físicas del canvas (con DPR)
                canvas.width = width * dpr;
                canvas.height = height * dpr;

                // Configurar dimensiones CSS (visuales)
                canvas.style.width = width + 'px';
                canvas.style.height = height + 'px';

                // Obtener contexto y escalar
                const ctx = canvas.getContext('2d');
                ctx.scale(dpr, dpr);

                // Agregar propiedades lógicas para compatibilidad con código existente
                canvas.logicalWidth = width;
                canvas.logicalHeight = height;

                return ctx;
            }

            // Función para obtener dimensiones del contenedor
            function getCanvasDimensions(canvas, padding = 16) {
                const container = canvas.parentElement;
                const rect = container.getBoundingClientRect();
                return {
                    width: rect.width - padding,
                    height: Math.max(rect.height - padding, 150) // Mínimo 150px
                };
            }

            // ===== HTTP/2 SIMULACIONES VISUALES CON CASOS DE USO REALES =====
            let currentHttp2Demo = 'multiplex';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos
                const tabs = document.querySelectorAll('.http2-tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchHttp2Demo(demoType);
                    });
                });

                // Botón iniciar demo
                const startHttp2Demo = document.getElementById('startHttp2Demo');
                if (startHttp2Demo) {
                    startHttp2Demo.addEventListener('click', function () {
                        const requests = parseInt(document.getElementById('http2Requests').value) || 6;

                        if (currentHttp2Demo === 'multiplex') {
                            runHttp2Comparison(requests);
                        } else if (currentHttp2Demo === 'hpack') {
                            runHpackDemo(requests);
                        } else if (currentHttp2Demo === 'push') {
                            runServerPushDemo();
                        }
                    });
                }
            });

            function switchHttp2Demo(demoType) {
                currentHttp2Demo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.http2-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.http2-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }

                // Mostrar/ocultar controles según demo
                const controlsDiv = document.getElementById('http2Controls');
                if (demoType === 'push') {
                    controlsDiv.style.display = 'none';
                } else {
                    controlsDiv.style.display = 'block';
                }
            }

            // ===== DEMO 1: MULTIPLEXACIÓN - Dashboard Banco de Loja =====
            function runHttp2Comparison(numRequests) {
                const resources = [
                    { name: 'Saldo cuenta', icon: '$', size: '15KB', color: '#60a5fa' },
                    { name: 'Transacciones', icon: '▊', size: '25KB', color: '#f472b6' },
                    { name: 'Tarjetas', icon: '▭', size: '12KB', color: '#fbbf24' },
                    { name: 'Notificaciones', icon: '◉', size: '8KB', color: '#4ade80' },
                    { name: 'Inversiones', icon: '▲', size: '18KB', color: '#a78bfa' },
                    { name: 'Sucursales', icon: '■', size: '22KB', color: '#fb923c' },
                    { name: 'Créditos', icon: '≡', size: '16KB', color: '#ec4899' },
                    { name: 'Promociones', icon: '◎', size: '14KB', color: '#14b8a6' },
                    { name: 'Perfil usuario', icon: '▯', size: '10KB', color: '#f59e0b' },
                    { name: 'Seguridad', icon: '⊠', size: '9KB', color: '#8b5cf6' }
                ];

                const selectedResources = resources.slice(0, numRequests);
                simulateHttp1Visual(selectedResources);
                setTimeout(() => simulateHttp2Visual(selectedResources), 100);
            }

            function simulateHttp1Visual(resources) {
                const canvas = document.getElementById('http1Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const resourceHeight = 35;
                const gap = 8;
                const clientX = 30;
                const serverX = width - 80;
                const pipeWidth = serverX - clientX - 60;

                let currentResource = 0;
                let totalTime = 0;

                // Dibujar cliente y servidor
                function drawEndpoints() {
                    // Cliente
                    ctx.fillStyle = '#60a5fa';
                    ctx.fillRect(clientX - 15, 10, 30, height - 20);
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('CLIENT', clientX, height / 2);

                    // Servidor
                    ctx.fillStyle = '#f87171';
                    ctx.fillRect(serverX - 15, 10, 30, height - 20);
                    ctx.fillStyle = '#ffffff';
                    ctx.fillText('SERVER', serverX, height / 2);
                }

                drawEndpoints();

                const interval = setInterval(() => {
                    if (currentResource >= resources.length) {
                        clearInterval(interval);
                        document.getElementById('http1Time').innerHTML = `<i class="fas fa-stopwatch"></i> Tiempo Total: ${totalTime}ms | <i class="fas fa-circle" style="color: #f87171;"></i> Bloqueante`;
                        return;
                    }

                    const resource = resources[currentResource];
                    const y = 30 + currentResource * (resourceHeight + gap);

                    // Animación de request y response
                    let progress = 0;
                    const animInterval = setInterval(() => {
                        progress += 4;
                        if (progress > 200) {
                            clearInterval(animInterval);
                            currentResource++;
                            return;
                        }

                        ctx.clearRect(clientX + 20, y - 5, pipeWidth + 40, resourceHeight + 10);

                        // Request (cliente → servidor)
                        if (progress <= 100) {
                            const reqProgress = (pipeWidth * progress) / 100;
                            ctx.fillStyle = resource.color;
                            ctx.globalAlpha = 0.7;
                            ctx.fillRect(clientX + 20, y + 5, reqProgress, 10);

                            // Paquete animado
                            ctx.globalAlpha = 1;
                            ctx.fillStyle = resource.color;
                            ctx.fillRect(clientX + 20 + reqProgress - 15, y, 15, 20);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText(resource.icon, clientX + 20 + reqProgress - 7, y + 14);
                        }

                        // Response (servidor → cliente)
                        if (progress > 100) {
                            const respProgress = (pipeWidth * (progress - 100)) / 100;
                            ctx.fillStyle = resource.color;
                            ctx.globalAlpha = 0.7;
                            ctx.fillRect(serverX - 40 - respProgress, y + 20, respProgress, 10);

                            // Paquete animado
                            ctx.globalAlpha = 1;
                            ctx.fillStyle = resource.color;
                            ctx.fillRect(serverX - 40 - respProgress, y + 15, 15, 20);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText(resource.icon, serverX - 40 - respProgress + 7, y + 29);
                        }

                        // Etiqueta del recurso
                        ctx.globalAlpha = 1;
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '9px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(resource.name, clientX + 25, y - 8);
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(resource.size, clientX + 120, y - 8);

                        totalTime += 10;
                        document.getElementById('http1Time').innerHTML = `<i class="fas fa-stopwatch"></i> Tiempo: ${Math.round(totalTime)}ms | <i class="fas fa-circle" style="color: #f87171;"></i> Bloqueante`;
                    }, 25);
                }, 500);
            }

            function simulateHttp2Visual(resources) {
                const canvas = document.getElementById('http2Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const resourceHeight = 35;
                const gap = 8;
                const clientX = 30;
                const serverX = width - 80;
                const pipeWidth = serverX - clientX - 60;

                // Dibujar cliente y servidor
                ctx.fillStyle = '#22c55e';
                ctx.fillRect(clientX - 15, 10, 30, height - 20);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('CLIENT', clientX, height / 2);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(serverX - 15, 10, 30, height - 20);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('SERVER', serverX, height / 2);

                // Dibujar conexión única
                ctx.strokeStyle = '#22c55e';
                ctx.lineWidth = 3;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(clientX + 20, height / 2);
                ctx.lineTo(serverX - 20, height / 2);
                ctx.stroke();
                ctx.setLineDash([]);

                // Todos los recursos en paralelo
                const progresses = resources.map(() => ({ req: 0, resp: 0 }));
                let maxTime = 0;

                const interval = setInterval(() => {
                    let allComplete = true;

                    resources.forEach((resource, i) => {
                        const y = 30 + i * (resourceHeight + gap);

                        if (progresses[i].req < 100) {
                            allComplete = false;
                            progresses[i].req += 4;
                        } else if (progresses[i].resp < 100) {
                            allComplete = false;
                            progresses[i].resp += 4;
                        }

                        ctx.clearRect(clientX + 20, y - 10, pipeWidth + 40, resourceHeight + 15);

                        // Request
                        if (progresses[i].req <= 100) {
                            const reqProgress = (pipeWidth * progresses[i].req) / 100;
                            ctx.fillStyle = resource.color;
                            ctx.globalAlpha = 0.5;
                            ctx.fillRect(clientX + 20, y + 5, reqProgress, 8);

                            if (progresses[i].req < 100) {
                                ctx.globalAlpha = 1;
                                ctx.fillStyle = resource.color;
                                ctx.fillRect(clientX + 20 + reqProgress - 12, y, 12, 18);
                                ctx.fillStyle = '#ffffff';
                                ctx.font = '10px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText(resource.icon, clientX + 20 + reqProgress - 6, y + 12);
                            }
                        }

                        // Response
                        if (progresses[i].req >= 100 && progresses[i].resp <= 100) {
                            const respProgress = (pipeWidth * progresses[i].resp) / 100;
                            ctx.fillStyle = resource.color;
                            ctx.globalAlpha = 0.5;
                            ctx.fillRect(serverX - 40 - respProgress, y + 18, respProgress, 8);

                            if (progresses[i].resp < 100) {
                                ctx.globalAlpha = 1;
                                ctx.fillStyle = resource.color;
                                ctx.fillRect(serverX - 40 - respProgress, y + 13, 12, 18);
                                ctx.fillStyle = '#ffffff';
                                ctx.font = '10px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText(resource.icon, serverX - 40 - respProgress + 6, y + 25);
                            }
                        }

                        // Etiqueta
                        ctx.globalAlpha = 1;
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '9px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(resource.name, clientX + 25, y - 8);
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(resource.size, clientX + 120, y - 8);

                        // Stream ID
                        ctx.fillStyle = '#fbbf24';
                        ctx.font = 'bold 8px Arial';
                        ctx.fillText(`#${i + 1}`, clientX + 180, y - 8);
                    });

                    maxTime += 25;
                    document.getElementById('http2Time').innerHTML = `<i class="fas fa-stopwatch"></i> Tiempo: ${maxTime}ms | <i class="fas fa-circle" style="color: #4ade80;"></i> Paralelo`;

                    if (allComplete) {
                        clearInterval(interval);
                        const http1Total = resources.length * 500;
                        const improvement = ((http1Total - maxTime) / http1Total * 100).toFixed(1);
                        document.getElementById('http2Improvement').innerHTML =
                            `<i class="fas fa-rocket"></i> HTTP/2 carga la página <strong>${improvement}% más rápido</strong> con multiplexación en una sola conexión`;
                    }
                }, 25);
            }

            // ===== DEMO 2: HPACK - Visualización de Paquetes de Red =====
            function runHpackDemo(numRequests) {
                const headers = [
                    { key: ':method', value: 'GET', size: 10 },
                    { key: ':scheme', value: 'https', size: 12 },
                    { key: ':path', value: '/api/accounts/balance', size: 28 },
                    { key: ':authority', value: 'api.bancodeloja.fin.ec', size: 28 },
                    { key: 'user-agent', value: 'BancoLoja-App/2.1.0', size: 25 },
                    { key: 'accept', value: 'application/json', size: 22 },
                    { key: 'accept-encoding', value: 'gzip, deflate, br', size: 25 },
                    { key: 'accept-language', value: 'es-EC,es;q=0.9', size: 22 },
                    { key: 'cache-control', value: 'no-cache', size: 18 },
                    { key: 'authorization', value: 'Bearer JWT_TOKEN...', size: 45 }
                ];

                animateHttp1Headers(headers, numRequests);
                setTimeout(() => animateHttp2Headers(headers, numRequests), 100);
            }

            function animateHttp1Headers(headers, numRequests) {
                const canvas = document.getElementById('hpackHttp1Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                let totalSize = 0;
                let currentReq = 0;

                const interval = setInterval(() => {
                    if (currentReq >= numRequests) {
                        clearInterval(interval);
                        document.getElementById('hpackHttp1Size').innerHTML =
                            `<i class="fas fa-box"></i> Total: ${totalSize} bytes | <i class="fas fa-circle" style="color: #f87171;"></i> Sin compresion`;
                        return;
                    }

                    const y = 15 + currentReq * 55;
                    const headerSize = headers.reduce((sum, h) => sum + h.size, 0);
                    totalSize += headerSize;

                    // Paquete
                    const packetWidth = Math.min((width - 100) * (headerSize / 300), width - 100);

                    ctx.fillStyle = 'rgba(248, 113, 113, 0.2)';
                    ctx.fillRect(80, y, packetWidth, 45);
                    ctx.strokeStyle = '#f87171';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(80, y, packetWidth, 45);

                    // Etiqueta
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`Request ${currentReq + 1}`, 10, y + 12);

                    // Headers dentro del paquete
                    ctx.font = '8px monospace';
                    ctx.fillStyle = '#e2e8f0';
                    headers.slice(0, 5).forEach((h, i) => {
                        ctx.fillText(`${h.key}: ${h.value}`, 85, y + 15 + i * 8);
                    });
                    if (headers.length > 5) {
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(`... +${headers.length - 5} más`, 85, y + 55);
                    }

                    // Tamaño
                    ctx.fillStyle = '#f87171';
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${headerSize}B`, width - 10, y + 25);

                    document.getElementById('hpackHttp1Size').innerHTML =
                        `<i class="fas fa-box"></i> Acumulado: ${totalSize} bytes | <i class="fas fa-circle" style="color: #f87171;"></i> Sin compresión`;

                    currentReq++;
                }, 400);
            }

            function animateHttp2Headers(headers, numRequests) {
                const canvas = document.getElementById('hpackHttp2Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // Tabla de índices HPACK
                ctx.fillStyle = 'rgba(74, 222, 128, 0.1)';
                ctx.fillRect(10, 10, width - 20, 50);
                ctx.strokeStyle = '#4ade80';
                ctx.lineWidth = 1;
                ctx.strokeRect(10, 10, width - 20, 50);

                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 9px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('▤ HPACK Static Table', 15, 22);

                ctx.font = '7px monospace';
                ctx.fillStyle = '#94a3b8';
                ctx.fillText('[1]:method GET  [2]:scheme https  [3]:path /  [4]:authority', 15, 35);
                ctx.fillText('[15]:accept-encoding gzip  [16]:accept-language  [17]:cache-control', 15, 45);
                ctx.fillText('[32]:authorization  [33]:user-agent  ...', 15, 55);

                let totalSize = 0;
                let currentReq = 0;

                const interval = setInterval(() => {
                    if (currentReq >= numRequests) {
                        clearInterval(interval);
                        const http1Total = headers.reduce((sum, h) => sum + h.size, 0) * numRequests;
                        const reduction = ((http1Total - totalSize) / http1Total * 100).toFixed(1);
                        document.getElementById('hpackHttp2Size').innerHTML =
                            `<i class="fas fa-box"></i> Total: ${totalSize} bytes | <i class="fas fa-circle" style="color: #4ade80;"></i> Comprimido`;
                        document.getElementById('hpackImprovement').innerHTML =
                            `<i class="fas fa-compress-arrows-alt"></i> HPACK ahorra <strong>${http1Total - totalSize} bytes (${reduction}%)</strong> usando tabla de índices`;
                        return;
                    }

                    const y = 75 + currentReq * 55;

                    // Primera request: headers completos
                    // Siguientes: solo índices
                    const isFirst = currentReq === 0;
                    const headerSize = isFirst ?
                        headers.reduce((sum, h) => sum + h.size, 0) :
                        Math.floor(headers.length * 2.5); // ~2.5 bytes por índice

                    totalSize += headerSize;

                    const packetWidth = Math.min((width - 100) * (headerSize / 300), width - 100);

                    // Paquete
                    ctx.fillStyle = isFirst ? 'rgba(74, 222, 128, 0.2)' : 'rgba(34, 197, 94, 0.2)';
                    ctx.fillRect(80, y, packetWidth, 45);
                    ctx.strokeStyle = isFirst ? '#4ade80' : '#22c55e';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(80, y, packetWidth, 45);

                    // Etiqueta
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`Request ${currentReq + 1}`, 10, y + 12);

                    // Contenido
                    ctx.font = '8px monospace';
                    if (isFirst) {
                        ctx.fillStyle = '#e2e8f0';
                        headers.slice(0, 4).forEach((h, i) => {
                            ctx.fillText(`${h.key}: ${h.value}`, 85, y + 15 + i * 8);
                        });
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(`... +${headers.length - 4} más`, 85, y + 47);
                    } else {
                        ctx.fillStyle = '#fbbf24';
                        ctx.fillText('# Índices: [1][2][3:12345][4]', 85, y + 20);
                        ctx.fillText('[33][15][16][17][32:Bearer...]', 85, y + 30);
                        ctx.fillStyle = '#22c55e';
                        ctx.font = 'bold 8px Arial';
                        ctx.fillText('√ Referencia a tabla', 85, y + 42);
                    }

                    // Tamaño
                    ctx.fillStyle = isFirst ? '#4ade80' : '#22c55e';
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${headerSize}B`, width - 10, y + 25);

                    if (!isFirst) {
                        ctx.fillStyle = '#fbbf24';
                        ctx.font = '8px Arial';
                        ctx.fillText('↓ 90%', width - 10, y + 38);
                    }

                    document.getElementById('hpackHttp2Size').innerHTML =
                        `<i class="fas fa-box"></i> Acumulado: ${totalSize} bytes | <i class="fas fa-circle" style="color: #4ade80;"></i> Comprimido`;

                    currentReq++;
                }, 400);
            }

            // ===== DEMO 3: SERVER PUSH - E-commerce Product Page =====
            function runServerPushDemo() {
                const resources = [
                    { name: 'dashboard.html', icon: '▭', desc: 'Dashboard bancario', time: 50 },
                    { name: 'banking.css', icon: '◨', desc: 'Estilos', time: 40 },
                    { name: 'app.js', icon: '⚡', desc: 'Lógica app', time: 60 },
                    { name: 'promociones.json', icon: '◎', desc: 'Ofertas activas', time: 30 },
                    { name: 'tasas.json', icon: '▊', desc: 'Tasas de interés', time: 25 }
                ];

                animateHttp1Push(resources);
                setTimeout(() => animateHttp2Push(resources), 100);
            }

            function animateHttp1Push(resources) {
                const canvas = document.getElementById('pushHttp1Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 40;
                const serverX = width - 60;
                const centerX = width / 2;

                // Dibujar endpoints
                ctx.fillStyle = '#f87171';
                ctx.fillRect(clientX - 20, 20, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('▯', clientX, 38);
                ctx.fillText('Browser', clientX, 52);

                ctx.fillStyle = '#f87171';
                ctx.fillRect(serverX - 20, 20, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('◉', serverX, 38);
                ctx.fillText('Server', serverX, 52);

                let http1Time = 0;
                let currentResource = 0;

                const http1Interval = setInterval(() => {
                    if (currentResource >= resources.length) {
                        clearInterval(http1Interval);
                        document.getElementById('pushHttp1Time').textContent =
                            `⏱️ Total: ${http1Time}ms | 🔴 ${resources.length} round-trips`;
                        return;
                    }

                    const resource = resources[currentResource];
                    const y = 80 + currentResource * 70;

                    // Request (cliente → servidor)
                    let requestProgress = 0;
                    const requestInterval = setInterval(() => {
                        requestProgress += 8;
                        if (requestProgress > 100) {
                            clearInterval(requestInterval);

                            // Response (servidor → cliente)
                            setTimeout(() => {
                                let responseProgress = 0;
                                const responseInterval = setInterval(() => {
                                    responseProgress += 8;
                                    if (responseProgress > 100) {
                                        clearInterval(responseInterval);
                                        currentResource++;
                                        return;
                                    }

                                    ctx.clearRect(0, y - 15, width, 70);

                                    // Título del recurso
                                    ctx.fillStyle = '#ffffff';
                                    ctx.font = 'bold 11px Arial';
                                    ctx.textAlign = 'left';
                                    ctx.fillText(`${resource.icon} ${resource.name}`, 10, y - 5);
                                    ctx.font = '9px Arial';
                                    ctx.fillStyle = '#94a3b8';
                                    ctx.fillText(resource.desc, 10, y + 8);

                                    // Request arrow (completo)
                                    ctx.fillStyle = '#60a5fa';
                                    ctx.fillRect(clientX + 25, y + 15, centerX - clientX - 35, 6);
                                    ctx.beginPath();
                                    ctx.moveTo(centerX - 10, y + 18);
                                    ctx.lineTo(centerX, y + 13);
                                    ctx.lineTo(centerX, y + 23);
                                    ctx.fill();

                                    ctx.fillStyle = '#60a5fa';
                                    ctx.font = '8px Arial';
                                    ctx.textAlign = 'center';
                                    ctx.fillText('REQUEST', centerX - 50, y + 12);

                                    // Response arrow (animado)
                                    const respWidth = ((centerX - clientX - 35) * responseProgress) / 100;
                                    ctx.fillStyle = '#4ade80';
                                    ctx.fillRect(serverX - 25 - respWidth, y + 30, respWidth, 6);
                                    ctx.beginPath();
                                    ctx.moveTo(serverX - 25 - respWidth, y + 33);
                                    ctx.lineTo(serverX - 25 - respWidth - 10, y + 28);
                                    ctx.lineTo(serverX - 25 - respWidth - 10, y + 38);
                                    ctx.fill();

                                    ctx.fillStyle = '#4ade80';
                                    ctx.font = '8px Arial';
                                    ctx.textAlign = 'center';
                                    ctx.fillText('RESPONSE', centerX + 50, y + 42);

                                    // Tiempo
                                    ctx.fillStyle = '#fbbf24';
                                    ctx.font = 'bold 9px Arial';
                                    ctx.textAlign = 'right';
                                    ctx.fillText(`+${resource.time}ms`, width - 10, y + 25);

                                    http1Time += 5;
                                    document.getElementById('pushHttp1Time').textContent =
                                        `⏱️ Tiempo: ${http1Time}ms | 🔴 Esperando...`;
                                }, 20);
                            }, 50);
                            return;
                        }

                        ctx.clearRect(0, y - 15, width, 70);

                        // Título
                        ctx.fillStyle = '#ffffff';
                        ctx.font = 'bold 11px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(`${resource.icon} ${resource.name}`, 10, y - 5);
                        ctx.font = '9px Arial';
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(resource.desc, 10, y + 8);

                        // Request arrow (animado)
                        const reqWidth = ((centerX - clientX - 35) * requestProgress) / 100;
                        ctx.fillStyle = '#60a5fa';
                        ctx.fillRect(clientX + 25, y + 15, reqWidth, 6);
                        ctx.beginPath();
                        ctx.moveTo(clientX + 25 + reqWidth, y + 18);
                        ctx.lineTo(clientX + 25 + reqWidth + 10, y + 13);
                        ctx.lineTo(clientX + 25 + reqWidth + 10, y + 23);
                        ctx.fill();

                        ctx.fillStyle = '#60a5fa';
                        ctx.font = '8px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('REQUEST', centerX - 50, y + 12);

                        http1Time += 5;
                        document.getElementById('pushHttp1Time').textContent =
                            `⏱️ Tiempo: ${http1Time}ms | 🔴 Solicitando...`;
                    }, 20);
                }, 200);
            }

            function animateHttp2Push(resources) {
                const canvas = document.getElementById('pushHttp2Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 40;
                const serverX = width - 60;
                const centerX = width / 2;

                // Dibujar endpoints
                ctx.fillStyle = '#4ade80';
                ctx.fillRect(clientX - 20, 20, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('▯', clientX, 38);
                ctx.fillText('Browser', clientX, 52);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(serverX - 20, 20, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('◉', serverX, 38);
                ctx.fillText('Server', serverX, 52);

                let http2Time = 0;

                // Request inicial solo para el HTML
                const firstResource = resources[0];
                const y0 = 80;

                let initialProgress = 0;
                const initialInterval = setInterval(() => {
                    initialProgress += 8;
                    if (initialProgress > 100) {
                        clearInterval(initialInterval);

                        // Server Push de todos los demás recursos simultáneamente
                        const pushResources = resources.slice(1);
                        const pushProgresses = pushResources.map(() => 0);

                        const pushInterval = setInterval(() => {
                            let allComplete = true;

                            pushProgresses.forEach((prog, i) => {
                                if (prog < 100) {
                                    allComplete = false;
                                    pushProgresses[i] += 8;
                                }
                            });

                            ctx.clearRect(0, 150, width, height - 150);

                            pushResources.forEach((resource, i) => {
                                const y = 160 + i * 60;

                                // Título
                                ctx.fillStyle = '#fbbf24';
                                ctx.font = 'bold 10px Arial';
                                ctx.textAlign = 'left';
                                ctx.fillText('▲ PUSH', 10, y - 5);

                                ctx.fillStyle = '#ffffff';
                                ctx.font = 'bold 11px Arial';
                                ctx.fillText(`${resource.icon} ${resource.name}`, 60, y - 5);
                                ctx.font = '9px Arial';
                                ctx.fillStyle = '#94a3b8';
                                ctx.fillText(resource.desc, 60, y + 8);

                                // Push arrow (servidor → cliente, sin request previo)
                                const pushWidth = ((centerX - clientX - 35) * pushProgresses[i]) / 100;
                                ctx.fillStyle = '#22c55e';
                                ctx.fillRect(serverX - 25 - pushWidth, y + 15, pushWidth, 8);
                                ctx.beginPath();
                                ctx.moveTo(serverX - 25 - pushWidth, y + 19);
                                ctx.lineTo(serverX - 25 - pushWidth - 10, y + 13);
                                ctx.lineTo(serverX - 25 - pushWidth - 10, y + 25);
                                ctx.fill();

                                ctx.fillStyle = '#22c55e';
                                ctx.font = 'bold 8px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText('PUSH (sin request)', centerX, y + 12);

                                // Checkmark cuando completa
                                if (pushProgresses[i] >= 100) {
                                    ctx.fillStyle = '#22c55e';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('√', clientX - 30, y + 22);
                                }
                            });

                            http2Time += 5;
                            document.getElementById('pushHttp2Time').innerHTML =
                                `<i class="fas fa-stopwatch"></i> Tiempo: ${http2Time}ms | <i class="fas fa-circle" style="color: #4ade80;"></i> Push proactivo`;

                            if (allComplete) {
                                clearInterval(pushInterval);

                                // Calcular mejora
                                const http1Total = resources.reduce((sum, r) => sum + r.time, 0) + (resources.length * 50);
                                const savedTime = http1Total - http2Time;
                                const improvement = ((savedTime / http1Total) * 100).toFixed(1);

                                document.getElementById('pushHttp2Time').textContent =
                                    `⏱️ Total: ${http2Time}ms | 🟢 1 round-trip`;
                                document.getElementById('pushImprovement').innerHTML =
                                    `<i class="fas fa-rocket"></i> Server Push ahorra <strong>${savedTime}ms (${improvement}%)</strong> enviando recursos proactivamente`;
                            }
                        }, 20);
                        return;
                    }

                    ctx.clearRect(0, y0 - 15, canvas.width, 70);

                    // Título
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`${firstResource.icon} ${firstResource.name}`, 10, y0 - 5);
                    ctx.font = '9px Arial';
                    ctx.fillStyle = '#94a3b8';
                    ctx.fillText(firstResource.desc, 10, y0 + 8);

                    // Request arrow
                    const reqWidth = ((centerX - clientX - 35) * initialProgress) / 100;
                    ctx.fillStyle = '#60a5fa';
                    ctx.fillRect(clientX + 25, y0 + 15, reqWidth, 6);
                    ctx.beginPath();
                    ctx.moveTo(clientX + 25 + reqWidth, y0 + 18);
                    ctx.lineTo(clientX + 25 + reqWidth + 10, y0 + 13);
                    ctx.lineTo(clientX + 25 + reqWidth + 10, y0 + 23);
                    ctx.fill();

                    // Response arrow
                    ctx.fillStyle = '#4ade80';
                    ctx.fillRect(serverX - 25 - reqWidth, y0 + 30, reqWidth, 6);
                    ctx.beginPath();
                    ctx.moveTo(serverX - 25 - reqWidth, y0 + 33);
                    ctx.lineTo(serverX - 25 - reqWidth - 10, y0 + 28);
                    ctx.lineTo(serverX - 25 - reqWidth - 10, y0 + 38);
                    ctx.fill();

                    http2Time += 5;
                    document.getElementById('pushHttp2Time').textContent =
                        `⏱️ Tiempo: ${http2Time}ms | 🟢 Cargando HTML...`;
                }, 20);
            }

            // ===== WEBSOCKETS SIMULACIONES =====
            let currentWsDemo = 'handshake';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos WebSocket
                const wsTabs = document.querySelectorAll('.ws-tab');
                wsTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchWsDemo(demoType);
                    });
                });

                // Botón iniciar demo WebSocket
                const startWsDemo = document.getElementById('startWsDemo');
                if (startWsDemo) {
                    startWsDemo.addEventListener('click', function () {
                        const messages = parseInt(document.getElementById('wsMessages').value) || 5;

                        if (currentWsDemo === 'handshake') {
                            runHandshakeDemo(messages);
                        } else if (currentWsDemo === 'chat') {
                            runChatDemo(messages);
                        } else if (currentWsDemo === 'latency') {
                            runLatencyDemo(messages);
                        }
                    });
                }
            });

            function switchWsDemo(demoType) {
                currentWsDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.ws-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.ws-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }

                // Mostrar/ocultar controles
                const controlsDiv = document.getElementById('wsControls');
                if (demoType === 'latency') {
                    controlsDiv.style.display = 'none';
                } else {
                    controlsDiv.style.display = 'block';
                }
            }

            // ===== DEMO 1: HANDSHAKE - HTTP Polling vs WebSocket =====
            function runHandshakeDemo(numMessages) {
                animatePolling(numMessages);
                setTimeout(() => animateWebSocket(numMessages), 100);
            }

            function animatePolling(numMessages) {
                const canvas = document.getElementById('pollingCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 16);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 40;
                const serverX = width - 60;

                // Dibujar endpoints
                ctx.fillStyle = '#f87171';
                ctx.fillRect(clientX - 20, 10, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('▯', clientX, 28);
                ctx.fillText('Client', clientX, 42);

                ctx.fillStyle = '#f87171';
                ctx.fillRect(serverX - 20, 10, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('◉', serverX, 28);
                ctx.fillText('Server', serverX, 42);

                let connections = 0;
                let currentMsg = 0;

                const interval = setInterval(() => {
                    if (currentMsg >= numMessages) {
                        clearInterval(interval);
                        document.getElementById('pollingInfo').textContent =
                            `🔴 Total: ${connections} conexiones | Overhead alto`;
                        return;
                    }

                    const y = 70 + (currentMsg % 3) * 40;

                    // Nueva conexión para cada mensaje
                    connections++;

                    let progress = 0;
                    const animInterval = setInterval(() => {
                        progress += 10;
                        if (progress > 200) {
                            clearInterval(animInterval);
                            currentMsg++;
                            return;
                        }

                        ctx.clearRect(0, y - 5, canvas.width, 35);

                        // Handshake + Request
                        if (progress <= 100) {
                            const width = ((serverX - clientX - 40) * progress) / 100;

                            // Línea de conexión
                            ctx.strokeStyle = '#f87171';
                            ctx.lineWidth = 2;
                            ctx.setLineDash([3, 3]);
                            ctx.beginPath();
                            ctx.moveTo(clientX + 20, y + 10);
                            ctx.lineTo(clientX + 20 + width, y + 10);
                            ctx.stroke();
                            ctx.setLineDash([]);

                            // Paquete
                            ctx.fillStyle = '#f87171';
                            ctx.fillRect(clientX + 20 + width - 10, y + 5, 10, 10);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '8px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('◈', clientX + 20 + width - 5, y + 13);
                        }

                        // Response + Close
                        if (progress > 100) {
                            const respProgress = progress - 100;
                            const width = ((serverX - clientX - 40) * respProgress) / 100;

                            // Línea de respuesta
                            ctx.strokeStyle = '#4ade80';
                            ctx.lineWidth = 2;
                            ctx.setLineDash([3, 3]);
                            ctx.beginPath();
                            ctx.moveTo(serverX - 20, y + 20);
                            ctx.lineTo(serverX - 20 - width, y + 20);
                            ctx.stroke();
                            ctx.setLineDash([]);

                            // Paquete
                            ctx.fillStyle = '#4ade80';
                            ctx.fillRect(serverX - 20 - width - 10, y + 15, 10, 10);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '8px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('📬', serverX - 20 - width - 5, y + 23);

                            // X de cierre
                            if (respProgress > 80) {
                                ctx.fillStyle = '#f87171';
                                ctx.font = 'bold 12px Arial';
                                ctx.fillText('×', width / 2, y + 18);
                            }
                        }

                        // Contador
                        ctx.fillStyle = '#fbbf24';
                        ctx.font = 'bold 9px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(`Conn #${connections}`, 10, y + 15);

                        document.getElementById('pollingInfo').textContent =
                            `🔴 Conexiones: ${connections} | Polling cada request`;
                    }, 15);
                }, 300);
            }

            function animateWebSocket(numMessages) {
                const canvas = document.getElementById('wsCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 16);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 40;
                const serverX = width - 60;

                // Dibujar endpoints
                ctx.fillStyle = '#4ade80';
                ctx.fillRect(clientX - 20, 10, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('▯', clientX, 28);
                ctx.fillText('Client', clientX, 42);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(serverX - 20, 10, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('◉', serverX, 28);
                ctx.fillText('Server', serverX, 42);

                // Handshake inicial
                let progress = 0;
                const handshakeInterval = setInterval(() => {
                    progress += 10;
                    if (progress > 100) {
                        clearInterval(handshakeInterval);

                        // Dibujar conexión persistente
                        ctx.strokeStyle = '#22c55e';
                        ctx.lineWidth = 3;
                        ctx.beginPath();
                        ctx.moveTo(clientX + 20, 30);
                        ctx.lineTo(serverX - 20, 30);
                        ctx.stroke();

                        ctx.fillStyle = '#22c55e';
                        ctx.font = 'bold 9px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('⚡ CONEXION PERSISTENTE', width / 2, 25);

                        // Enviar mensajes por la conexión persistente
                        let currentMsg = 0;
                        const msgInterval = setInterval(() => {
                            if (currentMsg >= numMessages) {
                                clearInterval(msgInterval);
                                document.getElementById('wsInfo').textContent =
                                    `🟢 Total: 1 conexión | ${numMessages} mensajes`;

                                const pollingConns = numMessages;
                                const reduction = ((pollingConns - 1) / pollingConns * 100).toFixed(0);
                                document.getElementById('wsHandshakeResult').innerHTML =
                                    `<i class="fas fa-bolt"></i> WebSocket reduce <strong>${reduction}% las conexiones</strong> (${pollingConns} → 1)`;
                                return;
                            }

                            const y = 60 + (currentMsg % 4) * 30;

                            let msgProgress = 0;
                            const msgAnimInterval = setInterval(() => {
                                msgProgress += 15;
                                if (msgProgress > 100) {
                                    clearInterval(msgAnimInterval);
                                    currentMsg++;
                                    return;
                                }

                                ctx.clearRect(clientX + 25, y - 5, serverX - clientX - 50, 25);

                                // Mensaje viajando
                                const msgX = clientX + 25 + ((serverX - clientX - 50) * msgProgress) / 100;

                                ctx.fillStyle = currentMsg % 2 === 0 ? '#60a5fa' : '#a78bfa';
                                ctx.fillRect(msgX - 8, y, 16, 16);
                                ctx.fillStyle = '#ffffff';
                                ctx.font = '10px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText('💬', msgX, y + 11);

                                // Número de mensaje
                                ctx.fillStyle = '#fbbf24';
                                ctx.font = 'bold 8px Arial';
                                ctx.fillText(`#${currentMsg + 1}`, msgX, y - 2);

                                document.getElementById('wsInfo').textContent =
                                    `🟢 Conexión: 1 | Mensaje ${currentMsg + 1}/${numMessages}`;
                            }, 20);
                        }, 250);
                        return;
                    }

                    ctx.clearRect(0, 55, width, 20);

                    // Handshake animation
                    const lineWidth = ((serverX - clientX - 40) * progress) / 100;
                    ctx.strokeStyle = '#fbbf24';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(clientX + 20, 65);
                    ctx.lineTo(clientX + 20 + lineWidth, 65);
                    ctx.stroke();
                    ctx.setLineDash([]);

                    ctx.fillStyle = '#fbbf24';
                    ctx.font = 'bold 9px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('🤝 HTTP Upgrade', width / 2, 60);

                    document.getElementById('wsInfo').textContent =
                        `🟡 Estableciendo conexión WebSocket...`;
                }, 30);
            }

            // ===== DEMO 2: CHAT EN TIEMPO REAL =====
            function runChatDemo(numMessages) {
                const canvas = document.getElementById('chatCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const messages = [
                    { user: 'Cliente', text: 'Hola, necesito ayuda con una transferencia', color: '#60a5fa' },
                    { user: 'Soporte BdL', text: 'Con gusto le ayudo. ¿Qué necesita?', color: '#a78bfa' },
                    { user: 'Cliente', text: 'No puedo transferir a cuenta del Pichincha', color: '#60a5fa' },
                    { user: 'Soporte BdL', text: 'Verifico su cuenta. Un momento por favor', color: '#a78bfa' },
                    { user: 'Soporte BdL', text: 'Ya está solucionado. Puede intentar de nuevo', color: '#a78bfa' },
                    { user: 'Cliente', text: 'Perfecto! Ya funcionó. Gracias!', color: '#60a5fa' },
                    { user: 'Soporte BdL', text: '¿Necesita algo más?', color: '#a78bfa' },
                    { user: 'Cliente', text: 'No, eso es todo. Excelente servicio!', color: '#60a5fa' },
                    { user: 'Soporte BdL', text: 'Gracias por confiar en Banco de Loja ■', color: '#a78bfa' },
                    { user: 'Cliente', text: 'Hasta luego!', color: '#60a5fa' }
                ];

                const selectedMessages = messages.slice(0, numMessages);
                let currentMsg = 0;
                let yOffset = 20;

                // Título
                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('💬 Chat Room - WebSocket Connection', canvas.width / 2, 15);

                const interval = setInterval(() => {
                    if (currentMsg >= selectedMessages.length) {
                        clearInterval(interval);
                        document.getElementById('chatInfo').textContent =
                            `💬 ${selectedMessages.length} mensajes enviados | Latencia < 10ms`;
                        document.getElementById('chatResult').innerHTML =
                            `<i class="fas fa-comments"></i> Chat en tiempo real con <strong>comunicación bidireccional simultánea</strong>`;
                        return;
                    }

                    const msg = selectedMessages[currentMsg];
                    const isAlice = msg.user === 'Alice';
                    const x = isAlice ? 20 : canvas.width - 20;
                    const align = isAlice ? 'left' : 'right';

                    // Burbuja de mensaje
                    const textWidth = ctx.measureText(msg.text).width + 20;
                    const bubbleX = isAlice ? x : x - textWidth;

                    ctx.fillStyle = msg.color + '30';
                    ctx.fillRect(bubbleX, yOffset, textWidth, 40);
                    ctx.strokeStyle = msg.color;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(bubbleX, yOffset, textWidth, 40);

                    // Usuario
                    ctx.fillStyle = msg.color;
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = align;
                    ctx.fillText(msg.user, isAlice ? x + 10 : x - 10, yOffset + 15);

                    // Mensaje
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '9px Arial';
                    ctx.fillText(msg.text, isAlice ? x + 10 : x - 10, yOffset + 30);

                    // Timestamp
                    ctx.fillStyle = '#94a3b8';
                    ctx.font = '7px Arial';
                    ctx.fillText(`${currentMsg * 0.5}s`, isAlice ? x + 10 : x - 10, yOffset + 38);

                    yOffset += 45;
                    currentMsg++;

                    document.getElementById('chatInfo').textContent =
                        `💬 Mensajes: ${currentMsg}/${selectedMessages.length} | En tiempo real`;
                }, 500);
            }

            // ===== DEMO 3: COMPARACIÓN DE LATENCIA =====
            function runLatencyDemo(numTests = 10) {
                const canvas = document.getElementById('latencyCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // Título
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Latencia: HTTP Polling vs WebSocket', width / 2, 20);

                // Leyenda
                ctx.fillStyle = '#f87171';
                ctx.fillRect(20, 35, 15, 15);
                ctx.fillStyle = '#ffffff';
                ctx.font = '10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('HTTP Polling', 40, 47);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(width / 2 + 20, 35, 15, 15);
                ctx.fillText('WebSocket', width / 2 + 40, 47);

                // Ejes
                ctx.strokeStyle = '#94a3b8';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(40, 80);
                ctx.lineTo(40, 380);
                ctx.lineTo(width - 40, 380);
                ctx.stroke();

                ctx.fillStyle = '#94a3b8';
                ctx.font = '9px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Latencia (ms)', 20, 230);
                ctx.fillText('Requests', width / 2, 395);

                // Escala Y
                for (let i = 0; i <= 5; i++) {
                    const y = 380 - (i * 60);
                    const latency = i * 50;
                    ctx.fillStyle = '#94a3b8';
                    ctx.font = '8px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${latency}`, 35, y + 3);

                    ctx.strokeStyle = '#94a3b833';
                    ctx.beginPath();
                    ctx.moveTo(40, y);
                    ctx.lineTo(width - 40, y);
                    ctx.stroke();
                }

                let currentTest = 0;
                const pollingLatencies = [];
                const wsLatencies = [];

                const interval = setInterval(() => {
                    if (currentTest >= numTests) {
                        clearInterval(interval);

                        const avgPolling = pollingLatencies.reduce((a, b) => a + b, 0) / pollingLatencies.length;
                        const avgWs = wsLatencies.reduce((a, b) => a + b, 0) / wsLatencies.length;
                        const improvement = ((avgPolling - avgWs) / avgPolling * 100).toFixed(0);

                        document.getElementById('latencyInfo').textContent =
                            `▊ Polling: ${avgPolling.toFixed(0)}ms | WebSocket: ${avgWs.toFixed(0)}ms`;
                        document.getElementById('latencyResult').innerHTML =
                            `<i class="fas fa-tachometer-alt"></i> WebSocket es <strong>${improvement}% más rápido</strong> (${(avgPolling - avgWs).toFixed(0)}ms menos latencia)`;
                        return;
                    }

                    // Generar latencias simuladas
                    const pollingLatency = 150 + Math.random() * 100; // 150-250ms
                    const wsLatency = 5 + Math.random() * 15; // 5-20ms

                    pollingLatencies.push(pollingLatency);
                    wsLatencies.push(wsLatency);

                    const x = 50 + (currentTest * ((width - 100) / numTests));

                    // Barra HTTP Polling
                    const pollingHeight = (pollingLatency / 250) * 300;
                    ctx.fillStyle = '#f87171';
                    ctx.fillRect(x - 8, 380 - pollingHeight, 8, pollingHeight);

                    // Barra WebSocket
                    const wsHeight = (wsLatency / 250) * 300;
                    ctx.fillStyle = '#4ade80';
                    ctx.fillRect(x + 2, 380 - wsHeight, 8, wsHeight);

                    // Valores
                    ctx.fillStyle = '#f87171';
                    ctx.font = '7px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${pollingLatency.toFixed(0)}`, x - 4, 380 - pollingHeight - 3);

                    ctx.fillStyle = '#4ade80';
                    ctx.fillText(`${wsLatency.toFixed(0)}`, x + 6, 380 - wsHeight - 3);

                    currentTest++;

                    const avgPolling = pollingLatencies.reduce((a, b) => a + b, 0) / pollingLatencies.length;
                    const avgWs = wsLatencies.reduce((a, b) => a + b, 0) / wsLatencies.length;

                    document.getElementById('latencyInfo').textContent =
                        `▊ Test ${currentTest}/${numTests} | Polling: ${avgPolling.toFixed(0)}ms | WS: ${avgWs.toFixed(0)}ms`;
                }, 400);
            }
        </script>

        <!-- Slide 5: WebSockets -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-plug"></i> WebSockets: Conexión Persistente
                Bidireccional</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Características -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Notificaciones en tiempo real cuando llega una transferencia"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Características</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Full-duplex</strong>: Bidireccional</li>
                            <li><strong>Persistente</strong>: Conexión continua</li>
                            <li><strong>Bajo overhead</strong>: Sin headers repetidos</li>
                            <li><strong>Tiempo real</strong>: Latencia mínima</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Notificaciones y soporte en vivo
                        </p>
                    </div>

                    <!-- Pestañas de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="ws-tab active" data-demo="handshake"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Handshake
                        </button>
                        <button class="ws-tab" data-demo="chat"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Chat
                        </button>
                        <button class="ws-tab" data-demo="latency"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Latencia
                        </button>
                        <button class="ws-tab" data-demo="ws-diagrama"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Diagrama
                        </button>
                        <button class="ws-tab" data-demo="codigo"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Código
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startWsDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                        <div id="wsControls" style="margin-top: 6px; font-size: 0.75rem;">
                            <label style="color: #e2e8f0;">Mensajes: </label>
                            <input type="number" id="wsMessages" value="5" min="3" max="10"
                                style="width: 50px; padding: 3px; background: rgba(255,255,255,0.1); border: 1px solid var(--uide-accent); color: white; border-radius: 4px; font-size: 0.75rem;">
                        </div>
                    </div>
                </div>

                <!-- Columna Derecha: Visualización -->
                <div id="wsDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Handshake -->
                    <div id="demoHandshake" class="ws-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-times-circle"></i> HTTP Polling - Múltiples Conexiones
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; position: relative; overflow: hidden; height: 200px;">
                                <canvas id="pollingCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="pollingInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Conexiones: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-check-circle"></i> WebSocket - Conexión Persistente
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; position: relative; overflow: hidden; height: 200px;">
                                <canvas id="wsCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="wsInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Conexiones: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="wsHandshakeResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Comparación de rendimiento HTTP/1.1 vs HTTP/2
                            </div>
                        </div>
                    </div>

                    <!-- Demo Chat -->
                    <div id="demoChat" class="ws-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-comments"></i> Chat en Tiempo Real - WebSocket
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 420px;">
                                <canvas id="chatCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="chatInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Mensajes: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="chatResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el chat
                            </div>
                        </div>
                    </div>

                    <!-- Demo Latencia -->
                    <div id="demoLatency" class="ws-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-tachometer-alt"></i> Comparación de Latencia
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 420px;">
                                <canvas id="latencyCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="latencyInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Latencia promedio: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="latencyResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para medir latencia
                            </div>
                        </div>
                    </div>

                    <!-- Demo Diagrama WebSocket -->
                    <div id="demoWs-diagrama" class="ws-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%; overflow-y: auto;">
                        <div style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; padding: 16px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: var(--uide-accent); margin: 0 0 12px 0; font-size: 0.9rem;">
                                <i class="fas fa-exchange-alt"></i> WebSocket - Comunicación Full-Duplex
                            </h3>
                            <div class="mermaid" style="background: white; border-radius: 8px; padding: 16px; flex: 1; display: flex; align-items: center; justify-content: center;">
sequenceDiagram
    participant Cliente as Cliente Web<br/>(Banco de Loja)
    participant Server as Servidor WebSocket

    Note over Cliente,Server: 1. Handshake HTTP Upgrade

    Cliente->>Server: GET /ws HTTP/1.1<br/>Upgrade: websocket<br/>Connection: Upgrade<br/>Sec-WebSocket-Key: xxx
    Server-->>Cliente: HTTP/1.1 101 Switching Protocols<br/>Upgrade: websocket<br/>Connection: Upgrade

    rect rgb(100, 200, 100, 0.1)
        Note over Cliente,Server: 2. Conexión WebSocket Establecida (Full-Duplex)

        Cliente->>Server: {type: "auth", token: "JWT..."}
        Server-->>Cliente: {type: "auth_ok", userId: "12345"}

        par Cliente envía mensaje
            Cliente->>Server: {type: "subscribe", cuenta: "2100456789"}
        and Servidor envía notificación
            Server->>Cliente: {type: "balance", monto: 5000}
        end

        Note over Server: Nueva transferencia detectada

        Server->>Cliente: {type: "notification",<br/>msg: "Depósito $150"}

        Cliente->>Server: {type: "ack", id: "notif-1"}

        Server->>Cliente: {type: "notification",<br/>msg: "Retiro $50"}

        Cliente->>Server: {type: "get_transactions"}
        Server-->>Cliente: {type: "transactions",<br/>data: [...]}
    end

    rect rgb(255, 200, 100, 0.1)
        Note over Cliente,Server: 3. Cierre de Conexión

        Cliente->>Server: Close Frame (Code: 1000)
        Server-->>Cliente: Close Frame (Code: 1000)
    end

    Note over Cliente,Server: Ventajas vs HTTP Polling:<br/>- Latencia: 5-20ms vs 150-250ms<br/>- Sin overhead de headers repetidos<br/>- Eventos instantáneos del servidor
            </div>
        </div>
                    </div>

                    <!-- Demo Código -->
                    <div id="demoCodigo" class="ws-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%; overflow-y: auto;">

                        <!-- Tabs de código -->
                        <div class="code-tabs-container" style="margin: 0;">
                            <div class="code-tabs-header">
                                <button class="code-tab-btn active" data-tab="ws-cliente">
                                    <i class="fas fa-desktop"></i> Cliente
                                </button>
                                <button class="code-tab-btn" data-tab="ws-servidor">
                                    <i class="fas fa-server"></i> Servidor
                                </button>
                                <button class="code-tab-btn" data-tab="ws-notificaciones">
                                    <i class="fas fa-bell"></i> Notificaciones
                                </button>
                            </div>

                            <!-- Tab Cliente WebSocket -->
                            <div class="code-tab-content active" data-tab="ws-cliente">
                                <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-desktop"></i> cliente-websocket.js
                                        </div>
                                        <span class="code-language">JavaScript</span>
                                    </div>
                                    <div class="code-content" style="max-height: 450px;">
                                        <pre class="line-numbers"><code class="language-javascript">// Cliente WebSocket para el Banco de Loja
// Notificaciones de transferencias en tiempo real 

class WebSocketCliente {
  #ws = null;
  #config = {
    url: 'ws://localhost:8080',
    token: 'JWT_TOKEN_USUARIO',
    cuenta: 'CTA-00123456',
    reconnectDelay: 5000
  };

  constructor(config = {}) {
    this.#config = { ...this.#config, ...config };
    this.conectar();
  }

  conectar() {
    this.#ws = new WebSocket(this.#config.url);

    this.#ws.addEventListener('open', this.#onOpen.bind(this));
    this.#ws.addEventListener('message', this.#onMessage.bind(this));
    this.#ws.addEventListener('error', this.#onError.bind(this));
    this.#ws.addEventListener('close', this.#onClose.bind(this));
  }

  #onOpen() {
    console.log('Conectado al servidor del Banco de Loja');

    // Autenticar usuario
    this.enviar({
      tipo: 'autenticacion',
      token: this.#config.token,
      cuenta: this.#config.cuenta
    });
  }

  #onMessage(event) {
    const mensaje = JSON.parse(event.data);

    // Usar pattern matching con object destructuring
    const handlers = {
      transferencia_recibida: () => this.#handleTransferenciaRecibida(mensaje),
      transferencia_enviada: () => this.#handleTransferenciaEnviada(mensaje),
      alerta_seguridad: () => this.#handleAlertaSeguridad(mensaje)
    };

    handlers[mensaje.tipo]?.();
  }

  #handleTransferenciaRecibida(mensaje) {
    this.mostrarNotificacion({
      titulo: 'Transferencia Recibida',
      monto: mensaje.monto,
      origen: mensaje.cuenta_origen,
      fecha: new Date(mensaje.timestamp)
    });
    this.actualizarSaldo(mensaje.saldo_nuevo);
  }

  #handleTransferenciaEnviada(mensaje) {
    console.log(`Transferencia enviada: $${mensaje.monto}`);
  }

  #handleAlertaSeguridad(mensaje) {
    this.mostrarAlerta(mensaje.descripcion);
  }

  #onError(error) {
    console.error('Error WebSocket:', error);
    this.mostrarError('Error de conexión con el servidor');
  }

  #onClose() {
    console.log('Conexión cerrada');
    setTimeout(() => {
      console.log('Reintentando conexión...');
      this.conectar();
    }, this.#config.reconnectDelay);
  }

  enviar(datos) {
    if (this.#ws?.readyState === WebSocket.OPEN) {
      this.#ws.send(JSON.stringify(datos));
    }
  }

  async mostrarNotificacion(datos) {
    // Verificar permisos de notificación
    const permission = await Notification.requestPermission();

    if (permission === 'granted') {
      const notif = new Notification(datos.titulo, {
        body: `Monto: $${datos.monto}\nDesde: ${datos.origen}`,
        icon: '/banco-logo.png'
      });

      // Reproducir sonido
      const audio = new Audio('/notificacion.mp3');
      await audio.play().catch(err => console.log('Audio blocked:', err));
    }
  }

  actualizarSaldo(nuevoSaldo) {
    // Implementación de actualización de saldo
    console.log(`Nuevo saldo: $${nuevoSaldo}`);
  }

  mostrarAlerta(descripcion) {
    // Implementación de alerta
    console.warn('Alerta de seguridad:', descripcion);
  }

  mostrarError(mensaje) {
    // Implementación de error
    console.error(mensaje);
  }

  desconectar() {
    this.#ws?.close();
  }
}

// Uso
const cliente = new WebSocketCliente();</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Servidor WebSocket -->
                            <div class="code-tab-content" data-tab="ws-servidor">
                                <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-server"></i> servidor-websocket.js
                                        </div>
                                        <span class="code-language">Node.js</span>
                                    </div>
                                    <div class="code-content" style="max-height: 450px;">
                                        <pre class="line-numbers"><code class="language-javascript">// Servidor WebSocket para notificaciones del Banco de Loja 
import { WebSocketServer, WebSocket } from 'ws';
import jwt from 'jsonwebtoken';

class ServidorWebSocket {
  #wss = null;
  #clientesPorCuenta = new Map();
  #config = {
    port: 8080,
    jwtSecret: process.env.JWT_SECRET
  };

  constructor(config = {}) {
    this.#config = { ...this.#config, ...config };
    this.iniciar();
  }

  iniciar() {
    this.#wss = new WebSocketServer({ port: this.#config.port });

    this.#wss.on('connection', this.#handleConnection.bind(this));

    console.log(`Servidor WebSocket iniciado en puerto ${this.#config.port}`);
  }

  #handleConnection(ws) {
    console.log('Nueva conexión establecida');

    let cuentaAutenticada = null;

    ws.on('message', async (mensaje) => {
      try {
        const datos = JSON.parse(mensaje.toString());
        await this.#procesarMensaje(ws, datos, (cuenta) => {
          cuentaAutenticada = cuenta;
        });
      } catch (error) {
        this.#enviarError(ws, 'Error al procesar mensaje');
      }
    });

    ws.on('close', () => {
      if (cuentaAutenticada) {
        this.#clientesPorCuenta.delete(cuentaAutenticada);
        console.log(`Cliente desconectado: ${cuentaAutenticada}`);
      }
    });

    ws.on('error', (error) => {
      console.error('Error en WebSocket:', error);
    });
  }

  async #procesarMensaje(ws, datos, setCuenta) {
    const handlers = {
      autenticacion: async () => await this.#handleAutenticacion(ws, datos, setCuenta)
    };

    await handlers[datos.tipo]?.();
  }

  async #handleAutenticacion(ws, datos, setCuenta) {
    try {
      // Verificar token JWT
      const payload = jwt.verify(datos.token, this.#config.jwtSecret);

      // Registrar cliente
      this.#clientesPorCuenta.set(datos.cuenta, ws);
      setCuenta(datos.cuenta);

      // Confirmar autenticación
      this.#enviar(ws, {
        tipo: 'autenticacion_exitosa',
        mensaje: 'Conectado al sistema de notificaciones'
      });

      console.log(`Cliente autenticado: ${datos.cuenta}`);
    } catch (error) {
      this.#enviarError(ws, 'Token inválido');
      ws.close();
    }
  }

  #enviar(ws, datos) {
    if (ws.readyState === WebSocket.OPEN) {
      ws.send(JSON.stringify(datos));
    }
  }

  #enviarError(ws, mensaje) {
    this.#enviar(ws, {
      tipo: 'error',
      mensaje
    });
  }

  // Método público para notificar transferencias
  notificarTransferencia(cuentaDestino, datosTransferencia) {
    const cliente = this.#clientesPorCuenta.get(cuentaDestino);

    if (cliente?.readyState === WebSocket.OPEN) {
      this.#enviar(cliente, {
        tipo: 'transferencia_recibida',
        monto: datosTransferencia.monto,
        cuenta_origen: datosTransferencia.origen,
        concepto: datosTransferencia.concepto,
        timestamp: new Date().toISOString(),
        saldo_nuevo: datosTransferencia.saldoNuevo
      });
    }
  }

  cerrar() {
    this.#wss?.close();
  }
}

// Exportar clase
export default ServidorWebSocket;

// Uso
const servidor = new ServidorWebSocket();</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Notificaciones en Tiempo Real -->
                            <div class="code-tab-content" data-tab="ws-notificaciones">
                                <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-bell"></i> sistema-notificaciones.js
                                        </div>
                                        <span class="code-language">Node.js</span>
                                    </div>
                                    <div class="code-content" style="max-height: 450px;">
                                        <pre class="line-numbers"><code class="language-javascript">// Sistema de notificaciones del Banco de Loja 
// Integración con API de transferencias
import ServidorWebSocket from './servidor-websocket.js';
import express from 'express';

class APITransferencias {
  #app = express();
  #servidorWS = null;
  #config = {
    port: 3000
  };

  constructor(servidorWS, config = {}) {
    this.#servidorWS = servidorWS;
    this.#config = { ...this.#config, ...config };
    this.#configurarMiddleware();
    this.#configurarRutas();
  }

  #configurarMiddleware() {
    this.#app.use(express.json());
  }

  #configurarRutas() {
    this.#app.post('/api/transferencias', this.#procesarTransferencia.bind(this));
  }

  async #procesarTransferencia(req, res) {
    const { cuenta_origen, cuenta_destino, monto, concepto } = req.body;

    try {
      // 1. Validar saldo disponible
      const saldoOrigen = await this.#obtenerSaldo(cuenta_origen);

      if (saldoOrigen < monto) {
        return res.status(400).json({
          error: 'Saldo insuficiente',
          saldo_disponible: saldoOrigen
        });
      }

      // 2. Ejecutar transferencia en base de datos
      const transaccion = await this.#ejecutarTransferencia({
        origen: cuenta_origen,
        destino: cuenta_destino,
        monto,
        concepto
      });

      // 3. Actualizar saldos de manera atómica
      await Promise.all([
        this.#actualizarSaldo(cuenta_origen, -monto),
        this.#actualizarSaldo(cuenta_destino, monto)
      ]);

      // 4. Obtener nuevo saldo y notificar vía WebSocket al destinatario
      const saldoNuevo = await this.#obtenerSaldo(cuenta_destino);

      this.#servidorWS.notificarTransferencia(cuenta_destino, {
        monto,
        origen: cuenta_origen,
        concepto,
        saldoNuevo
      });

      res.json({
        success: true,
        transaccion_id: transaccion.id,
        mensaje: 'Transferencia exitosa',
        timestamp: new Date().toISOString()
      });

    } catch (error) {
      console.error('Error en transferencia:', error);

      res.status(500).json({
        error: 'Error al procesar transferencia',
        detalle: error.message
      });
    }
  }

  async #obtenerSaldo(cuenta) {
    // Simulación - en producción: consulta a base de datos
    return 5000.00;
  }

  async #ejecutarTransferencia(datos) {
    // Simulación - en producción: transacción SQL
    return {
      id: `TRX-${Date.now()}`,
      ...datos,
      timestamp: new Date().toISOString()
    };
  }

  async #actualizarSaldo(cuenta, diferencia) {
    // Simulación - en producción: UPDATE a base de datos
    console.log(`Actualizando saldo de ${cuenta}: ${diferencia}`);
  }

  iniciar() {
    this.#app.listen(this.#config.port, () => {
      console.log(`API REST en puerto ${this.#config.port}`);
    });
  }
}

// Uso
const servidorWS = new ServidorWebSocket();
const api = new APITransferencias(servidorWS);
api.iniciar();</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; margin-top: 8px;">
                            <p style="color: var(--uide-accent); font-size: 0.8rem; margin: 0;">
                                <i class="fas fa-lightbulb"></i>
                                <strong>WebSocket</strong> permite notificaciones instantáneas sin polling.
                                El cliente recibe eventos en tiempo real cuando hay transferencias.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 6: gRPC Intro -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-rocket"></i> gRPC: Remote Procedure Call Moderno</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Características -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Comunicación entre microsservicios del Banco de Loja"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Ventajas</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Protobuf</strong>: Binario compacto</li>
                            <li><strong>HTTP/2</strong>: Multiplexación</li>
                            <li><strong>Baja latencia</strong>: Microsservicios</li>
                            <li><strong>Streaming</strong>: Bidireccional</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Microsservicios internos del banco
                        </p>
                    </div>

                    <!-- Pestañas de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="grpc-tab active" data-demo="rpc"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            RPC Flow
                        </button>
                        <button class="grpc-tab" data-demo="payload"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            JSON vs Protobuf
                        </button>
                        <button class="grpc-tab" data-demo="grpc-diagrama"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Diagrama
                        </button>
                        <button class="grpc-tab" data-demo="grpc-codigo"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Código
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startGrpcDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualización -->
                <div id="grpcDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo RPC Flow -->
                    <div id="demoRpc" class="grpc-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-rocket"></i> gRPC Remote Procedure Call
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                                <canvas id="rpcCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="rpcInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Tiempo: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="rpcResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el flujo RPC
                            </div>
                        </div>
                    </div>

                    <!-- Demo Payload Comparison -->
                    <div id="demoPayload" class="grpc-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-file-code"></i> JSON (Texto)
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="jsonCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="jsonSize"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa;">
                                Tamaño: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-file-binary"></i> Protobuf (Binario)
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="protobufCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="protobufSize"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Tamaño: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="payloadResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para comparar tamaños
                            </div>
                        </div>
                    </div>

                    <!-- Demo Diagrama gRPC -->
                    <div id="demoGrpc-diagrama" class="grpc-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%; overflow-y: auto;">
                        <div style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; padding: 16px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: var(--uide-accent); margin: 0 0 12px 0; font-size: 0.9rem;">
                                <i class="fas fa-project-diagram"></i> Arquitectura gRPC - Tipos de Streaming
                            </h3>
                            <div class="mermaid" style="background: white; border-radius: 8px; padding: 16px; flex: 1; display: flex; align-items: center; justify-content: center;">
graph TB
    subgraph "Cliente Banco de Loja"
        C1[Cliente gRPC]
    end

    subgraph "Servidor gRPC sobre HTTP/2"
        S1[Servicio Transferencias]
        S2[Servicio Consultas]
        S3[Servicio Notificaciones]
    end

    subgraph "1. Unary RPC - Request/Response Simple"
        C1 -->|"TransferirFondos(req)"| S1
        S1 -->|"TransferResponse"| C1
        style S1 fill:#4ade80
    end

    subgraph "2. Server Streaming - Múltiples Respuestas"
        C1 -->|"ObtenerHistorial(req)"| S2
        S2 -->|"Stream: Transacción 1"| C1
        S2 -->|"Stream: Transacción 2"| C1
        S2 -->|"Stream: Transacción N"| C1
        style S2 fill:#60a5fa
    end

    subgraph "3. Bidirectional Streaming - Comunicación Continua"
        C1 <-->|"MonitorearCuenta()"| S3
        S3 -->|"Evento: Depósito"| C1
        S3 -->|"Evento: Retiro"| C1
        C1 -->|"ACK confirmación"| S3
        style S3 fill:#f59e0b
    end

    subgraph "Protocol Buffers - Serialización"
        PB[.proto Schema]
        PB -->|Genera| GEN1[Código Cliente]
        PB -->|Genera| GEN2[Código Servidor]
    end

    S1 -.->|Usa| PB
    S2 -.->|Usa| PB
    S3 -.->|Usa| PB

    style C1 fill:#e9ab21,stroke:#333,stroke-width:3px
    style PB fill:#94a3b8,stroke:#333,stroke-width:2px
            </div>
        </div>
                    </div>

                    <!-- Demo Código gRPC -->
                    <div id="demoGrpc-codigo" class="grpc-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%; overflow-y: auto;">

                        <!-- Tabs de código -->
                        <div class="code-tabs-container" style="margin: 0;">
                            <div class="code-tabs-header">
                                <button class="code-tab-btn active" data-tab="grpc-proto">
                                    <i class="fas fa-file-contract"></i> .proto
                                </button>
                                <button class="code-tab-btn" data-tab="grpc-server">
                                    <i class="fas fa-server"></i> Servidor
                                </button>
                                <button class="code-tab-btn" data-tab="grpc-client">
                                    <i class="fas fa-desktop"></i> Cliente
                                </button>
                            </div>

                            <!-- Tab .proto Definition -->
                            <div class="code-tab-content active" data-tab="grpc-proto">
                                <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-file-contract"></i> banco.proto
                                        </div>
                                        <span class="code-language">Protocol Buffers</span>
                                    </div>
                                    <div class="code-content" style="max-height: 450px;">
                                        <pre class="line-numbers"><code class="language-protobuf">syntax = "proto3";

package banco.loja;

// Servicio de Transferencias del Banco de Loja
service TransferenciaService {
  // RPC unario: Una solicitud, una respuesta
  rpc TransferirFondos(TransferenciaRequest) returns (TransferenciaResponse);

  // RPC streaming del servidor: Una solicitud, múltiples respuestas
  rpc ConsultarMovimientos(ConsultaRequest) returns (stream Movimiento);

  // RPC streaming bidireccional: Cliente y servidor envían streams
  rpc MonitorearTransacciones(stream MonitorRequest) returns (stream MonitorResponse);
}

// Mensaje de solicitud de transferencia
message TransferenciaRequest {
  string cuenta_origen = 1;
  string cuenta_destino = 2;
  double monto = 3;
  string concepto = 4;
  string referencia = 5;
}

// Mensaje de respuesta de transferencia
message TransferenciaResponse {
  bool exitoso = 1;
  string transaccion_id = 2;
  double saldo_disponible = 3;
  string mensaje = 4;
  int64 timestamp = 5;
}

// Mensaje de consulta de movimientos
message ConsultaRequest {
  string cuenta = 1;
  int64 fecha_inicio = 2;
  int64 fecha_fin = 3;
}

// Mensaje de movimiento individual
message Movimiento {
  string id = 1;
  string tipo = 2;  // "CREDITO" o "DEBITO"
  double monto = 3;
  string concepto = 4;
  int64 fecha = 5;
}

// Mensajes para monitoring en tiempo real
message MonitorRequest {
  string cuenta = 1;
}

message MonitorResponse {
  string evento = 1;
  string detalle = 2;
  int64 timestamp = 3;
}</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Servidor gRPC -->
                            <div class="code-tab-content" data-tab="grpc-server">
                                <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-server"></i> servidor-grpc.js
                                        </div>
                                        <span class="code-language">Node.js</span>
                                    </div>
                                    <div class="code-content" style="max-height: 450px;">
                                        <pre class="line-numbers"><code class="language-javascript">// Servidor gRPC del Banco de Loja 
import grpc from '@grpc/grpc-js';
import protoLoader from '@grpc/proto-loader';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

class ServidorGRPC {
  #server = null;
  #proto = null;
  #config = {
    port: '0.0.0.0:50051',
    protoPath: join(__dirname, 'banco.proto')
  };

  constructor(config = {}) {
    this.#config = { ...this.#config, ...config };
    this.#cargarProto();
  }

  #cargarProto() {
    const packageDefinition = protoLoader.loadSync(this.#config.protoPath, {
      keepCase: true,
      longs: String,
      enums: String,
      defaults: true,
      oneofs: true
    });

    this.#proto = grpc.loadPackageDefinition(packageDefinition).banco.loja;
  }

  // 1. RPC Unario: TransferirFondos
  async #transferirFondos(call, callback) {
    const { cuenta_origen, cuenta_destino, monto, concepto } = call.request;

    console.log(`Transferencia: $${monto} de ${cuenta_origen} a ${cuenta_destino}`);

    try {
      // Simular validación y procesamiento asíncrono
      await new Promise(resolve => setTimeout(resolve, 100));

      const saldoDisponible = 5000.00;

      if (monto > saldoDisponible) {
        callback({
          code: grpc.status.FAILED_PRECONDITION,
          message: 'Saldo insuficiente'
        });
        return;
      }

      // Transferencia exitosa
      const response = {
        exitoso: true,
        transaccion_id: `TRX-${Date.now()}`,
        saldo_disponible: saldoDisponible - monto,
        mensaje: 'Transferencia procesada exitosamente',
        timestamp: Date.now()
      };

      callback(null, response);
    } catch (error) {
      callback({
        code: grpc.status.INTERNAL,
        message: error.message
      });
    }
  }

  // 2. RPC Streaming del Servidor: ConsultarMovimientos
  #consultarMovimientos(call) {
    const { cuenta, fecha_inicio, fecha_fin } = call.request;

    console.log(`Consultando movimientos de ${cuenta}`);

    const movimientos = [
      { id: 'MOV-001', tipo: 'CREDITO', monto: 1500.00, concepto: 'Depósito', fecha: Date.now() - 86400000 },
      { id: 'MOV-002', tipo: 'DEBITO', monto: 500.00, concepto: 'Retiro ATM', fecha: Date.now() - 43200000 },
      { id: 'MOV-003', tipo: 'CREDITO', monto: 2000.00, concepto: 'Transferencia recibida', fecha: Date.now() - 7200000 },
      { id: 'MOV-004', tipo: 'DEBITO', monto: 300.00, concepto: 'Pago servicios', fecha: Date.now() - 3600000 }
    ];

    // Enviar cada movimiento como stream
    movimientos.forEach((mov, index) => {
      setTimeout(() => {
        call.write(mov);
        if (index === movimientos.length - 1) {
          call.end();
        }
      }, index * 200);
    });
  }

  // 3. RPC Streaming Bidireccional: MonitorearTransacciones
  #monitorearTransacciones(call) {
    call.on('data', (request) => {
      console.log(`Monitoreando cuenta: ${request.cuenta}`);

      const eventos = ['INICIO_SESION', 'TRANSFERENCIA_ENVIADA', 'TRANSFERENCIA_RECIBIDA'];

      eventos.forEach((evento, index) => {
        setTimeout(() => {
          call.write({
            evento,
            detalle: `Evento de cuenta ${request.cuenta}`,
            timestamp: Date.now()
          });
        }, index * 1000);
      });
    });

    call.on('end', () => {
      call.end();
    });

    call.on('error', (error) => {
      console.error('Error en stream:', error);
    });
  }

  async iniciar() {
    this.#server = new grpc.Server();

    this.#server.addService(this.#proto.TransferenciaService.service, {
      TransferirFondos: this.#transferirFondos.bind(this),
      ConsultarMovimientos: this.#consultarMovimientos.bind(this),
      MonitorearTransacciones: this.#monitorearTransacciones.bind(this)
    });

    return new Promise((resolve, reject) => {
      this.#server.bindAsync(
        this.#config.port,
        grpc.ServerCredentials.createInsecure(),
        (err, port) => {
          if (err) {
            console.error('Error al iniciar servidor:', err);
            reject(err);
            return;
          }
          console.log(`Servidor gRPC escuchando en puerto ${port}`);
          this.#server.start();
          resolve(port);
        }
      );
    });
  }

  detener() {
    return new Promise((resolve) => {
      this.#server?.tryShutdown(() => {
        console.log('Servidor gRPC detenido');
        resolve();
      });
    });
  }
}

// Uso
const servidor = new ServidorGRPC();
await servidor.iniciar();</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Cliente gRPC -->
                            <div class="code-tab-content" data-tab="grpc-client">
                                <div class="code-container" style="margin: 0; border: none; border-radius: 0;">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-desktop"></i> cliente-grpc.js
                                        </div>
                                        <span class="code-language">Node.js</span>
                                    </div>
                                    <div class="code-content" style="max-height: 450px;">
                                        <pre class="line-numbers"><code class="language-javascript">// Cliente gRPC del Banco de Loja 
import grpc from '@grpc/grpc-js';
import protoLoader from '@grpc/proto-loader';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

class ClienteGRPC {
  #client = null;
  #config = {
    serverUrl: 'localhost:50051',
    protoPath: join(__dirname, 'banco.proto')
  };

  constructor(config = {}) {
    this.#config = { ...this.#config, ...config };
    this.#conectar();
  }

  #conectar() {
    const packageDefinition = protoLoader.loadSync(this.#config.protoPath, {
      keepCase: true,
      longs: String,
      enums: String,
      defaults: true,
      oneofs: true
    });

    const bancoProto = grpc.loadPackageDefinition(packageDefinition).banco.loja;

    this.#client = new bancoProto.TransferenciaService(
      this.#config.serverUrl,
      grpc.credentials.createInsecure()
    );
  }

  // ===== EJEMPLO 1: RPC Unario =====
  async transferirFondos(datosTransferencia) {
    console.log('\n=== Realizando transferencia (RPC Unario) ===');

    return new Promise((resolve, reject) => {
      this.#client.TransferirFondos(datosTransferencia, (error, response) => {
        if (error) {
          console.error('Error en transferencia:', error.message);
          reject(error);
          return;
        }

        console.log('Transferencia exitosa:');
        console.log(`  ID: ${response.transaccion_id}`);
        console.log(`  Saldo disponible: $${response.saldo_disponible}`);
        console.log(`  Mensaje: ${response.mensaje}`);

        resolve(response);
      });
    });
  }

  // ===== EJEMPLO 2: RPC Streaming del Servidor =====
  async consultarMovimientos(consultaParams) {
    console.log('\n=== Consultando movimientos (Streaming del Servidor) ===');

    return new Promise((resolve, reject) => {
      const movimientos = [];
      const call = this.#client.ConsultarMovimientos(consultaParams);

      call.on('data', (movimiento) => {
        const signo = movimiento.tipo === 'CREDITO' ? '+' : '-';
        console.log(`${signo} $${movimiento.monto} - ${movimiento.concepto} [${movimiento.id}]`);
        movimientos.push(movimiento);
      });

      call.on('end', () => {
        console.log('Consulta de movimientos completada');
        resolve(movimientos);
      });

      call.on('error', (error) => {
        console.error('Error:', error.message);
        reject(error);
      });
    });
  }

  // ===== EJEMPLO 3: RPC Streaming Bidireccional =====
  monitorearTransacciones(cuenta, duracionMs = 5000) {
    console.log('\n=== Monitoreando transacciones (Streaming Bidireccional) ===');

    const call = this.#client.MonitorearTransacciones();

    call.on('data', (response) => {
      const fecha = new Date(parseInt(response.timestamp));
      console.log(`[${fecha.toISOString()}] ${response.evento}: ${response.detalle}`);
    });

    call.on('end', () => {
      console.log('Monitoreo finalizado');
    });

    call.on('error', (error) => {
      console.error('Error en monitoreo:', error.message);
    });

    // Enviar solicitud de monitoreo
    call.write({ cuenta });

    // Cerrar stream después del tiempo especificado
    setTimeout(() => {
      call.end();
    }, duracionMs);

    return call;
  }
}

// ===== USO DEL CLIENTE =====
const cliente = new ClienteGRPC();

// Ejemplo 1: Transferencia
await cliente.transferirFondos({
  cuenta_origen: 'CTA-00123456',
  cuenta_destino: 'CTA-00789012',
  monto: 1500.00,
  concepto: 'Pago de servicios',
  referencia: 'REF-001'
});

// Ejemplo 2: Consultar movimientos
const movimientos = await cliente.consultarMovimientos({
  cuenta: 'CTA-00123456',
  fecha_inicio: Date.now() - 30 * 86400000,
  fecha_fin: Date.now()
});

// Ejemplo 3: Monitorear transacciones
cliente.monitorearTransacciones('CTA-00123456', 5000);</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; margin-top: 8px;">
                            <p style="color: var(--uide-accent); font-size: 0.8rem; margin: 0;">
                                <i class="fas fa-rocket"></i>
                                <strong>gRPC</strong> usa HTTP/2 y Protobuf para comunicación ultra-rápida entre microservicios.
                                Soporta RPC unario, streaming del servidor, cliente y bidireccional.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== GRPC SIMULACIONES =====
            let currentGrpcDemo = 'rpc';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos gRPC
                const grpcTabs = document.querySelectorAll('.grpc-tab');
                grpcTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchGrpcDemo(demoType);
                    });
                });

                // Botón iniciar demo gRPC
                const startGrpcDemo = document.getElementById('startGrpcDemo');
                if (startGrpcDemo) {
                    startGrpcDemo.addEventListener('click', function () {
                        if (currentGrpcDemo === 'rpc') {
                            runRpcFlowDemo();
                        } else if (currentGrpcDemo === 'payload') {
                            runPayloadComparisonDemo();
                        }
                    });
                }
            });

            function switchGrpcDemo(demoType) {
                currentGrpcDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.grpc-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.grpc-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: RPC FLOW - Visualización de llamada remota =====
            function runRpcFlowDemo() {
                const canvas = document.getElementById('rpcCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 50;
                const serverX = width - 80;
                const centerX = width / 2;

                // Dibujar cliente y servidor
                ctx.fillStyle = '#60a5fa';
                ctx.fillRect(clientX - 25, 20, 50, 50);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('▯', clientX, 42);
                ctx.fillText('Client', clientX, 58);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(serverX - 25, 20, 50, 50);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('◉', serverX, 42);
                ctx.fillText('Server', serverX, 58);

                const steps = [
                    { name: '1. Invocación Método', y: 100, desc: 'getUserById(123)', color: '#60a5fa', time: 5 },
                    { name: '2. Serialización Protobuf', y: 160, desc: 'Objeto → Binario', color: '#a78bfa', time: 8 },
                    { name: '3. HTTP/2 Stream', y: 220, desc: 'Envío por red', color: '#fbbf24', time: 15 },
                    { name: '4. Deserialización', y: 280, desc: 'Binario → Objeto', color: '#f472b6', time: 7 },
                    { name: '5. Ejecución', y: 340, desc: 'Lógica del servidor', color: '#22c55e', time: 20 },
                    { name: '6. Respuesta', y: 400, desc: 'Retorno al cliente', color: '#4ade80', time: 12 }
                ];

                let currentStep = 0;
                let totalTime = 0;

                const interval = setInterval(() => {
                    if (currentStep >= steps.length) {
                        clearInterval(interval);
                        document.getElementById('rpcInfo').textContent =
                            `⚡ Tiempo total: ${totalTime}ms | Latencia ultra-baja`;
                        document.getElementById('rpcResult').innerHTML =
                            `<i class="fas fa-bolt"></i> gRPC completa la llamada RPC en <strong>${totalTime}ms</strong> con serialización binaria`;
                        return;
                    }

                    const step = steps[currentStep];

                    // Dibujar paso
                    ctx.fillStyle = step.color + '30';
                    ctx.fillRect(20, step.y - 20, width - 40, 50);
                    ctx.strokeStyle = step.color;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(20, step.y - 20, width - 40, 50);

                    // Título del paso
                    ctx.fillStyle = step.color;
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(step.name, 30, step.y - 5);

                    // Descripción
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '10px Arial';
                    ctx.fillText(step.desc, 30, step.y + 10);

                    // Tiempo
                    ctx.fillStyle = '#fbbf24';
                    ctx.font = 'bold 9px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${step.time}ms`, width - 30, step.y + 5);

                    // Animación de flujo
                    if (currentStep === 2) {
                        // HTTP/2 Stream - mostrar paquete viajando
                        let progress = 0;
                        const streamInterval = setInterval(() => {
                            progress += 10;
                            if (progress > 100) {
                                clearInterval(streamInterval);
                                return;
                            }

                            const x = clientX + ((serverX - clientX) * progress) / 100;

                            ctx.clearRect(clientX + 30, step.y + 15, serverX - clientX - 60, 15);

                            // Línea de conexión
                            ctx.strokeStyle = step.color;
                            ctx.lineWidth = 2;
                            ctx.beginPath();
                            ctx.moveTo(clientX + 30, step.y + 22);
                            ctx.lineTo(x, step.y + 22);
                            ctx.stroke();

                            // Paquete
                            ctx.fillStyle = step.color;
                            ctx.fillRect(x - 8, step.y + 18, 16, 8);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '8px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('📦', x, step.y + 24);
                        }, 20);
                    } else if (currentStep === 5) {
                        // Respuesta - paquete regresando
                        let progress = 0;
                        const responseInterval = setInterval(() => {
                            progress += 10;
                            if (progress > 100) {
                                clearInterval(responseInterval);
                                return;
                            }

                            const x = serverX - ((serverX - clientX) * progress) / 100;

                            ctx.clearRect(clientX + 30, step.y + 15, serverX - clientX - 60, 15);

                            // Línea de conexión
                            ctx.strokeStyle = step.color;
                            ctx.lineWidth = 2;
                            ctx.beginPath();
                            ctx.moveTo(serverX - 30, step.y + 22);
                            ctx.lineTo(x, step.y + 22);
                            ctx.stroke();

                            // Paquete
                            ctx.fillStyle = step.color;
                            ctx.fillRect(x - 8, step.y + 18, 16, 8);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '8px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('√', x, step.y + 24);
                        }, 20);
                    }

                    totalTime += step.time;
                    currentStep++;

                    document.getElementById('rpcInfo').textContent =
                        `⚡ Paso ${currentStep}/${steps.length} | Tiempo: ${totalTime}ms`;
                }, 600);
            }

            // ===== DEMO 2: PAYLOAD COMPARISON - JSON vs Protobuf =====
            function runPayloadComparisonDemo() {
                const userData = {
                    id: 12345,
                    name: 'Juan Pérez',
                    email: 'juan.perez@example.com',
                    age: 28,
                    active: true,
                    roles: ['user', 'admin'],
                    created_at: '2024-01-15T10:30:00Z',
                    metadata: {
                        last_login: '2024-11-08T14:22:00Z',
                        login_count: 156
                    }
                };

                animateJsonPayload(userData);
                setTimeout(() => animateProtobufPayload(userData), 100);
            }

            function animateJsonPayload(data) {
                const canvas = document.getElementById('jsonCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // JSON string
                const jsonStr = JSON.stringify(data, null, 2);
                const jsonSize = new Blob([jsonStr]).size;

                // Dibujar JSON
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(10, 10, width - 20, height - 20);
                ctx.strokeStyle = '#60a5fa';
                ctx.lineWidth = 2;
                ctx.strokeRect(10, 10, width - 20, height - 20);

                // Contenido JSON
                const lines = jsonStr.split('\n').slice(0, 10);
                ctx.fillStyle = '#e2e8f0';
                ctx.font = '8px monospace';
                ctx.textAlign = 'left';

                lines.forEach((line, i) => {
                    ctx.fillText(line.substring(0, 50), 15, 25 + i * 12);
                });

                if (jsonStr.split('\n').length > 10) {
                    ctx.fillStyle = '#94a3b8';
                    ctx.fillText('...', 15, 25 + 10 * 12);
                }

                // Visualización de bytes
                const bytesPerRow = 20;
                const totalBytes = jsonSize;
                const rows = Math.ceil(totalBytes / bytesPerRow);

                ctx.fillStyle = '#60a5fa';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${totalBytes} bytes`, width / 2, height - 10);

                document.getElementById('jsonSize').textContent =
                    `▭ Tamaño: ${jsonSize} bytes | Texto legible`;
            }

            function animateProtobufPayload(data) {
                const canvas = document.getElementById('protobufCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // Calcular tamaño aproximado de Protobuf (60-70% del JSON)
                const jsonSize = new Blob([JSON.stringify(data)]).size;
                const protobufSize = Math.floor(jsonSize * 0.35); // ~65% reducción

                // Dibujar contenedor
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(10, 10, width - 20, height - 20);
                ctx.strokeStyle = '#4ade80';
                ctx.lineWidth = 2;
                ctx.strokeRect(10, 10, width - 20, height - 20);

                // Representación binaria
                ctx.font = '9px monospace';
                ctx.textAlign = 'left';

                // Generar representación binaria visual
                let y = 25;
                for (let i = 0; i < 8; i++) {
                    let line = '';
                    for (let j = 0; j < 16; j++) {
                        const byte = Math.floor(Math.random() * 256).toString(16).padStart(2, '0');
                        line += byte + ' ';
                    }

                    ctx.fillStyle = '#4ade80';
                    ctx.fillText(line, 15, y);
                    y += 12;
                }

                ctx.fillStyle = '#94a3b8';
                ctx.fillText('...', 15, y);

                // Etiquetas de campos
                ctx.fillStyle = '#fbbf24';
                ctx.font = '8px Arial';
                ctx.textAlign = 'right';
                ctx.fillText('Field 1: id', width - 15, 35);
                ctx.fillText('Field 2: name', width - 15, 50);
                ctx.fillText('Field 3: email', width - 15, 65);
                ctx.fillText('Field 4: age', width - 15, 80);
                ctx.fillText('...', width - 15, 95);

                // Tamaño
                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${protobufSize} bytes`, width / 2, height - 10);

                document.getElementById('protobufSize').textContent =
                    `📦 Tamaño: ${protobufSize} bytes | Binario compacto`;

                // Calcular reducción
                const reduction = ((jsonSize - protobufSize) / jsonSize * 100).toFixed(0);
                const savedBytes = jsonSize - protobufSize;

                document.getElementById('payloadResult').innerHTML =
                    `<i class="fas fa-compress-alt"></i> Protobuf reduce <strong>${reduction}%</strong> el tamaño (${savedBytes} bytes ahorrados)`;
            }
        </script>

        <!-- Slide 7: gRPC Limitaciones -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-exclamation-triangle"></i> gRPC: Limitaciones y
                Trade-offs</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Características -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Más dependencias = más actualizaciones frecuentes"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Complejidad</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Dependencias</strong>: Numerosas</li>
                            <li><strong>Actualizaciones</strong>: Frecuentes</li>
                            <li><strong>Acoplamiento</strong>: Fuerte</li>
                            <li><strong>Debugging</strong>: Complejo</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(248, 113, 113, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid #f87171; flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-exclamation-triangle"></i> HTTP/2 requerido
                        </p>
                    </div>

                    <!-- Pestañas de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="grpc-limit-tab active" data-demo="dependencies"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Dependencias
                        </button>
                        <button class="grpc-limit-tab" data-demo="updates"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Actualizaciones
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startGrpcLimitDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualización -->
                <div id="grpcLimitDemoContainer"
                    style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Dependencias -->
                    <div id="demoDependencies" class="grpc-limit-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-project-diagram"></i> Gráfico de Dependencias
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                                <canvas id="dependenciesCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="dependenciesInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Dependencias: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="dependenciesResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver las dependencias
                            </div>
                        </div>
                    </div>

                    <!-- Demo Actualizaciones -->
                    <div id="demoUpdates" class="grpc-limit-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #fbbf24; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #fbbf24; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-clock"></i> Timeline de Actualizaciones
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="updatesCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="updatesInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #fbbf24;">
                                Frecuencia: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="updatesResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el timeline
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== GRPC LIMITACIONES SIMULACIONES =====
            let currentGrpcLimitDemo = 'dependencies';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos gRPC Limitaciones
                const grpcLimitTabs = document.querySelectorAll('.grpc-limit-tab');
                grpcLimitTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchGrpcLimitDemo(demoType);
                    });
                });

                // Botón iniciar demo gRPC Limitaciones
                const startGrpcLimitDemo = document.getElementById('startGrpcLimitDemo');
                if (startGrpcLimitDemo) {
                    startGrpcLimitDemo.addEventListener('click', function () {
                        if (currentGrpcLimitDemo === 'dependencies') {
                            runDependenciesDemo();
                        } else if (currentGrpcLimitDemo === 'updates') {
                            runUpdatesDemo();
                        }
                    });
                }
            });

            function switchGrpcLimitDemo(demoType) {
                currentGrpcLimitDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.grpc-limit-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.grpc-limit-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: GRÁFICO DE DEPENDENCIAS =====
            function runDependenciesDemo() {
                const canvas = document.getElementById('dependenciesCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const centerX = width / 2;
                const centerY = height / 2;

                // gRPC en el centro
                ctx.fillStyle = '#f87171';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 40, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('gRPC', centerX, centerY - 5);
                ctx.font = '10px Arial';
                ctx.fillText('Core', centerX, centerY + 8);

                // Dependencias
                const dependencies = [
                    { name: 'HTTP/2', color: '#60a5fa', angle: 0 },
                    { name: 'Protobuf', color: '#a78bfa', angle: Math.PI / 4 },
                    { name: 'OpenSSL', color: '#f472b6', angle: Math.PI / 2 },
                    { name: 'c-ares', color: '#fbbf24', angle: 3 * Math.PI / 4 },
                    { name: 'zlib', color: '#4ade80', angle: Math.PI },
                    { name: 'abseil', color: '#fb923c', angle: 5 * Math.PI / 4 },
                    { name: 're2', color: '#14b8a6', angle: 3 * Math.PI / 2 },
                    { name: 'upb', color: '#8b5cf6', angle: 7 * Math.PI / 4 }
                ];

                const radius = 150;
                let currentDep = 0;

                const interval = setInterval(() => {
                    if (currentDep >= dependencies.length) {
                        clearInterval(interval);

                        // Comparación con HTTP/REST
                        ctx.fillStyle = '#4ade80';
                        ctx.beginPath();
                        ctx.arc(centerX + 200, 80, 30, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#ffffff';
                        ctx.font = 'bold 10px Arial';
                        ctx.fillText('HTTP', centerX + 200, 78);
                        ctx.fillText('REST', centerX + 200, 90);

                        // Pocas dependencias
                        ctx.fillStyle = '#22c55e';
                        ctx.beginPath();
                        ctx.arc(centerX + 200, 130, 15, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '8px Arial';
                        ctx.fillText('JSON', centerX + 200, 133);

                        ctx.fillStyle = '#22c55e';
                        ctx.beginPath();
                        ctx.arc(centerX + 240, 100, 15, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#ffffff';
                        ctx.fillText('TLS', centerX + 240, 103);

                        // Líneas
                        ctx.strokeStyle = '#4ade80';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(centerX + 200, 110);
                        ctx.lineTo(centerX + 200, 115);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(centerX + 200, 110);
                        ctx.lineTo(centerX + 230, 100);
                        ctx.stroke();

                        document.getElementById('dependenciesInfo').textContent =
                            `📦 gRPC: ${dependencies.length} deps | HTTP/REST: 2-3 deps`;
                        document.getElementById('dependenciesResult').innerHTML =
                            `<i class="fas fa-exclamation-triangle"></i> gRPC tiene <strong>${dependencies.length - 2}x más dependencias</strong> que HTTP/REST`;
                        return;
                    }

                    const dep = dependencies[currentDep];
                    const x = centerX + Math.cos(dep.angle) * radius;
                    const y = centerY + Math.sin(dep.angle) * radius;

                    // Línea de conexión
                    ctx.strokeStyle = dep.color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();

                    // Nodo de dependencia
                    ctx.fillStyle = dep.color;
                    ctx.beginPath();
                    ctx.arc(x, y, 25, 0, Math.PI * 2);
                    ctx.fill();

                    // Nombre
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 9px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(dep.name, x, y + 3);

                    // Icono de actualización
                    ctx.fillStyle = '#fbbf24';
                    ctx.font = '12px Arial';
                    ctx.fillText('⚠', x + 20, y - 20);

                    currentDep++;

                    document.getElementById('dependenciesInfo').textContent =
                        `▣ Dependencias: ${currentDep}/${dependencies.length}`;
                }, 300);
            }

            // ===== DEMO 2: TIMELINE DE ACTUALIZACIONES =====
            function runUpdatesDemo() {
                const canvas = document.getElementById('updatesCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // Timeline
                const startY = 50;
                const endY = height - 50;
                const lineX = 80;

                // Línea principal
                ctx.strokeStyle = '#94a3b8';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(lineX, startY);
                ctx.lineTo(lineX, endY);
                ctx.stroke();

                // Etiquetas de tiempo
                const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
                const monthHeight = (endY - startY) / 12;

                months.forEach((month, i) => {
                    const y = startY + i * monthHeight;

                    ctx.fillStyle = '#94a3b8';
                    ctx.font = '9px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(month, lineX - 10, y + 3);

                    // Marca
                    ctx.strokeStyle = '#94a3b8';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(lineX - 5, y);
                    ctx.lineTo(lineX + 5, y);
                    ctx.stroke();
                });

                // Actualizaciones de gRPC (frecuentes)
                const grpcUpdates = [
                    { month: 0, type: 'security', desc: 'Security patch' },
                    { month: 1, type: 'minor', desc: 'Minor update' },
                    { month: 2, type: 'security', desc: 'CVE fix' },
                    { month: 3, type: 'major', desc: 'Major release' },
                    { month: 4, type: 'security', desc: 'Security patch' },
                    { month: 5, type: 'minor', desc: 'Bug fixes' },
                    { month: 6, type: 'security', desc: 'CVE fix' },
                    { month: 7, type: 'minor', desc: 'Minor update' },
                    { month: 8, type: 'security', desc: 'Security patch' },
                    { month: 9, type: 'minor', desc: 'Bug fixes' },
                    { month: 10, type: 'security', desc: 'CVE fix' },
                    { month: 11, type: 'major', desc: 'Major release' }
                ];

                let currentUpdate = 0;

                const interval = setInterval(() => {
                    if (currentUpdate >= grpcUpdates.length) {
                        clearInterval(interval);

                        // Comparación con HTTP/REST
                        ctx.fillStyle = '#4ade80';
                        ctx.font = 'bold 11px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText('HTTP/REST: 2-3 actualizaciones/año', lineX + 200, 30);

                        // Pocas actualizaciones
                        [2, 6, 10].forEach((month, i) => {
                            const y = startY + month * monthHeight;
                            ctx.fillStyle = '#4ade80';
                            ctx.beginPath();
                            ctx.arc(lineX + 220, y, 8, 0, Math.PI * 2);
                            ctx.fill();
                        });

                        document.getElementById('updatesInfo').textContent =
                            `📅 gRPC: ${grpcUpdates.length} updates/año | HTTP: 2-3 updates/año`;
                        document.getElementById('updatesResult').innerHTML =
                            `<i class="fas fa-sync-alt"></i> gRPC requiere <strong>4x más actualizaciones</strong> que HTTP/REST`;
                        return;
                    }

                    const update = grpcUpdates[currentUpdate];
                    const y = startY + update.month * monthHeight;

                    // Color según tipo
                    let color;
                    if (update.type === 'security') color = '#f87171';
                    else if (update.type === 'major') color = '#fbbf24';
                    else color = '#60a5fa';

                    // Punto en timeline
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(lineX, y, 10, 0, Math.PI * 2);
                    ctx.fill();

                    // Línea al texto
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(lineX + 10, y);
                    ctx.lineTo(lineX + 30, y);
                    ctx.stroke();

                    // Descripción
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '9px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(update.desc, lineX + 35, y + 3);

                    // Icono según tipo
                    ctx.font = '10px Arial';
                    if (update.type === 'security') {
                        ctx.fillText('⊠', lineX + 120, y + 3);
                    } else if (update.type === 'major') {
                        ctx.fillText('▲', lineX + 120, y + 3);
                    } else {
                        ctx.fillText('🔧', lineX + 120, y + 3);
                    }

                    currentUpdate++;

                    document.getElementById('updatesInfo').textContent =
                        `📅 Actualizaciones: ${currentUpdate}/${grpcUpdates.length} en el año`;
                }, 250);
            }
        </script>

        <!-- Slide 8: JSON -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-file-code"></i> JSON: Formato de Serialización Popular
            </h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Características -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "API REST pública para partners del Banco de Loja"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Ventajas</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Legible</strong>: Human-readable</li>
                            <li><strong>Simple</strong>: Fácil de usar</li>
                            <li><strong>Universal</strong>: Amplio soporte</li>
                            <li><strong>Compacto</strong>: Más que XML</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> API pública y app móvil
                        </p>
                    </div>

                    <!-- Pestañas de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="json-tab active" data-demo="editor"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Editor
                        </button>
                        <button class="json-tab" data-demo="validation"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Validación
                        </button>
                        <button class="json-tab" data-demo="json-codigo"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Código
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startJsonDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualización -->
                <div id="jsonDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Editor -->
                    <div id="demoEditor" class="json-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-code"></i> Editor JSON Interactivo
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="jsonEditorCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="jsonEditorInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa;">
                                Tamaño: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="jsonEditorResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el editor
                            </div>
                        </div>
                    </div>

                    <!-- Demo Validación -->
                    <div id="demoValidation" class="json-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-times-circle"></i> JSON Inválido
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="jsonInvalidCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="jsonInvalidInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Error: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-check-circle"></i> JSON Válido
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="jsonValidCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="jsonValidInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Estado: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="jsonValidationResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver la validación
                            </div>
                        </div>
                    </div>

                    <!-- Demo Código -->
                    <div id="demoCodigo" class="json-demo-content"
                        style="display: none; flex-direction: column; gap: 10px; height: 100%;">
                        <div class="code-subtabs-container"
                            style="display: flex; gap: 8px; padding: 8px; background: rgba(15, 20, 25, 0.4); border-radius: 8px;">
                            <button class="json-code-subtab active" data-subtab="schema"
                                style="flex: 1; padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-size: 0.75rem; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                                Schema
                            </button>
                            <button class="json-code-subtab" data-subtab="validador"
                                style="flex: 1; padding: 8px 12px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 6px; font-size: 0.75rem; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                                Validador
                            </button>
                            <button class="json-code-subtab" data-subtab="api"
                                style="flex: 1; padding: 8px 12px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 6px; font-size: 0.75rem; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                                API
                            </button>
                        </div>

                        <!-- Schema Definition -->
                        <div id="jsonCodeSchema" class="json-code-content"
                            style="display: flex; flex: 1; min-height: 0;">
                            <div class="code-container" style="flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                                <div class="code-header">
                                    <span class="code-filename">transaccion.schema.json</span>
                                    <button class="code-copy-btn" onclick="copyCode(this)">
                                        <i class="fas fa-copy"></i> Copiar
                                    </button>
                                </div>
                                <div style="flex: 1; overflow-y: auto;">
                                    <pre style="margin: 0;"><code class="language-json">{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://bancodeloja.fin.ec/schemas/transaccion.json",
  "title": "Transacción Bancaria",
  "description": "Esquema de validación para transacciones del Banco de Loja",
  "type": "object",
  "required": ["id", "tipo", "origen", "destino", "monto", "fecha"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^TXN-[0-9]{10}$",
      "description": "Identificador único de transacción"
    },
    "tipo": {
      "type": "string",
      "enum": ["transferencia", "pago", "retiro", "deposito"],
      "description": "Tipo de operación bancaria"
    },
    "origen": {
      "type": "object",
      "required": ["cuenta", "titular"],
      "properties": {
        "cuenta": {
          "type": "string",
          "pattern": "^[0-9]{10}$",
          "description": "Número de cuenta de 10 dígitos"
        },
        "titular": {
          "type": "string",
          "minLength": 3,
          "maxLength": 100
        },
        "banco": {
          "type": "string",
          "default": "Banco de Loja"
        }
      }
    },
    "destino": {
      "type": "object",
      "required": ["cuenta", "titular"],
      "properties": {
        "cuenta": {
          "type": "string",
          "pattern": "^[0-9]{10}$"
        },
        "titular": {
          "type": "string",
          "minLength": 3,
          "maxLength": 100
        },
        "banco": {
          "type": "string"
        }
      }
    },
    "monto": {
      "type": "number",
      "minimum": 0.01,
      "maximum": 50000,
      "multipleOf": 0.01,
      "description": "Monto en USD, máximo $50,000"
    },
    "fecha": {
      "type": "string",
      "format": "date-time",
      "description": "Fecha y hora en formato ISO 8601"
    },
    "descripcion": {
      "type": "string",
      "maxLength": 500
    },
    "metadata": {
      "type": "object",
      "properties": {
        "ip": {
          "type": "string",
          "format": "ipv4"
        },
        "dispositivo": {
          "type": "string"
        },
        "geolocalizacion": {
          "type": "object",
          "properties": {
            "lat": { "type": "number", "minimum": -90, "maximum": 90 },
            "lon": { "type": "number", "minimum": -180, "maximum": 180 }
          }
        }
      }
    }
  }
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Validador -->
                        <div id="jsonCodeValidador" class="json-code-content"
                            style="display: none; flex: 1; min-height: 0;">
                            <div class="code-container" style="flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                                <div class="code-header">
                                    <span class="code-filename">validador.js</span>
                                    <button class="code-copy-btn" onclick="copyCode(this)">
                                        <i class="fas fa-copy"></i> Copiar
                                    </button>
                                </div>
                                <div style="flex: 1; overflow-y: auto;">
                                    <pre style="margin: 0;"><code class="language-javascript">import Ajv from 'ajv';
import addFormats from 'ajv-formats';
import { readFile } from 'fs/promises';

class ValidadorTransacciones {
  #ajv;
  #schema;
  #validador;

  constructor() {
    this.#ajv = new Ajv({
      allErrors: true,
      verbose: true,
      strict: false,
      coerceTypes: false
    });
    addFormats(this.#ajv);
  }

  async cargarSchema(rutaSchema) {
    const contenido = await readFile(rutaSchema, 'utf-8');
    this.#schema = JSON.parse(contenido);
    this.#validador = this.#ajv.compile(this.#schema);
    console.log('Schema cargado correctamente');
  }

  validar(transaccion) {
    const valido = this.#validador(transaccion);

    if (valido) {
      return {
        valido: true,
        mensaje: 'Transacción válida'
      };
    }

    const errores = this.#validador.errors?.map(error => ({
      campo: error.instancePath || error.params?.missingProperty,
      tipo: error.keyword,
      mensaje: error.message,
      valorActual: error.data
    })) ?? [];

    return {
      valido: false,
      errores,
      mensaje: `Validación fallida: ${errores.length} error(es) encontrado(s)`
    };
  }

  async validarLote(transacciones) {
    const resultados = {
      total: transacciones.length,
      validas: 0,
      invalidas: 0,
      detalles: []
    };

    for (const [index, transaccion] of transacciones.entries()) {
      const resultado = this.validar(transaccion);

      if (resultado.valido) {
        resultados.validas++;
      } else {
        resultados.invalidas++;
        resultados.detalles.push({
          indice: index,
          id: transaccion?.id ?? 'sin-id',
          errores: resultado.errores
        });
      }
    }

    return resultados;
  }
}

// Ejemplo de uso
const validador = new ValidadorTransacciones();
await validador.cargarSchema('./transaccion.schema.json');

// Transacción válida
const transaccionValida = {
  id: 'TXN-1234567890',
  tipo: 'transferencia',
  origen: {
    cuenta: '1234567890',
    titular: 'Juan Pérez'
  },
  destino: {
    cuenta: '0987654321',
    titular: 'María García',
    banco: 'Banco Pichincha'
  },
  monto: 150.50,
  fecha: new Date().toISOString(),
  descripcion: 'Pago de servicios'
};

const resultado1 = validador.validar(transaccionValida);
console.log('Resultado:', resultado1);

// Transacción inválida
const transaccionInvalida = {
  id: 'TXN-123',
  tipo: 'hackeo',
  origen: { cuenta: '123', titular: 'X' },
  monto: -500
};

const resultado2 = validador.validar(transaccionInvalida);
console.log('Errores encontrados:', resultado2.errores?.length ?? 0);</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- API Integration -->
                        <div id="jsonCodeApi" class="json-code-content"
                            style="display: none; flex: 1; min-height: 0;">
                            <div class="code-container" style="flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                                <div class="code-header">
                                    <span class="code-filename">api-transacciones.js</span>
                                    <button class="code-copy-btn" onclick="copyCode(this)">
                                        <i class="fas fa-copy"></i> Copiar
                                    </button>
                                </div>
                                <div style="flex: 1; overflow-y: auto;">
                                    <pre style="margin: 0;"><code class="language-javascript">import express from 'express';
import { ValidadorTransacciones } from './validador.js';

class APITransacciones {
  #app;
  #validador;
  #puerto;

  constructor(puerto = 3000) {
    this.#app = express();
    this.#validador = new ValidadorTransacciones();
    this.#puerto = puerto;

    this.#configurarMiddleware();
    this.#configurarRutas();
  }

  #configurarMiddleware() {
    this.#app.use(express.json());

    this.#app.use((err, req, res, next) => {
      if (err instanceof SyntaxError && err.status === 400) {
        return res.status(400).json({
          error: 'JSON inválido',
          mensaje: err.message
        });
      }
      next();
    });
  }

  #configurarRutas() {
    this.#app.post('/api/transacciones', async (req, res) => {
      try {
        const resultado = this.#validador.validar(req.body);

        if (!resultado.valido) {
          return res.status(400).json({
            error: 'Validación fallida',
            detalles: resultado.errores
          });
        }

        const transaccionProcesada = await this.#procesarTransaccion(req.body);

        res.status(201).json({
          mensaje: 'Transacción procesada exitosamente',
          id: transaccionProcesada.id,
          estado: 'completada',
          timestamp: new Date().toISOString()
        });
      } catch (error) {
        console.error('Error procesando transacción:', error);
        res.status(500).json({
          error: 'Error interno del servidor',
          mensaje: error?.message ?? 'Error desconocido'
        });
      }
    });

    this.#app.post('/api/transacciones/lote', async (req, res) => {
      try {
        const { transacciones } = req.body;

        if (!Array.isArray(transacciones)) {
          return res.status(400).json({
            error: 'El campo "transacciones" debe ser un array'
          });
        }

        const resultados = await this.#validador.validarLote(transacciones);

        res.json({
          mensaje: 'Validación de lote completada',
          resumen: {
            total: resultados.total,
            validas: resultados.validas,
            invalidas: resultados.invalidas,
            tasa_exito: ((resultados.validas / resultados.total) * 100).toFixed(2) + '%'
          },
          errores: resultados.detalles
        });
      } catch (error) {
        res.status(500).json({
          error: 'Error procesando lote',
          mensaje: error?.message ?? 'Error desconocido'
        });
      }
    });

    this.#app.get('/api/schema', (req, res) => {
      res.json(this.#validador.obtenerSchema());
    });
  }

  async #procesarTransaccion(transaccion) {
    await new Promise(resolve => setTimeout(resolve, 100));

    return {
      ...transaccion,
      estado: 'completada',
      timestamp_procesamiento: new Date().toISOString()
    };
  }

  async iniciar() {
    await this.#validador.cargarSchema('./transaccion.schema.json');

    this.#app.listen(this.#puerto, () => {
      console.log(`API escuchando en puerto ${this.#puerto}`);
      console.log(`POST /api/transacciones - Procesar transacción`);
      console.log(`POST /api/transacciones/lote - Validar lote`);
      console.log(`GET  /api/schema - Obtener schema`);
    });
  }
}

// Iniciar servidor
const api = new APITransacciones(3000);
await api.iniciar();</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== JSON SIMULACIONES =====
            let currentJsonDemo = 'editor';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos JSON
                const jsonTabs = document.querySelectorAll('.json-tab');
                jsonTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchJsonDemo(demoType);
                    });
                });

                // Botón iniciar demo JSON
                const startJsonDemo = document.getElementById('startJsonDemo');
                if (startJsonDemo) {
                    startJsonDemo.addEventListener('click', function () {
                        if (currentJsonDemo === 'editor') {
                            runJsonEditorDemo();
                        } else if (currentJsonDemo === 'validation') {
                            runJsonValidationDemo();
                        }
                    });
                }

                // Sub-tabs de código JSON
                const jsonCodeSubtabs = document.querySelectorAll('.json-code-subtab');
                jsonCodeSubtabs.forEach(subtab => {
                    subtab.addEventListener('click', function () {
                        const subtabType = this.getAttribute('data-subtab');
                        switchJsonCodeSubtab(subtabType);
                    });
                });
            });

            function switchJsonCodeSubtab(subtabType) {
                // Actualizar botones de sub-tabs
                document.querySelectorAll('.json-code-subtab').forEach(btn => {
                    if (btn.getAttribute('data-subtab') === subtabType) {
                        btn.style.background = 'var(--uide-accent)';
                        btn.style.color = '#0f1419';
                    } else {
                        btn.style.background = 'rgba(255,255,255,0.1)';
                        btn.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.json-code-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeContent = document.getElementById(`jsonCode${subtabType.charAt(0).toUpperCase() + subtabType.slice(1)}`);
                if (activeContent) {
                    activeContent.style.display = 'flex';
                }

                // Resaltar código con Prism
                if (window.Prism) {
                    setTimeout(() => {
                        Prism.highlightAll();
                    }, 10);
                }
            }

            function switchJsonDemo(demoType) {
                currentJsonDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.json-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.json-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: EDITOR JSON INTERACTIVO =====
            function runJsonEditorDemo() {
                const canvas = document.getElementById('jsonEditorCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const jsonData = {
                    "transaction": {
                        "id": "TRX-2024-001234",
                        "accountNumber": "2100456789",
                        "customerName": "María Sánchez",
                        "amount": 150.00,
                        "currency": "USD",
                        "type": "transfer",
                        "branch": "Loja Centro",
                        "timestamp": "2024-11-08T14:30:00-05:00"
                    }
                };

                const jsonStr = JSON.stringify(jsonData, null, 2);
                const lines = jsonStr.split('\n');

                // Dibujar fondo del editor
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                // Barra superior
                ctx.fillStyle = '#2d2d2d';
                ctx.fillRect(0, 0, width, 30);
                ctx.fillStyle = '#60a5fa';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('▭ user.json', 10, 20);

                // Números de línea
                ctx.fillStyle = '#3d3d3d';
                ctx.fillRect(0, 30, 40, height - 30);

                let currentLine = 0;
                const lineHeight = 16;
                const startY = 50;

                const interval = setInterval(() => {
                    if (currentLine >= lines.length) {
                        clearInterval(interval);

                        const size = new Blob([jsonStr]).size;
                        document.getElementById('jsonEditorInfo').textContent =
                            `▊ Tamaño: ${size} bytes | ${lines.length} líneas`;
                        document.getElementById('jsonEditorResult').innerHTML =
                            `<i class="fas fa-check"></i> JSON parseado correctamente | <strong>Human-readable</strong> y fácil de editar`;
                        return;
                    }

                    const line = lines[currentLine];
                    const y = startY + currentLine * lineHeight;

                    // Número de línea
                    ctx.fillStyle = '#858585';
                    ctx.font = '10px monospace';
                    ctx.textAlign = 'right';
                    ctx.fillText((currentLine + 1).toString(), 35, y);

                    // Contenido de la línea con syntax highlighting
                    ctx.textAlign = 'left';
                    let x = 50;

                    // Detectar tipo de contenido
                    if (line.includes('{') || line.includes('}') || line.includes('[') || line.includes(']')) {
                        ctx.fillStyle = '#ffd700';
                        ctx.fillText(line, x, y);
                    } else if (line.includes(':')) {
                        // Separar key y value
                        const parts = line.split(':');

                        // Key (propiedad)
                        ctx.fillStyle = '#9cdcfe';
                        ctx.fillText(parts[0], x, y);
                        x += ctx.measureText(parts[0]).width;

                        // :
                        ctx.fillStyle = '#ffffff';
                        ctx.fillText(':', x, y);
                        x += ctx.measureText(':').width;

                        // Value
                        const value = parts[1];
                        if (value.includes('"')) {
                            ctx.fillStyle = '#ce9178'; // String
                        } else if (value.includes('true') || value.includes('false')) {
                            ctx.fillStyle = '#569cd6'; // Boolean
                        } else if (!isNaN(value.trim().replace(',', ''))) {
                            ctx.fillStyle = '#b5cea8'; // Number
                        } else {
                            ctx.fillStyle = '#ffffff';
                        }
                        ctx.fillText(value, x, y);
                    } else {
                        ctx.fillStyle = '#d4d4d4';
                        ctx.fillText(line, x, y);
                    }

                    currentLine++;

                    document.getElementById('jsonEditorInfo').textContent =
                        `📝 Parseando línea ${currentLine}/${lines.length}...`;
                }, 100);
            }

            // ===== DEMO 2: VALIDACIÓN JSON =====
            function runJsonValidationDemo() {
                animateInvalidJson();
                setTimeout(() => animateValidJson(), 100);
            }

            function animateInvalidJson() {
                const canvas = document.getElementById('jsonInvalidCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // JSON con error (falta comilla de cierre)
                const invalidJson = `{
  "name": "Test,
  "value": 123
}`;

                const lines = invalidJson.split('\n');

                // Fondo
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                // Números de línea
                ctx.fillStyle = '#3d3d3d';
                ctx.fillRect(0, 0, 40, height);

                lines.forEach((line, i) => {
                    const y = 20 + i * 20;

                    // Número de línea
                    ctx.fillStyle = '#858585';
                    ctx.font = '10px monospace';
                    ctx.textAlign = 'right';
                    ctx.fillText((i + 1).toString(), 35, y);

                    // Línea de código
                    ctx.textAlign = 'left';
                    ctx.fillStyle = '#d4d4d4';
                    ctx.fillText(line, 50, y);

                    // Marcar error en línea 2
                    if (i === 1) {
                        // Subrayado rojo
                        ctx.strokeStyle = '#f87171';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(50, y + 3);
                        ctx.lineTo(50 + ctx.measureText(line).width, y + 3);
                        ctx.stroke();

                        // Icono de error
                        ctx.fillStyle = '#f87171';
                        ctx.font = '12px Arial';
                        ctx.fillText('×', width - 30, y);
                    }
                });

                // Mensaje de error
                ctx.fillStyle = '#f87171';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('⚠ SyntaxError: Unexpected token', 50, 120);
                ctx.font = '9px Arial';
                ctx.fillText('Línea 2: Falta comilla de cierre en "Test', 50, 135);

                document.getElementById('jsonInvalidInfo').textContent =
                    `❌ Error en línea 2 | Sintaxis incorrecta`;
            }

            function animateValidJson() {
                const canvas = document.getElementById('jsonValidCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // JSON válido
                const validJson = `{
  "name": "Test",
  "value": 123
}`;

                const lines = validJson.split('\n');

                // Fondo
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                // Números de línea
                ctx.fillStyle = '#3d3d3d';
                ctx.fillRect(0, 0, 40, height);

                lines.forEach((line, i) => {
                    const y = 20 + i * 20;

                    // Número de línea
                    ctx.fillStyle = '#858585';
                    ctx.font = '10px monospace';
                    ctx.textAlign = 'right';
                    ctx.fillText((i + 1).toString(), 35, y);

                    // Línea de código con syntax highlighting
                    ctx.textAlign = 'left';
                    if (line.includes('"name"') || line.includes('"value"')) {
                        ctx.fillStyle = '#9cdcfe';
                        ctx.fillText(line.substring(0, line.indexOf(':')), 50, y);
                        ctx.fillStyle = '#ffffff';
                        ctx.fillText(':', 50 + ctx.measureText(line.substring(0, line.indexOf(':'))).width, y);

                        const value = line.substring(line.indexOf(':') + 1);
                        if (value.includes('"')) {
                            ctx.fillStyle = '#ce9178';
                        } else {
                            ctx.fillStyle = '#b5cea8';
                        }
                        ctx.fillText(value, 50 + ctx.measureText(line.substring(0, line.indexOf(':') + 1)).width, y);
                    } else {
                        ctx.fillStyle = '#ffd700';
                        ctx.fillText(line, 50, y);
                    }

                    // Checkmark verde
                    ctx.fillStyle = '#4ade80';
                    ctx.font = '12px Arial';
                    ctx.fillText('√', width - 30, y);
                });

                // Mensaje de éxito
                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('√ JSON valido', 50, 120);
                ctx.font = '9px Arial';
                ctx.fillText('Parseado correctamente | Sin errores de sintaxis', 50, 135);

                // Objeto parseado
                ctx.fillStyle = '#94a3b8';
                ctx.font = '9px monospace';
                ctx.fillText('Objeto: { name: "Test", value: 123 }', 50, 155);

                document.getElementById('jsonValidInfo').textContent =
                    `✅ JSON válido | Parseado correctamente`;

                document.getElementById('jsonValidationResult').innerHTML =
                    `<i class="fas fa-check-circle"></i> Validación en tiempo real detecta errores de sintaxis <strong>inmediatamente</strong>`;
            }
        </script>

        <!-- Slide 9: Protobuf -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-cogs"></i> Protocol Buffers: Serialización Eficiente
            </h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Características -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Esquemas de datos para transacciones bancarias"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Características</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Binario</strong>: Muy compacto</li>
                            <li><strong>Rápido</strong>: Alta velocidad</li>
                            <li><strong>Multiplataforma</strong>: Varios lenguajes</li>
                            <li><strong>Evolución</strong>: Sin ruptura</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Field numbers = compatibilidad
                        </p>
                    </div>

                    <!-- Pestañas de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="protobuf-tab active" data-demo="code"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Código
                        </button>
                        <button class="protobuf-tab" data-demo="evolution"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Evolución
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startProtobufDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                        <div id="protobufControls" style="margin-top: 6px; font-size: 0.75rem;">
                            <label style="color: #e2e8f0;">Lenguaje: </label>
                            <select id="protobufLang"
                                style="padding: 3px; background: rgba(255,255,255,0.1); border: 1px solid var(--uide-accent); color: white; border-radius: 4px; font-size: 0.75rem;">
                                <option value="python">Python</option>
                                <option value="java">Java</option>
                                <option value="go">Go</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Columna Derecha: Visualización -->
                <div id="protobufDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Código -->
                    <div id="demoCode" class="protobuf-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #a78bfa; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #a78bfa; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-file-code"></i> Definición .proto
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="protoDefCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="protoDefInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #a78bfa;">
                                Archivo: user.proto</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-code"></i> Código Generado
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="generatedCodeCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="generatedCodeInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Lenguaje: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="protoCodeResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver la generación de código
                            </div>
                        </div>
                    </div>

                    <!-- Demo Evolución -->
                    <div id="demoEvolution" class="protobuf-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-code-branch"></i> Evolución de Esquema
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="evolutionCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="evolutionInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Versión: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="evolutionResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver la evolución
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== PROTOBUF SIMULACIONES =====
            let currentProtobufDemo = 'code';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos Protobuf
                const protobufTabs = document.querySelectorAll('.protobuf-tab');
                protobufTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchProtobufDemo(demoType);
                    });
                });

                // Botón iniciar demo Protobuf
                const startProtobufDemo = document.getElementById('startProtobufDemo');
                if (startProtobufDemo) {
                    startProtobufDemo.addEventListener('click', function () {
                        if (currentProtobufDemo === 'code') {
                            const lang = document.getElementById('protobufLang').value;
                            runProtobufCodeDemo(lang);
                        } else if (currentProtobufDemo === 'evolution') {
                            runProtobufEvolutionDemo();
                        }
                    });
                }
            });

            function switchProtobufDemo(demoType) {
                currentProtobufDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.protobuf-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.protobuf-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }

                // Mostrar/ocultar controles
                const controlsDiv = document.getElementById('protobufControls');
                if (demoType === 'evolution') {
                    controlsDiv.style.display = 'none';
                } else {
                    controlsDiv.style.display = 'block';
                }
            }

            // ===== DEMO 1: CÓDIGO .PROTO → CÓDIGO GENERADO =====
            function runProtobufCodeDemo(lang) {
                animateProtoDefinition();
                setTimeout(() => animateGeneratedCode(lang), 1000);
            }

            function animateProtoDefinition() {
                const canvas = document.getElementById('protoDefCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const protoCode = [
                    'syntax = "proto3";',
                    '',
                    'message User {',
                    '  int32 id = 1;',
                    '  string name = 2;',
                    '  string email = 3;',
                    '  repeated string roles = 4;',
                    '}'
                ];

                // Fondo
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                let currentLine = 0;
                const lineHeight = 20;

                const interval = setInterval(() => {
                    if (currentLine >= protoCode.length) {
                        clearInterval(interval);
                        document.getElementById('protoDefInfo').textContent =
                            `▭ user.proto | ${protoCode.length} líneas`;
                        return;
                    }

                    const line = protoCode[currentLine];
                    const y = 20 + currentLine * lineHeight;

                    // Syntax highlighting
                    ctx.font = '11px monospace';
                    ctx.textAlign = 'left';

                    if (line.includes('syntax') || line.includes('message')) {
                        ctx.fillStyle = '#c586c0'; // keyword
                        const parts = line.split(' ');
                        let x = 10;
                        parts.forEach((part, i) => {
                            if (i === 0) {
                                ctx.fillStyle = '#c586c0';
                            } else if (part.includes('"')) {
                                ctx.fillStyle = '#ce9178';
                            } else {
                                ctx.fillStyle = '#4ec9b0';
                            }
                            ctx.fillText(part + ' ', x, y);
                            x += ctx.measureText(part + ' ').width;
                        });
                    } else if (line.includes('int32') || line.includes('string') || line.includes('repeated')) {
                        const parts = line.trim().split(' ');
                        let x = 20;
                        parts.forEach((part, i) => {
                            if (i === 0) {
                                ctx.fillStyle = '#4ec9b0'; // type
                            } else if (part.includes('=')) {
                                ctx.fillStyle = '#ffffff';
                            } else if (!isNaN(part.replace(';', ''))) {
                                ctx.fillStyle = '#b5cea8'; // number
                            } else {
                                ctx.fillStyle = '#9cdcfe'; // field name
                            }
                            ctx.fillText(part + ' ', x, y);
                            x += ctx.measureText(part + ' ').width;
                        });

                        // Resaltar field number
                        if (line.includes('=')) {
                            const fieldNum = line.match(/= (\d+)/)[1];
                            ctx.fillStyle = '#fbbf24';
                            ctx.font = 'bold 9px Arial';
                            ctx.fillText(`← Field #${fieldNum}`, width - 80, y);
                        }
                    } else {
                        ctx.fillStyle = '#ffd700';
                        ctx.fillText(line, 10, y);
                    }

                    currentLine++;
                    document.getElementById('protoDefInfo').textContent =
                        `📝 Definiendo línea ${currentLine}/${protoCode.length}...`;
                }, 200);
            }

            function animateGeneratedCode(lang) {
                const canvas = document.getElementById('generatedCodeCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const codeExamples = {
                    python: [
                        'class User(message.Message):',
                        '    id = proto.Field(',
                        '        proto.INT32, number=1',
                        '    )',
                        '    name = proto.Field(',
                        '        proto.STRING, number=2',
                        '    )',
                        '    email = proto.Field(',
                        '        proto.STRING, number=3',
                        '    )'
                    ],
                    java: [
                        'public class User {',
                        '  private int id;',
                        '  private String name;',
                        '  private String email;',
                        '  ',
                        '  public int getId() {',
                        '    return id;',
                        '  }',
                        '  // setters...',
                        '}'
                    ],
                    go: [
                        'type User struct {',
                        '  Id    int32    `protobuf:"1"`',
                        '  Name  string   `protobuf:"2"`',
                        '  Email string   `protobuf:"3"`',
                        '  Roles []string `protobuf:"4"`',
                        '}',
                        '',
                        'func (u *User) GetId() int32 {',
                        '  return u.Id',
                        '}'
                    ]
                };

                const code = codeExamples[lang];

                // Fondo
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                // Título del lenguaje
                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`Generated ${lang.toUpperCase()} Code`, width / 2, 15);

                let currentLine = 0;
                const lineHeight = 18;

                const interval = setInterval(() => {
                    if (currentLine >= code.length) {
                        clearInterval(interval);
                        document.getElementById('generatedCodeInfo').textContent =
                            `✅ ${lang.toUpperCase()} | ${code.length} líneas generadas`;
                        document.getElementById('protoCodeResult').innerHTML =
                            `<i class="fas fa-magic"></i> Protoc genera código <strong>type-safe</strong> automáticamente para ${lang}`;
                        return;
                    }

                    const line = code[currentLine];
                    const y = 35 + currentLine * lineHeight;

                    // Syntax highlighting básico
                    ctx.font = '10px monospace';
                    ctx.textAlign = 'left';

                    if (line.includes('class') || line.includes('public') || line.includes('type') || line.includes('func')) {
                        ctx.fillStyle = '#c586c0';
                    } else if (line.includes('int') || line.includes('string') || line.includes('String')) {
                        ctx.fillStyle = '#4ec9b0';
                    } else if (line.includes('return')) {
                        ctx.fillStyle = '#c586c0';
                    } else {
                        ctx.fillStyle = '#d4d4d4';
                    }

                    ctx.fillText(line, 10, y);

                    currentLine++;
                    document.getElementById('generatedCodeInfo').textContent =
                        `⚙️ Generando ${lang}... ${currentLine}/${code.length}`;
                }, 150);
            }

            // ===== DEMO 2: EVOLUCIÓN DE ESQUEMA =====
            function runProtobufEvolutionDemo() {
                const canvas = document.getElementById('evolutionCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const versions = [
                    {
                        version: 'v1.0',
                        code: [
                            'message User {',
                            '  int32 id = 1;',
                            '  string name = 2;',
                            '}'
                        ],
                        color: '#60a5fa',
                        y: 50
                    },
                    {
                        version: 'v2.0',
                        code: [
                            'message User {',
                            '  int32 id = 1;',
                            '  string name = 2;',
                            '  string email = 3;  // ← Nuevo campo',
                            '}'
                        ],
                        color: '#fbbf24',
                        y: 180
                    },
                    {
                        version: 'v3.0',
                        code: [
                            'message User {',
                            '  int32 id = 1;',
                            '  string name = 2;',
                            '  string email = 3;',
                            '  repeated string roles = 4;  // ← Nuevo',
                            '}'
                        ],
                        color: '#4ade80',
                        y: 310
                    }
                ];

                let currentVersion = 0;

                const interval = setInterval(() => {
                    if (currentVersion >= versions.length) {
                        clearInterval(interval);

                        // Dibujar flechas de compatibilidad
                        ctx.strokeStyle = '#22c55e';
                        ctx.lineWidth = 3;
                        ctx.setLineDash([5, 5]);

                        // v1 → v2
                        ctx.beginPath();
                        ctx.moveTo(width / 2, 120);
                        ctx.lineTo(width / 2, 180);
                        ctx.stroke();

                        // v2 → v3
                        ctx.beginPath();
                        ctx.moveTo(width / 2, 250);
                        ctx.lineTo(width / 2, 310);
                        ctx.stroke();

                        ctx.setLineDash([]);

                        // Etiquetas de compatibilidad
                        ctx.fillStyle = '#22c55e';
                        ctx.font = 'bold 10px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('√ Compatible', width / 2 + 60, 150);
                        ctx.fillText('√ Compatible', width / 2 + 60, 280);

                        document.getElementById('evolutionInfo').textContent =
                            `√ 3 versiones | Compatibilidad retroactiva`;
                        document.getElementById('evolutionResult').innerHTML =
                            `<i class="fas fa-code-branch"></i> Field numbers permiten <strong>evolución sin ruptura</strong> - clientes antiguos siguen funcionando`;
                        return;
                    }

                    const ver = versions[currentVersion];

                    // Caja de versión
                    ctx.fillStyle = ver.color + '30';
                    ctx.fillRect(20, ver.y, width - 40, 100);
                    ctx.strokeStyle = ver.color;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(20, ver.y, width - 40, 100);

                    // Etiqueta de versión
                    ctx.fillStyle = ver.color;
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(ver.version, 30, ver.y + 20);

                    // Código
                    ctx.font = '10px monospace';
                    ctx.fillStyle = '#ffffff';
                    ver.code.forEach((line, i) => {
                        const y = ver.y + 40 + i * 15;

                        if (line.includes('// ←')) {
                            const parts = line.split('// ←');
                            ctx.fillStyle = '#d4d4d4';
                            ctx.fillText(parts[0], 35, y);
                            ctx.fillStyle = '#22c55e';
                            ctx.font = 'bold 10px Arial';
                            ctx.fillText('// ← ' + parts[1], 35 + ctx.measureText(parts[0]).width, y);
                            ctx.font = '10px monospace';
                        } else {
                            ctx.fillStyle = '#d4d4d4';
                            ctx.fillText(line, 35, y);
                        }

                        // Resaltar field numbers
                        if (line.includes('=')) {
                            const match = line.match(/= (\d+)/);
                            if (match) {
                                ctx.fillStyle = '#fbbf24';
                                ctx.fillRect(canvas.width - 60, y - 10, 20, 12);
                                ctx.fillStyle = '#0f1419';
                                ctx.font = 'bold 9px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText(match[1], canvas.width - 50, y);
                                ctx.textAlign = 'left';
                                ctx.font = '10px monospace';
                            }
                        }
                    });

                    currentVersion++;
                    document.getElementById('evolutionInfo').textContent =
                        `📦 Versión ${ver.version} | ${currentVersion}/3`;
                }, 1200);
            }
        </script>

        <!-- Slide 10: Protobuf Código -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-code"></i> Protobuf: Compilador y FieldMask</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Características -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Generación de código para backend Python y sistemas legacy Java"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Proceso</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Definición</strong>: .proto</li>
                            <li><strong>Compilación</strong>: protoc</li>
                            <li><strong>Generación</strong>: Stubs</li>
                            <li><strong>Integración</strong>: Código</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Optimiza respuestas móviles
                        </p>
                    </div>

                    <!-- Pestañas de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="protoc-tab active" data-demo="compiler"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Compilador
                        </button>
                        <button class="protoc-tab" data-demo="fieldmask"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            FieldMask
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startProtocDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualización -->
                <div id="protocDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Compilador -->
                    <div id="demoCompiler" class="protoc-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-cogs"></i> Flujo del Compilador protoc
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                                <canvas id="compilerFlowCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="compilerFlowInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Paso: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="compilerFlowResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el flujo de compilación
                            </div>
                        </div>
                    </div>

                    <!-- Demo FieldMask -->
                    <div id="demoFieldmask" class="protoc-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column; min-height: 0;">
                            <h3
                                style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem; flex-shrink: 0;">
                                <i class="fas fa-filter"></i> FieldMask Interactivo
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; min-height: 0; display: flex; flex-direction: column;">
                                <div style="margin-bottom: 15px; flex-shrink: 0;">
                                    <p style="color: #e2e8f0; font-size: 0.85rem; margin-bottom: 10px;">
                                        <strong>Selecciona los campos que deseas recibir:</strong>
                                    </p>
                                    <div id="fieldMaskCheckboxes"
                                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="id" checked
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>id</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="name" checked
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>name</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="email"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>email</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="age"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>age</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="roles"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>roles</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="metadata.created"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>metadata.created</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px; grid-column: span 2;">
                                            <input type="checkbox" class="field-checkbox" value="metadata.lastLogin"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>metadata.lastLogin</span>
                                        </label>
                                    </div>
                                </div>
                                <div style="flex: 1; min-height: 0; position: relative;">
                                    <canvas id="fieldMaskCanvas" style="display: block; width: 100%;"></canvas>
                                </div>
                            </div>
                            <div id="fieldMaskInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa; flex-shrink: 0;">
                                Campos seleccionados: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="fieldMaskResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para aplicar FieldMask
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== PROTOC SIMULACIONES =====
            let currentProtocDemo = 'compiler';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos Protoc
                const protocTabs = document.querySelectorAll('.protoc-tab');
                protocTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchProtocDemo(demoType);
                    });
                });

                // Botón iniciar demo
                const startProtocDemo = document.getElementById('startProtocDemo');
                if (startProtocDemo) {
                    startProtocDemo.addEventListener('click', function () {
                        if (currentProtocDemo === 'compiler') {
                            runCompilerFlowDemo();
                        } else if (currentProtocDemo === 'fieldmask') {
                            runFieldMaskDemo();
                        }
                    });
                }

                // Checkboxes de FieldMask - actualizar automáticamente
                const checkboxes = document.querySelectorAll('.field-checkbox');
                checkboxes.forEach(cb => {
                    cb.addEventListener('change', function () {
                        if (currentProtocDemo === 'fieldmask') {
                            runFieldMaskDemo();
                        }
                    });
                });
            });

            // ===== DEMO 1: FLUJO DEL COMPILADOR ANIMADO =====
            function runCompilerFlowDemo() {
                const canvas = document.getElementById('compilerFlowCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const steps = [
                    {
                        name: '▭ user.proto',
                        desc: 'Definición del esquema',
                        color: '#a78bfa',
                        x: width / 2,
                        y: 60
                    },
                    {
                        name: '⚙ protoc',
                        desc: 'Compilador Protocol Buffers',
                        color: '#fbbf24',
                        x: width / 2,
                        y: 180
                    },
                    {
                        name: '◈ user_pb2.py',
                        desc: 'Código Python',
                        color: '#60a5fa',
                        x: width / 2 - 150,
                        y: 320
                    },
                    {
                        name: '◉ User.java',
                        desc: 'Código Java',
                        color: '#f472b6',
                        x: width / 2,
                        y: 320
                    },
                    {
                        name: '🔷 user.pb.go',
                        desc: 'Código Go',
                        color: '#22c55e',
                        x: width / 2 + 150,
                        y: 320
                    }
                ];

                let currentStep = 0;

                const interval = setInterval(() => {
                    if (currentStep >= steps.length) {
                        clearInterval(interval);

                        // Dibujar flechas finales
                        ctx.strokeStyle = '#4ade80';
                        ctx.lineWidth = 3;
                        ctx.setLineDash([]);

                        // user.proto → protoc
                        drawArrow(ctx, steps[0].x, steps[0].y + 40, steps[1].x, steps[1].y - 40, '#4ade80');

                        // protoc → outputs
                        drawArrow(ctx, steps[1].x, steps[1].y + 40, steps[2].x, steps[2].y - 40, '#60a5fa');
                        drawArrow(ctx, steps[1].x, steps[1].y + 40, steps[3].x, steps[3].y - 40, '#f472b6');
                        drawArrow(ctx, steps[1].x, steps[1].y + 40, steps[4].x, steps[4].y - 40, '#22c55e');

                        document.getElementById('compilerFlowInfo').textContent =
                            `✅ Compilación completa | 3 lenguajes generados`;
                        document.getElementById('compilerFlowResult').innerHTML =
                            `<i class="fas fa-magic"></i> protoc genera <strong>código type-safe</strong> automáticamente para múltiples lenguajes`;
                        return;
                    }

                    const step = steps[currentStep];

                    // Dibujar nodo
                    ctx.fillStyle = step.color;
                    ctx.beginPath();
                    ctx.roundRect(step.x - 80, step.y - 30, 160, 60, 10);
                    ctx.fill();

                    // Borde
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Nombre
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(step.name, step.x, step.y - 5);

                    // Descripción
                    ctx.font = '10px Arial';
                    ctx.fillText(step.desc, step.x, step.y + 12);

                    // Dibujar flecha desde el paso anterior
                    if (currentStep > 0) {
                        const prevStep = steps[currentStep - 1];
                        if (currentStep === 1) {
                            // user.proto → protoc
                            drawArrow(ctx, prevStep.x, prevStep.y + 40, step.x, step.y - 40, '#4ade80');
                        } else if (currentStep >= 2) {
                            // protoc → outputs
                            drawArrow(ctx, steps[1].x, steps[1].y + 40, step.x, step.y - 40, step.color);
                        }
                    }

                    currentStep++;

                    document.getElementById('compilerFlowInfo').textContent =
                        `⚙️ Paso ${currentStep}/${steps.length} | Generando código...`;
                }, 600);
            }

            function drawArrow(ctx, x1, y1, x2, y2, color) {
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.setLineDash([]);

                // Línea
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();

                // Punta de flecha
                const angle = Math.atan2(y2 - y1, x2 - x1);
                const arrowSize = 12;

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(
                    x2 - arrowSize * Math.cos(angle - Math.PI / 6),
                    y2 - arrowSize * Math.sin(angle - Math.PI / 6)
                );
                ctx.lineTo(
                    x2 - arrowSize * Math.cos(angle + Math.PI / 6),
                    y2 - arrowSize * Math.sin(angle + Math.PI / 6)
                );
                ctx.closePath();
                ctx.fill();
            }

            function switchProtocDemo(demoType) {
                currentProtocDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.protoc-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.protoc-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }

                // Mostrar/ocultar botón según demo
                const applyBtn = document.getElementById('applyFieldMask');
                if (applyBtn) {
                    applyBtn.style.display = demoType === 'fieldmask' ? 'block' : 'none';
                }

                // Renderizar Mermaid si es la demo del compilador
                if (demoType === 'compiler') {
                    setTimeout(() => {
                        const mermaidDiv = document.querySelector('#demoCompiler .mermaid');
                        if (mermaidDiv && !mermaidDiv.getAttribute('data-processed')) {
                            mermaid.init(undefined, mermaidDiv);
                        }
                    }, 100);
                }
            }

            // ===== DEMO 2: FIELDMASK INTERACTIVO =====
            function runFieldMaskDemo() {
                const canvas = document.getElementById('fieldMaskCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 10);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // Obtener campos seleccionados
                const checkboxes = document.querySelectorAll('.field-checkbox');
                const selectedFields = [];
                checkboxes.forEach(cb => {
                    if (cb.checked) {
                        selectedFields.push(cb.value);
                    }
                });

                // Objeto completo
                const fullUser = {
                    id: 12345,
                    name: "Carlos Jiménez",
                    email: "carlos.jimenez@example.com",
                    age: 35,
                    roles: ["customer", "premium"],
                    metadata: {
                        created: "2024-01-15",
                        lastLogin: "2024-11-08"
                    }
                };

                // Objeto filtrado
                const filteredUser = {};
                selectedFields.forEach(field => {
                    if (field.includes('.')) {
                        const parts = field.split('.');
                        if (!filteredUser[parts[0]]) filteredUser[parts[0]] = {};
                        filteredUser[parts[0]][parts[1]] = fullUser[parts[0]][parts[1]];
                    } else {
                        filteredUser[field] = fullUser[field];
                    }
                });

                // Dibujar request
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, 90);
                ctx.strokeStyle = '#60a5fa';
                ctx.lineWidth = 2;
                ctx.strokeRect(0, 0, width, 90);

                ctx.fillStyle = '#60a5fa';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('📤 Request con FieldMask:', 10, 15);

                ctx.fillStyle = '#ffffff';
                ctx.font = '9px monospace';
                ctx.fillText('{', 10, 30);
                ctx.fillText('  "fieldMask": "' + selectedFields.join(',') + '",', 10, 45);
                ctx.fillText('  "userId": 12345', 10, 60);
                ctx.fillText('}', 10, 75);

                // Dibujar response
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 100, width, 100);
                ctx.strokeStyle = '#4ade80';
                ctx.lineWidth = 2;
                ctx.strokeRect(0, 100, width, 100);

                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 11px Arial';
                ctx.fillText('📥 Response (solo campos solicitados):', 10, 115);

                ctx.fillStyle = '#ffffff';
                ctx.font = '9px monospace';
                const responseJson = JSON.stringify(filteredUser, null, 2);
                const lines = responseJson.split('\n').slice(0, 5);
                lines.forEach((line, i) => {
                    ctx.fillText(line, 10, 130 + i * 12);
                });
                if (responseJson.split('\n').length > 5) {
                    ctx.fillStyle = '#94a3b8';
                    ctx.fillText('...', 10, 130 + 5 * 12);
                }

                // Calcular ahorro
                const fullSize = JSON.stringify(fullUser).length;
                const filteredSize = JSON.stringify(filteredUser).length;
                const savings = ((fullSize - filteredSize) / fullSize * 100).toFixed(0);

                document.getElementById('fieldMaskInfo').textContent =
                    `✅ ${selectedFields.length} campos | Ahorro: ${savings}% (${fullSize - filteredSize} bytes)`;
                document.getElementById('fieldMaskResult').innerHTML =
                    `<i class="fas fa-filter"></i> FieldMask reduce payload en <strong>${savings}%</strong> enviando solo campos necesarios`;
            }
        </script>

        <!-- Slide 11: MessagePack -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-box"></i> MessagePack: El Punto Medio</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Características -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Cache de sesiones en Redis para autenticación rápida"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Posicionamiento</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Binario</strong>: Más eficiente que JSON</li>
                            <li><strong>Simple</strong>: Más fácil que Protobuf</li>
                            <li><strong>Sin esquema</strong>: No requiere .proto</li>
                            <li><strong>Multiplataforma</strong>: Amplio soporte</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Cache Redis y colas de mensajes
                        </p>
                    </div>

                    <!-- Pestañas de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="msgpack-tab active" data-demo="radar"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Comparación
                        </button>
                        <button class="msgpack-tab" data-demo="usecases"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Casos de Uso
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startMsgPackDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualización -->
                <div id="msgpackDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Radar -->
                    <div id="demoRadar" class="msgpack-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #fbbf24; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #fbbf24; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-chart-radar"></i> Gráfico de Radar Comparativo
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 300px;">
                                <canvas id="radarCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="radarInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #fbbf24;">
                                Tecnologías: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="radarResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Comparación de rendimiento HTTP/1.1 vs HTTP/2
                            </div>
                        </div>
                    </div>

                    <!-- Demo Casos de Uso -->
                    <div id="demoUsecases" class="msgpack-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-sitemap"></i> Casos de Uso por Tecnología
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="usecasesCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="usecasesInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Casos de uso: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="usecasesResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver los casos de uso
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== MESSAGEPACK SIMULACIONES =====
            let currentMsgPackDemo = 'radar';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos MessagePack
                const msgpackTabs = document.querySelectorAll('.msgpack-tab');
                msgpackTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchMsgPackDemo(demoType);
                    });
                });

                // Botón iniciar demo MessagePack
                const startMsgPackDemo = document.getElementById('startMsgPackDemo');
                if (startMsgPackDemo) {
                    startMsgPackDemo.addEventListener('click', function () {
                        if (currentMsgPackDemo === 'radar') {
                            runRadarDemo();
                        } else if (currentMsgPackDemo === 'usecases') {
                            runUseCasesDemo();
                        }
                    });
                }
            });

            function switchMsgPackDemo(demoType) {
                currentMsgPackDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.msgpack-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.msgpack-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: GRÁFICO DE RADAR COMPARATIVO =====
            function runRadarDemo() {
                const canvas = document.getElementById('radarCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const centerX = width / 2;
                const centerY = height / 2;
                const radius = Math.min(width, height) / 2 - 60;

                const axes = [
                    { name: 'Velocidad', angle: -Math.PI / 2 },
                    { name: 'Tamaño', angle: -Math.PI / 2 + (2 * Math.PI / 5) },
                    { name: 'Complejidad', angle: -Math.PI / 2 + (4 * Math.PI / 5) },
                    { name: 'Interop', angle: -Math.PI / 2 + (6 * Math.PI / 5) },
                    { name: 'Madurez', angle: -Math.PI / 2 + (8 * Math.PI / 5) }
                ];

                const technologies = [
                    {
                        name: 'JSON',
                        color: '#60a5fa',
                        values: [0.6, 0.6, 1.0, 1.0, 1.0] // Velocidad, Tamaño, Complejidad, Interop, Madurez
                    },
                    {
                        name: 'Protobuf',
                        color: '#22c55e',
                        values: [1.0, 1.0, 0.4, 0.6, 0.8]
                    },
                    {
                        name: 'MessagePack',
                        color: '#fbbf24',
                        values: [0.8, 0.8, 0.8, 0.7, 0.7]
                    }
                ];

                // Dibujar ejes y círculos concéntricos
                for (let i = 1; i <= 5; i++) {
                    const r = (radius * i) / 5;
                    ctx.strokeStyle = '#94a3b8' + (i === 5 ? 'ff' : '33');
                    ctx.lineWidth = i === 5 ? 2 : 1;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, r, 0, Math.PI * 2);
                    ctx.stroke();
                }

                // Dibujar ejes
                axes.forEach((axis, i) => {
                    const x = centerX + radius * Math.cos(axis.angle);
                    const y = centerY + radius * Math.sin(axis.angle);

                    ctx.strokeStyle = '#94a3b8';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();

                    // Etiquetas
                    const labelX = centerX + (radius + 30) * Math.cos(axis.angle);
                    const labelY = centerY + (radius + 30) * Math.sin(axis.angle);

                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(axis.name, labelX, labelY);
                });

                // Animar tecnologías
                let currentTech = 0;
                let progress = 0;

                const interval = setInterval(() => {
                    if (currentTech >= technologies.length) {
                        clearInterval(interval);
                        document.getElementById('radarInfo').textContent =
                            `▊ 3 tecnologías comparadas en 5 dimensiones`;
                        document.getElementById('radarResult').innerHTML =
                            `<i class="fas fa-balance-scale"></i> MessagePack es el <strong>punto medio ideal</strong> entre velocidad y simplicidad`;
                        return;
                    }

                    progress += 0.05;
                    if (progress > 1) {
                        progress = 1;
                    }

                    const tech = technologies[currentTech];

                    // Dibujar polígono
                    ctx.fillStyle = tech.color + '40';
                    ctx.strokeStyle = tech.color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();

                    axes.forEach((axis, i) => {
                        const value = tech.values[i] * progress;
                        const r = radius * value;
                        const x = centerX + r * Math.cos(axis.angle);
                        const y = centerY + r * Math.sin(axis.angle);

                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }

                        // Puntos
                        ctx.fillStyle = tech.color;
                        ctx.beginPath();
                        ctx.arc(x, y, 5, 0, Math.PI * 2);
                        ctx.fill();
                    });

                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    // Leyenda
                    const legendY = 20 + currentTech * 20;
                    ctx.fillStyle = tech.color;
                    ctx.fillRect(20, legendY, 15, 15);
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(tech.name, 40, legendY + 11);

                    if (progress >= 1) {
                        currentTech++;
                        progress = 0;
                    }

                    document.getElementById('radarInfo').textContent =
                        `▊ Dibujando ${tech.name}... (${currentTech + 1}/3)`;
                }, 30);
            }

            // ===== DEMO 2: CASOS DE USO =====
            function runUseCasesDemo() {
                const canvas = document.getElementById('usecasesCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const useCases = [
                    {
                        tech: 'JSON',
                        color: '#60a5fa',
                        cases: [
                            '◉ API REST para partners',
                            '▯ App móvil Banco de Loja',
                            '🔧 Configuración de servicios',
                            '📝 Logs y auditoría'
                        ],
                        y: 30
                    },
                    {
                        tech: 'Protobuf',
                        color: '#22c55e',
                        cases: [
                            '⚡ Microsservicios internos',
                            '▲ Procesamiento transacciones',
                            '◉ Eventos entre servicios',
                            '⊠ Datos sensibles encriptados'
                        ],
                        y: 180
                    },
                    {
                        tech: 'MessagePack',
                        color: '#fbbf24',
                        cases: [
                            '▣ Cache de sesiones (Redis)',
                            '◈ Cola de transacciones',
                            '≈ Balance velocidad/simplicidad',
                            '↻ Sincronizacion de datos'
                        ],
                        y: 330
                    }
                ];

                let currentCase = 0;

                const interval = setInterval(() => {
                    if (currentCase >= useCases.length) {
                        clearInterval(interval);
                        document.getElementById('usecasesInfo').textContent =
                            `✅ 3 tecnologías | 12 casos de uso`;
                        document.getElementById('usecasesResult').innerHTML =
                            `<i class="fas fa-lightbulb"></i> Cada tecnología tiene su <strong>caso de uso ideal</strong> según requisitos`;
                        return;
                    }

                    const useCase = useCases[currentCase];

                    // Título de la tecnología
                    ctx.fillStyle = useCase.color;
                    ctx.fillRect(10, useCase.y, width - 20, 40);
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(useCase.tech, width / 2, useCase.y + 25);

                    // Casos de uso
                    useCase.cases.forEach((caseText, i) => {
                        const y = useCase.y + 55 + i * 22;

                        // Bullet point
                        ctx.fillStyle = useCase.color;
                        ctx.beginPath();
                        ctx.arc(25, y - 5, 4, 0, Math.PI * 2);
                        ctx.fill();

                        // Texto
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '11px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(caseText, 40, y);
                    });

                    currentCase++;

                    document.getElementById('usecasesInfo').textContent =
                        `📋 Mostrando casos de uso (${currentCase}/3)`;
                }, 800);
            }
        </script>

        <!-- Slide 12: XML Fundamentos -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-code"></i> XML: Verbosidad y Overhead</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Características -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Integración con SRI para facturas electrónicas y reportes"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Costos</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Verbosidad</strong>: Tags duplicados</li>
                            <li><strong>Overhead</strong>: 2-3x más grande</li>
                            <li><strong>Parsing</strong>: Costoso</li>
                            <li><strong>Metadatos</strong>: Información extra</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(248, 113, 113, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid #f87171; flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-exclamation-triangle"></i> Legacy pero aún usado
                        </p>
                    </div>

                    <!-- Pestañas de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="xml-tab active" data-demo="overhead"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Overhead
                        </button>
                        <button class="xml-tab" data-demo="dom"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Árbol DOM
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startXmlDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualización -->
                <div id="xmlDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Overhead -->
                    <div id="demoOverhead" class="xml-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-chart-bar"></i> Comparación de Tamaños
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="overheadCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="overheadInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Tamaños: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="overheadResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el overhead
                            </div>
                        </div>
                    </div>

                    <!-- Demo Árbol DOM -->
                    <div id="demoDom" class="xml-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-sitemap"></i> Árbol DOM de XML
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                                <canvas id="domCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="domInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa;">
                                Nodos: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="domResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el árbol DOM
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== XML SIMULACIONES =====
            let currentXmlDemo = 'overhead';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos XML
                const xmlTabs = document.querySelectorAll('.xml-tab');
                xmlTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchXmlDemo(demoType);
                    });
                });

                // Botón iniciar demo XML
                const startXmlDemo = document.getElementById('startXmlDemo');
                if (startXmlDemo) {
                    startXmlDemo.addEventListener('click', function () {
                        if (currentXmlDemo === 'overhead') {
                            runOverheadDemo();
                        } else if (currentXmlDemo === 'dom') {
                            runDomTreeDemo();
                        }
                    });
                }
            });

            function switchXmlDemo(demoType) {
                currentXmlDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.xml-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.xml-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: OVERHEAD VISUAL =====
            function runOverheadDemo() {
                const canvas = document.getElementById('overheadCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const formats = [
                    {
                        name: 'JSON',
                        color: '#60a5fa',
                        size: 150,
                        content: '{"transaction": {"id": "TRX001", "amount": 150}}',
                        useful: 35,
                        metadata: 115
                    },
                    {
                        name: 'XML',
                        color: '#f87171',
                        size: 280,
                        content: '<?xml version="1.0"?>\n<transaccion>\n  <id>TRX001</id>\n  <monto>150</monto>\n</transaccion>',
                        useful: 35,
                        metadata: 245
                    },
                    {
                        name: 'Protobuf',
                        color: '#22c55e',
                        size: 45,
                        content: '[binario: 08 01 12 03 96 01]',
                        useful: 35,
                        metadata: 10
                    }
                ];

                let currentFormat = 0;

                const interval = setInterval(() => {
                    if (currentFormat >= formats.length) {
                        clearInterval(interval);

                        // Mostrar comparación final
                        const xmlOverhead = ((formats[1].size - formats[0].size) / formats[0].size * 100).toFixed(0);
                        const protobufSavings = ((formats[1].size - formats[2].size) / formats[1].size * 100).toFixed(0);

                        document.getElementById('overheadInfo').textContent =
                            `▊ JSON: 150B | XML: 280B (+${xmlOverhead}%) | Protobuf: 45B`;
                        document.getElementById('overheadResult').innerHTML =
                            `<i class="fas fa-exclamation-triangle"></i> XML tiene <strong>${xmlOverhead}% más overhead</strong> que JSON y <strong>${protobufSavings}% más</strong> que Protobuf`;
                        return;
                    }

                    const format = formats[currentFormat];
                    const y = 30 + currentFormat * 140;

                    // Título
                    ctx.fillStyle = format.color;
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`${format.name} (${format.size} bytes)`, 20, y);

                    // Código
                    ctx.fillStyle = '#1e1e1e';
                    ctx.fillRect(20, y + 10, width - 40, 60);
                    ctx.strokeStyle = format.color;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(20, y + 10, width - 40, 60);

                    ctx.fillStyle = '#e2e8f0';
                    ctx.font = '9px monospace';
                    ctx.textAlign = 'left';
                    const lines = format.content.split('\n');
                    lines.forEach((line, i) => {
                        ctx.fillText(line.substring(0, 60), 25, y + 28 + i * 12);
                    });

                    // Gráfico de barras (datos útiles vs metadata)
                    const barY = y + 80;
                    const maxWidth = width - 100;
                    const usefulWidth = (maxWidth * format.useful) / format.size;
                    const metadataWidth = (maxWidth * format.metadata) / format.size;

                    // Datos útiles (verde)
                    ctx.fillStyle = '#22c55e';
                    ctx.fillRect(50, barY, usefulWidth, 25);

                    // Metadata (rojo)
                    ctx.fillStyle = '#f87171';
                    ctx.fillRect(50 + usefulWidth, barY, metadataWidth, 25);

                    // Etiquetas
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`Datos: ${format.useful}B`, 50, barY - 5);
                    ctx.fillText(`Metadata: ${format.metadata}B`, 50 + usefulWidth + 5, barY - 5);

                    // Porcentaje de overhead
                    const overheadPct = ((format.metadata / format.size) * 100).toFixed(0);
                    ctx.fillStyle = format.color;
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${overheadPct}% overhead`, width - 20, barY + 17);

                    currentFormat++;

                    document.getElementById('overheadInfo').textContent =
                        `▊ Analizando ${format.name}... (${currentFormat}/3)`;
                }, 1000);
            }

            // ===== DEMO 2: ÁRBOL DOM =====
            function runDomTreeDemo() {
                const canvas = document.getElementById('domCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const tree = {
                    name: 'factura',
                    color: '#a78bfa',
                    x: width / 2,
                    y: 50,
                    children: [
                        {
                            name: 'transaccion',
                            color: '#60a5fa',
                            x: width / 2,
                            y: 150,
                            children: [
                                {
                                    name: 'id',
                                    color: '#22c55e',
                                    x: width / 2 - 100,
                                    y: 250,
                                    value: 'TRX001'
                                },
                                {
                                    name: 'monto',
                                    color: '#22c55e',
                                    x: width / 2 + 100,
                                    y: 250,
                                    value: '$150'
                                }
                            ]
                        }
                    ]
                };

                let currentLevel = 0;
                const maxLevel = 3;

                const interval = setInterval(() => {
                    if (currentLevel >= maxLevel) {
                        clearInterval(interval);
                        document.getElementById('domInfo').textContent =
                            `🌳 5 nodos | 3 niveles de profundidad`;
                        document.getElementById('domResult').innerHTML =
                            `<i class="fas fa-sitemap"></i> XML se parsea en un <strong>árbol DOM</strong> que consume memoria y tiempo de procesamiento`;
                        return;
                    }

                    // Dibujar nodos según el nivel
                    if (currentLevel === 0) {
                        // Raíz
                        drawNode(ctx, tree.name, tree.x, tree.y, tree.color);
                    } else if (currentLevel === 1) {
                        // user
                        const child = tree.children[0];
                        drawArrow(ctx, tree.x, tree.y + 30, child.x, child.y - 30, '#94a3b8');
                        drawNode(ctx, child.name, child.x, child.y, child.color);
                    } else if (currentLevel === 2) {
                        // id y name
                        const parent = tree.children[0];
                        parent.children.forEach(child => {
                            drawArrow(ctx, parent.x, parent.y + 30, child.x, child.y - 30, '#94a3b8');
                            drawNode(ctx, child.name, child.x, child.y, child.color);

                            // Valor
                            ctx.fillStyle = '#fbbf24';
                            ctx.fillRect(child.x - 40, child.y + 40, 80, 30);
                            ctx.strokeStyle = '#fbbf24';
                            ctx.lineWidth = 2;
                            ctx.strokeRect(child.x - 40, child.y + 40, 80, 30);

                            ctx.fillStyle = '#ffffff';
                            ctx.font = 'bold 12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText(child.value, child.x, child.y + 60);

                            // Línea al valor
                            ctx.strokeStyle = '#94a3b8';
                            ctx.lineWidth = 2;
                            ctx.beginPath();
                            ctx.moveTo(child.x, child.y + 30);
                            ctx.lineTo(child.x, child.y + 40);
                            ctx.stroke();
                        });
                    }

                    currentLevel++;

                    document.getElementById('domInfo').textContent =
                        `🌳 Construyendo árbol... Nivel ${currentLevel}/${maxLevel}`;
                }, 800);
            }

            function drawNode(ctx, text, x, y, color) {
                ctx.fillStyle = color;
                ctx.fillRect(x - 50, y - 20, 100, 40);
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(x - 50, y - 20, 100, 40);

                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(text, x, y + 5);
            }
        </script>

        <!-- Slide 13: XML Herramientas -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-tools"></i> XML: XPath Interactivo</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Selectores -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Consultar transacciones del SRI con XPath"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Selectores XPath</h3>
                        <select id="xpathSelector"
                            style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid var(--uide-accent); color: white; border-radius: 4px; font-size: 0.85rem; margin-bottom: 10px;">
                            <option value="//transaccion">Todas las transacciones</option>
                            <option value="//transaccion[@tipo='transferencia']">Solo transferencias</option>
                            <option value="//transaccion[monto>1000]">Montos > $1000</option>
                            <option value="//transaccion[@banco='Pichincha']">Al Banco Pichincha</option>
                            <option value="//cliente/nombre">Nombres de clientes</option>
                            <option value="//transaccion/fecha">Todas las fechas</option>
                        </select>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Herramienta para auditoría
                        </p>
                    </div>

                    <div
                        style="flex: 1; background: rgba(15, 20, 25, 0.6); border-radius: 8px; padding: 10px; overflow-y: auto;">
                        <h3 style="font-size: 0.9rem; margin-bottom: 8px; color: #fbbf24;">📋 Resultado</h3>
                        <div id="xpathResult"
                            style="font-family: monospace; font-size: 0.75rem; color: #4ade80; line-height: 1.6;">
                            Selecciona una consulta XPath...
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="executeXPath"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Ejecutar Consulta
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Documento XML -->
                <div style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <div
                        style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                        <h3 style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem;">
                            <i class="fas fa-file-code"></i> Documento XML - Transacciones Banco de Loja
                        </h3>
                        <div
                            style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                            <canvas id="xpathCanvas" style="display: block;"></canvas>
                        </div>
                        <div id="xpathInfo"
                            style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa;">
                            Elementos resaltados: -</div>
                    </div>

                    <div
                        style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                        <div id="xpathSummary" style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                            XPath permite consultas precisas sobre documentos XML
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== XPATH INTERACTIVO =====
            const xmlDocument = `<?xml version="1.0" encoding="UTF-8"?>
<transacciones>
  <transaccion tipo="transferencia" banco="Pichincha">
    <id>TRX-001</id>
    <cliente><nombre>María Sánchez</nombre></cliente>
    <monto>1500.00</monto>
    <fecha>2024-11-08</fecha>
  </transaccion>
  <transaccion tipo="pago" banco="Produbanco">
    <id>TRX-002</id>
    <cliente><nombre>Carlos Jiménez</nombre></cliente>
    <monto>450.00</monto>
    <fecha>2024-11-08</fecha>
  </transaccion>
  <transaccion tipo="transferencia" banco="Guayaquil">
    <id>TRX-003</id>
    <cliente><nombre>Ana Torres</nombre></cliente>
    <monto>2300.00</monto>
    <fecha>2024-11-09</fecha>
  </transaccion>
  <transaccion tipo="transferencia" banco="Pichincha">
    <id>TRX-004</id>
    <cliente><nombre>Luis Morales</nombre></cliente>
    <monto>800.00</monto>
    <fecha>2024-11-09</fecha>
  </transaccion>
</transacciones>`;

            document.addEventListener('DOMContentLoaded', function () {
                const executeBtn = document.getElementById('executeXPath');
                const selector = document.getElementById('xpathSelector');

                if (executeBtn) {
                    executeBtn.addEventListener('click', runXPathDemo);
                }

                if (selector) {
                    selector.addEventListener('change', runXPathDemo);
                }

                // Dibujar XML inicial
                setTimeout(() => drawXMLDocument(), 500);
            });

            function drawXMLDocument(highlightedLines = []) {
                const canvas = document.getElementById('xpathCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const lines = xmlDocument.split('\n');
                const lineHeight = 14;
                let y = 15;

                lines.forEach((line, i) => {
                    // Fondo para líneas resaltadas
                    if (highlightedLines.includes(i)) {
                        ctx.fillStyle = 'rgba(74, 222, 128, 0.2)';
                        ctx.fillRect(0, y - 12, width, lineHeight);
                    }

                    // Texto
                    ctx.fillStyle = highlightedLines.includes(i) ? '#4ade80' : '#e2e8f0';
                    ctx.font = '9px monospace';
                    ctx.textAlign = 'left';
                    ctx.fillText(line, 10, y);

                    y += lineHeight;
                });
            }

            function runXPathDemo() {
                const selector = document.getElementById('xpathSelector').value;
                const resultDiv = document.getElementById('xpathResult');
                const infoDiv = document.getElementById('xpathInfo');
                const summaryDiv = document.getElementById('xpathSummary');

                let result = '';
                let highlightedLines = [];
                let count = 0;

                switch (selector) {
                    case '//transaccion':
                        result = 'Encontradas 4 transacciones:\n';
                        result += '• TRX-001 (María Sánchez)\n';
                        result += '• TRX-002 (Carlos Jiménez)\n';
                        result += '• TRX-003 (Ana Torres)\n';
                        result += '• TRX-004 (Luis Morales)';
                        highlightedLines = [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23];
                        count = 4;
                        break;

                    case '//transaccion[@tipo=\'transferencia\']':
                        result = 'Encontradas 3 transferencias:\n';
                        result += '• TRX-001 → Pichincha ($1500)\n';
                        result += '• TRX-003 → Guayaquil ($2300)\n';
                        result += '• TRX-004 → Pichincha ($800)';
                        highlightedLines = [2, 3, 4, 5, 6, 7, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23];
                        count = 3;
                        break;

                    case '//transaccion[monto>1000]':
                        result = 'Encontradas 2 transacciones > $1000:\n';
                        result += '• TRX-001: $1500.00\n';
                        result += '• TRX-003: $2300.00\n';
                        result += '\n⚠️ Transacciones sospechosas para auditoría';
                        highlightedLines = [2, 3, 4, 5, 6, 7, 13, 14, 15, 16, 17];
                        count = 2;
                        break;

                    case '//transaccion[@banco=\'Pichincha\']':
                        result = 'Encontradas 2 transacciones al Pichincha:\n';
                        result += '• TRX-001: María Sánchez ($1500)\n';
                        result += '• TRX-004: Luis Morales ($800)';
                        highlightedLines = [2, 3, 4, 5, 6, 7, 19, 20, 21, 22, 23];
                        count = 2;
                        break;

                    case '//cliente/nombre':
                        result = 'Encontrados 4 nombres:\n';
                        result += '• María Sánchez\n';
                        result += '• Carlos Jiménez\n';
                        result += '• Ana Torres\n';
                        result += '• Luis Morales';
                        highlightedLines = [4, 10, 15, 21];
                        count = 4;
                        break;

                    case '//transaccion/fecha':
                        result = 'Encontradas 4 fechas:\n';
                        result += '• 2024-11-08 (2 transacciones)\n';
                        result += '• 2024-11-09 (2 transacciones)';
                        highlightedLines = [6, 12, 17, 23];
                        count = 4;
                        break;
                }

                resultDiv.innerHTML = result.replace(/\n/g, '<br>');
                infoDiv.textContent = `✅ ${count} elementos resaltados`;
                summaryDiv.innerHTML = `<i class="fas fa-search"></i> XPath: <strong>${selector}</strong> encontró ${count} resultado(s)`;

                drawXMLDocument(highlightedLines);
            }
        </script>

        <!-- Slide 14: XML Empresarial -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-building"></i> XML: SOAP y Sistemas Legacy</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Info -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Integración con IESS y BCE mediante SOAP"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Casos de Uso Ecuador</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.6; margin: 0; padding-left: 18px;">
                            <li>■ <strong>BCE</strong>: Tasas de interés</li>
                            <li>💼 <strong>IESS</strong>: Verificación aportes</li>
                            <li>▊ <strong>SRI</strong>: Facturas electrónicas</li>
                            <li>🏛️ <strong>Superintendencia</strong>: Reportes</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(248, 113, 113, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid #f87171; flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-exclamation-triangle"></i> Legacy pero obligatorio
                        </p>
                    </div>

                    <div
                        style="flex: 1; background: rgba(15, 20, 25, 0.6); border-radius: 8px; padding: 10px; overflow-y: auto;">
                        <h3 style="font-size: 0.9rem; margin-bottom: 8px; color: #60a5fa;">📋 REST vs SOAP</h3>
                        <table style="width: 100%; font-size: 0.75rem; color: #e2e8f0;">
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <td style="padding: 6px; font-weight: bold;">Formato</td>
                                <td style="padding: 6px;">JSON</td>
                                <td style="padding: 6px;">XML</td>
                            </tr>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <td style="padding: 6px; font-weight: bold;">Protocolo</td>
                                <td style="padding: 6px;">HTTP</td>
                                <td style="padding: 6px;">HTTP/SMTP</td>
                            </tr>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <td style="padding: 6px; font-weight: bold;">Contrato</td>
                                <td style="padding: 6px;">OpenAPI</td>
                                <td style="padding: 6px;">WSDL</td>
                            </tr>
                            <tr>
                                <td style="padding: 6px; font-weight: bold;">Uso</td>
                                <td style="padding: 6px; color: #4ade80;">Moderno</td>
                                <td style="padding: 6px; color: #f87171;">Legacy</td>
                            </tr>
                        </table>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startSoapDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Ver Flujo SOAP
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Diagrama SOAP -->
                <div style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <div
                        style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #fbbf24; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                        <h3 style="text-align: center; color: #fbbf24; margin: 0 0 8px 0; font-size: 0.9rem;">
                            <i class="fas fa-sitemap"></i> Arquitectura SOAP - Consulta al IESS
                        </h3>
                        <div
                            style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                            <canvas id="soapCanvas" style="display: block;"></canvas>
                        </div>
                        <div id="soapInfo"
                            style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #fbbf24;">
                            Paso: -</div>
                    </div>

                    <div
                        style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                        <div id="soapResult" style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                            SOAP/XML usado en integraciones gubernamentales obligatorias
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== SOAP DEMO =====
            document.addEventListener('DOMContentLoaded', function () {
                const startSoapBtn = document.getElementById('startSoapDemo');
                if (startSoapBtn) {
                    startSoapBtn.addEventListener('click', runSoapDemo);
                }
            });

            function runSoapDemo() {
                const canvas = document.getElementById('soapCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const steps = [
                    {
                        name: 'Banco de Loja',
                        desc: 'Cliente SOAP',
                        color: '#60a5fa',
                        x: 80,
                        y: 60
                    },
                    {
                        name: 'SOAP Request',
                        desc: 'XML Envelope',
                        color: '#fbbf24',
                        x: width / 2,
                        y: 140
                    },
                    {
                        name: 'WSDL Contract',
                        desc: 'Definición servicio',
                        color: '#a78bfa',
                        x: width / 2,
                        y: 220
                    },
                    {
                        name: 'IESS Server',
                        desc: 'Servicio Web',
                        color: '#f472b6',
                        x: width - 80,
                        y: 60
                    },
                    {
                        name: 'SOAP Response',
                        desc: 'Datos aportes',
                        color: '#4ade80',
                        x: width / 2,
                        y: 320
                    }
                ];

                let currentStep = 0;

                const interval = setInterval(() => {
                    if (currentStep >= steps.length) {
                        clearInterval(interval);

                        // Dibujar flechas finales
                        drawArrow(ctx, steps[0].x + 60, steps[0].y, steps[1].x - 60, steps[1].y, '#fbbf24');
                        drawArrow(ctx, steps[1].x, steps[1].y + 30, steps[2].x, steps[2].y - 30, '#a78bfa');
                        drawArrow(ctx, steps[2].x + 60, steps[2].y, steps[3].x - 60, steps[3].y + 40, '#f472b6');
                        drawArrow(ctx, steps[3].x - 60, steps[3].y + 60, steps[4].x + 60, steps[4].y - 30, '#4ade80');
                        drawArrow(ctx, steps[4].x - 60, steps[4].y, steps[0].x + 60, steps[0].y + 40, '#22c55e');

                        document.getElementById('soapInfo').textContent =
                            `✅ Flujo completo | SOAP + WSDL + XML`;
                        document.getElementById('soapResult').innerHTML =
                            `<i class="fas fa-building"></i> SOAP es <strong>obligatorio</strong> para integraciones con entidades gubernamentales en Ecuador`;
                        return;
                    }

                    const step = steps[currentStep];

                    // Dibujar nodo
                    ctx.fillStyle = step.color;
                    ctx.beginPath();
                    ctx.roundRect(step.x - 70, step.y - 25, 140, 50, 10);
                    ctx.fill();

                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Nombre
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(step.name, step.x, step.y - 5);

                    // Descripción
                    ctx.font = '10px Arial';
                    ctx.fillText(step.desc, step.x, step.y + 12);

                    currentStep++;

                    document.getElementById('soapInfo').textContent =
                        `⚙️ Paso ${currentStep}/${steps.length} | Construyendo flujo...`;
                }, 600);
            }
        </script>

        <!-- Slide 15: Comparación -->
        <div class="slide">
            <h2><i class="fas fa-balance-scale"></i> Comparación de Tecnologías</h2>
            <table>
                <thead>
                    <tr>
                        <th>Tecnología</th>
                        <th>Velocidad</th>
                        <th>Tamaño</th>
                        <th>Complejidad</th>
                        <th>Interoperabilidad</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>gRPC/Protobuf</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                    </tr>
                    <tr>
                        <td><strong>HTTP/2</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i></td>
                    </tr>
                    <tr>
                        <td><strong>WebSockets</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                    </tr>
                    <tr>
                        <td><strong>JSON</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                    </tr>
                    <tr>
                        <td><strong>XML</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Slide 16: Criterios de Selección y Casos de Uso -->
        <div class="slide">
            <h2><i class="fas fa-check-circle"></i> Criterios de Selección: Casos de Uso</h2>
            <div class="content-grid">
                <div class="feature-card">
                    <h3><i class="fas fa-server"></i> Microsservicios Internos</h3>
                    <p><strong>Recomendación</strong>: gRPC + Protobuf</p>
                    <p><strong>Razón</strong>: Máximo rendimiento, latencia crítica, control de dependencias</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-globe"></i> APIs Públicas</h3>
                    <p><strong>Recomendación</strong>: JSON + HTTP/REST</p>
                    <p><strong>Razón</strong>: Simplicidad, adopción masiva, desarrollo ágil</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-clock"></i> Tiempo Real</h3>
                    <p><strong>Recomendación</strong>: WebSockets</p>
                    <p><strong>Razón</strong>: Conexión persistente bidireccional, streaming eficiente</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-building"></i> Integración Empresarial</h3>
                    <p><strong>Recomendación</strong>: XML</p>
                    <p><strong>Razón</strong>: Estándares establecidos, herramientas maduras, interoperabilidad</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-cogs"></i> Sistemas en Evolución</h3>
                    <p><strong>Recomendación</strong>: Protobuf</p>
                    <p><strong>Razón</strong>: Versionado sin ruptura, evolución rápida</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-balance-scale"></i> Balance Eficiencia/Simplicidad</h3>
                    <p><strong>Recomendación</strong>: MessagePack</p>
                    <p><strong>Razón</strong>: Más eficiente que JSON, más simple que Protobuf</p>
                </div>
            </div>
        </div>

        <!-- Slide 18: Actividades -->
        <div class="slide">
            <h2><i class="fas fa-clipboard-check"></i> Actividades Calificadas - Semana 3</h2>
            <div class="content-grid">
                <div class="feature-card">
                    <h3><i class="fas fa-poll"></i> Gestión de Aprendizaje</h3>
                    <p style="color: var(--uide-accent); font-weight: 600; margin-bottom: 1rem;">GA-1.1 (1%)</p>
                    <p><strong>Sondeo: ¿cuándo usar HTTP/2, WS, gRPC?</strong></p>
                    <p style="margin-top: 1rem; font-size: 0.95rem;">Evaluación diagnóstica sobre criterios de selección
                        de protocolos</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-flask"></i> Práctico Experimental</h3>
                    <p style="color: var(--uide-accent); font-weight: 600; margin-bottom: 1rem;">PE-1.3 (2.25%)</p>
                    <p><strong>Lab: Servicio Eco Multi-formato</strong></p>
                    <ul style="margin-top: 1rem; font-size: 0.95rem;">
                        <li>Servicio Node.js con JSON y Protobuf</li>
                        <li>Testing y comparación de performance</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-file-alt"></i> Trabajo Autónomo</h3>
                    <p style="color: var(--uide-accent); font-weight: 600; margin-bottom: 1rem;">TA-1.3 (2.25%)</p>
                    <p><strong>Postman Collection + Script Cliente</strong></p>
                    <ul style="margin-top: 1rem; font-size: 0.95rem;">
                        <li>Colección con tests automatizados</li>
                        <li>Script consumiendo API pública</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 19: Síntesis y Reflexiones -->
        <div class="slide title-slide">
            <h1><i class="fas fa-lightbulb"></i> Arquitectura Banco de Loja: Síntesis</h1>
            <div class="quote">
                "Sistema bancario moderno con integración legacy - Un caso real ecuatoriano"
            </div>

            <div
                style="margin-top: 1.5rem; background: rgba(15, 20, 25, 0.6); border-radius: 12px; padding: 20px; border: 2px solid var(--uide-accent);">
                <h3 style="color: var(--uide-accent); margin-bottom: 1rem; text-align: center;">
                    <i class="fas fa-sitemap"></i> Stack Tecnológico Completo
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 1.5rem;">
                    <div
                        style="background: rgba(96, 165, 250, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #60a5fa;">
                        <h4 style="color: #60a5fa; margin-bottom: 8px; font-size: 0.95rem;">▯ Capa de Presentación</h4>
                        <p style="font-size: 0.85rem; margin: 0;">
                            <strong>HTTP/2 + JSON</strong><br>
                            App móvil con multiplexación<br>
                            <span style="color: #94a3b8;">Dashboard, transacciones, notificaciones</span>
                        </p>
                    </div>

                    <div
                        style="background: rgba(74, 222, 128, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #4ade80;">
                        <h4 style="color: #4ade80; margin-bottom: 8px; font-size: 0.95rem;">⚡ Tiempo Real</h4>
                        <p style="font-size: 0.85rem; margin: 0;">
                            <strong>WebSockets</strong><br>
                            Notificaciones y soporte en vivo<br>
                            <span style="color: #94a3b8;">Alertas de transacciones, chat</span>
                        </p>
                    </div>

                    <div
                        style="background: rgba(34, 197, 94, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #22c55e;">
                        <h4 style="color: #22c55e; margin-bottom: 8px; font-size: 0.95rem;">▲ Microsservicios</h4>
                        <p style="font-size: 0.85rem; margin: 0;">
                            <strong>gRPC + Protobuf</strong><br>
                            Comunicación interna de alta velocidad<br>
                            <span style="color: #94a3b8;">Cuentas, transacciones, reportes</span>
                        </p>
                    </div>

                    <div
                        style="background: rgba(251, 191, 36, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #fbbf24;">
                        <h4 style="color: #fbbf24; margin-bottom: 8px; font-size: 0.95rem;">▣ Cache y Colas</h4>
                        <p style="font-size: 0.85rem; margin: 0;">
                            <strong>MessagePack + Redis</strong><br>
                            Sesiones y transacciones pendientes<br>
                            <span style="color: #94a3b8;">Autenticación rápida, queues</span>
                        </p>
                    </div>
                </div>

                <div
                    style="background: rgba(248, 113, 113, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #f87171;">
                    <h4 style="color: #f87171; margin-bottom: 8px; font-size: 0.95rem;">🏛️ Integraciones Legacy</h4>
                    <p style="font-size: 0.85rem; margin: 0;">
                        <strong>SOAP + XML</strong><br>
                        SRI (facturas), IESS (aportes), BCE (tasas), Superintendencia (reportes)<br>
                        <span style="color: #94a3b8;">⚠️ Obligatorio por regulación ecuatoriana</span>
                    </p>
                </div>
            </div>

            <div style="margin-top: 1.5rem; background: rgba(233, 171, 33, 0.1); padding: 15px; border-radius: 10px;">
                <h3 style="color: var(--uide-accent); margin-bottom: 10px; text-align: center;">
                    <i class="fas fa-check-circle"></i> Reglas de Oro
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.85rem;">
                    <div>✅ HTTP/2 para app móvil</div>
                    <div>✅ WebSockets solo para notificaciones</div>
                    <div>✅ gRPC entre microsservicios</div>
                    <div>✅ JSON para APIs públicas</div>
                    <div>⚠️ XML/SOAP cuando sea obligatorio</div>
                    <div>▣ MessagePack para cache</div>
                </div>
            </div>

            <div style="margin-top: 1rem; text-align: center; font-style: italic; color: #e2e8f0; font-size: 0.95rem;">
                <i class="fas fa-graduation-cap"></i> Cada tecnología tiene su lugar en una arquitectura moderna
            </div>
        </div>

        <!-- Slide 21: Referencias Bibliográficas -->
        <div class="slide">
            <h2><i class="fas fa-book"></i> Referencias Bibliográficas</h2>
            <div style="max-width: 1000px; margin: 0 auto;">
                <h3 style="margin-bottom: 1.5rem;">Bibliografía Básica</h3>
                <ul style="font-size: 1rem; line-height: 1.8; margin-bottom: 2rem;">
                    <li><strong>Beynon-Davies, P. (2018).</strong> <em>Sistemas de Bases de Datos</em>. Editorial
                        Reverté. <a
                            href="https://www.proquest.com/books/sistemas-de-bases-datos/docview/2590135108/se-2"
                            style="color: var(--uide-accent);" target="_blank">Enlace</a></li>
                </ul>

                <h3 style="margin-bottom: 1.5rem;">Bibliografía Complementaria</h3>
                <ul style="font-size: 0.95rem; line-height: 1.7;">
                    <li><strong>Tanenbaum, A. S., & Van Steen, M. (2023).</strong> <em>Distributed Systems: Principles
                            and Paradigms</em> (3rd ed.). Pearson. <a
                            href="https://alex-nguyen.github.io/vinhtngu/CSCourses/Spring2020/CS5352/Distributed_Systems_3-200225.pdf"
                            style="color: var(--uide-accent);" target="_blank">Enlace</a></li>
                    <li><strong>Newman, S. (2021).</strong> <em>Building Microservices: Designing Fine-Grained
                            Systems</em> (2nd ed.). O'Reilly Media. <a
                            href="https://www.oreilly.com/library/view/building-microservices-2nd/9781492034018/"
                            style="color: var(--uide-accent);" target="_blank">Enlace</a></li>
                    <li><strong>Kleppmann, M. (2023).</strong> <em>Designing Data-Intensive Applications: The Big Ideas
                            Behind Reliable, Scalable, and Maintainable Systems</em> (2nd ed.). O'Reilly Media. <a
                            href="https://www.oreilly.com/library/view/designing-data-intensive-applications/9781098119058/"
                            style="color: var(--uide-accent);" target="_blank">Enlace</a></li>
                </ul>

                <h3 style="margin-bottom: 1.5rem; margin-top: 2rem;">Fuente ASU</h3>
                <ul style="font-size: 0.95rem; line-height: 1.7;">
                    <li><strong>Arizona State University. (2024).</strong> <em>CSE445 (Distributed Software
                            Development)</em>. Computer Science and Engineering Program. Online</li>
                    <li><strong>Arizona State University. (2024).</strong> <em>Master Class: A Practitioner's Guide to
                            Generative AI</em> - April 2024</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Navigation Controls -->
    <div class="nav-controls">
        <button class="nav-btn" id="prevBtn"><i class="fas fa-chevron-left"></i></button>
        <button class="nav-btn" id="nextBtn"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- Slide Counter -->
    <div class="slide-counter">
        <span id="currentSlide">1</span> / <span id="totalSlides">20</span>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar"></div>

    <!-- External JavaScript -->
    <script src="presentacion.js"></script>

    <!-- JavaScript para Sistema de Código -->
    <script>
        // ===== INICIALIZACIÓN DE PRISM.JS =====
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar Prism en todos los bloques de código
            Prism.highlightAll();

            // ===== TABS DE CÓDIGO =====
            const setupCodeTabs = () => {
                const tabContainers = document.querySelectorAll('.code-tabs-container');

                tabContainers.forEach(container => {
                    const tabButtons = container.querySelectorAll('.code-tab-btn');
                    const tabContents = container.querySelectorAll('.code-tab-content');

                    tabButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const targetTab = button.getAttribute('data-tab');

                            // Remover clase active de todos los botones y contenidos
                            tabButtons.forEach(btn => btn.classList.remove('active'));
                            tabContents.forEach(content => content.classList.remove('active'));

                            // Agregar clase active al botón clickeado
                            button.classList.add('active');

                            // Mostrar el contenido correspondiente
                            const targetContent = container.querySelector(`.code-tab-content[data-tab="${targetTab}"]`);
                            if (targetContent) {
                                targetContent.classList.add('active');

                                // Re-highlight del código cuando se muestra la tab
                                setTimeout(() => {
                                    const codeBlocks = targetContent.querySelectorAll('code[class*="language-"]');
                                    codeBlocks.forEach(block => {
                                        Prism.highlightElement(block);
                                    });
                                }, 10);
                            }
                        });
                    });
                });
            };

            // Inicializar tabs
            setupCodeTabs();

            // ===== BOTONES DE COPIAR CÓDIGO =====
            const setupCopyButtons = () => {
                const copyButtons = document.querySelectorAll('.copy-code-btn');

                copyButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const codeContainer = button.closest('.code-container');
                        const codeBlock = codeContainer.querySelector('code');
                        const codeText = codeBlock.textContent;

                        // Copiar al portapapeles
                        navigator.clipboard.writeText(codeText).then(() => {
                            // Cambiar apariencia del botón
                            const originalHTML = button.innerHTML;
                            button.innerHTML = '<i class="fas fa-check"></i> Copiado!';
                            button.classList.add('copied');

                            // Restaurar después de 2 segundos
                            setTimeout(() => {
                                button.innerHTML = originalHTML;
                                button.classList.remove('copied');
                            }, 2000);
                        }).catch(err => {
                            console.error('Error al copiar:', err);
                            button.innerHTML = '<i class="fas fa-times"></i> Error';
                            setTimeout(() => {
                                button.innerHTML = '<i class="fas fa-copy"></i> Copiar';
                            }, 2000);
                        });
                    });
                });
            };

            // Inicializar botones de copiar
            setupCopyButtons();

            // ===== RE-HIGHLIGHT AL CAMBIAR DE SLIDE =====
            // Escuchar cambios de slide para re-highlight
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const slide = mutation.target;
                        if (slide.classList.contains('active')) {
                            // Re-highlight código en el slide activo
                            setTimeout(() => {
                                const codeBlocks = slide.querySelectorAll('code[class*="language-"]');
                                codeBlocks.forEach(block => {
                                    Prism.highlightElement(block);
                                });
                            }, 100);
                        }
                    }
                });
            });

            // Observar todos los slides
            const slides = document.querySelectorAll('.slide');
            slides.forEach(slide => {
                observer.observe(slide, {
                    attributes: true,
                    attributeFilter: ['class']
                });
            });

            // Highlight inicial del primer slide
            setTimeout(() => {
                Prism.highlightAll();
            }, 500);
        });
    </script>
</body>

</html>