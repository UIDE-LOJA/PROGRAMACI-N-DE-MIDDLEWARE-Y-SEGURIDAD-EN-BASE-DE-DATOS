<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolos y Formatos en Sistemas Distribuidos</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚óâ</text></svg>">
    <link rel="stylesheet" href="presentacion.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: false, theme: 'dark', securityLevel: 'loose',
            themeVariables: {
                darkMode: true, primaryColor: '#E9AB21', primaryTextColor: '#ffffff',
                primaryBorderColor: '#ffffff', lineColor: '#ffffff', secondaryColor: '#23356E',
                tertiaryColor: '#910048', background: '#0f1419', mainBkg: '#0f1419', secondBkg: '#1a1f2e'
            },
            flowchart: { useMaxWidth: true, htmlLabels: false, curve: 'basis' }
        });
    </script>
</head>

<body>
    <div class="uide-logo">
        <img src="../../Logo%20UIDE.png" alt="UIDE Logo">
    </div>
    <div class="presentation-container">
        <!-- Slide 1: Title -->
        <div class="slide active title-slide">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h3 style="color: #e2e8f0; font-size: 1.3rem; font-weight: 700; margin-bottom: 1rem;">
                    Presentaci√≥n Semana 3
                </h3>
                <h2 style="color: var(--uide-accent); font-size: 2.2rem; font-weight: 600; margin-bottom: 0.5rem;">
                    Protocolos y Formatos en Sistemas Distribuidos
                </h2>
                <p style="color: #ffffff; font-size: 1.4rem; font-weight: 500;">
                    LTI_05A_458 PMSBD ‚Ä¢ Cuarto Nivel
                </p>
                <p style="color: #e2e8f0; font-size: 1.2rem; margin-top: 0.5rem;">
                    Programaci√≥n Middleware y Sistemas Basados en Datos
                </p>
            </div>
            <div style="text-align: center; margin: 2rem 0;">
                <p style="color: #ffffff; font-size: 1.3rem; font-weight: 600;">
                    Mgs. Charlie C√°rdenas Toledo
                </p>
                <p style="color: var(--uide-primary); font-size: 1.2rem; font-weight: 500; margin-top: 0.5rem;">
                    Universidad Internacional del Ecuador ‚Ä¢ Octubre 2025 ‚Äì Febrero 2026
                </p>
            </div>
            <div
                style="text-align: center; margin-top: 2.5rem; padding: 25px; background: rgba(15, 20, 25, 0.6); border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.1);">
                <h3 style="color: var(--uide-accent); font-size: 1.4rem; margin-bottom: 1rem;">
                    <i class="fas fa-network-wired"></i> Comunicaci√≥n de Alto Rendimiento y Serializaci√≥n
                </h3>
                <p style="color: #e2e8f0; font-size: 1.1rem; line-height: 1.4; margin: 0.5rem 0;">
                    <strong>Semana 3</strong> ‚Ä¢ HTTP/2 ‚Ä¢ WebSockets ‚Ä¢ gRPC ‚Ä¢ JSON ‚Ä¢ Protobuf ‚Ä¢ MessagePack ‚Ä¢ XML
                </p>
                <p style="color: #cbd5e1; font-size: 1rem; margin-top: 1rem; font-style: italic;">
                    Dominar protocolos modernos y formatos de serializaci√≥n para sistemas distribuidos eficientes
                </p>
            </div>
        </div>

        <!-- Slide 2: Objetivos -->
        <div class="slide">
            <h2><i class="fas fa-bullseye"></i> Objetivos de la Presentaci√≥n</h2>
            <ul>
                <li>Dominar <span class="highlight">protocolos de comunicaci√≥n de alto rendimiento</span> (HTTP/2,
                    WebSockets, gRPC)</li>
                <li>Analizar <span class="highlight">formatos de serializaci√≥n</span> modernos (JSON, Protobuf,
                    MessagePack)</li>
                <li>Comprender el <span class="highlight">rol b√°sico y empresarial de XML</span></li>
                <li>Evaluar <span class="highlight">ventajas y limitaciones</span> de cada tecnolog√≠a</li>
                <li>Aplicar criterios de <span class="highlight">selecci√≥n tecnol√≥gica</span> seg√∫n contexto</li>
            </ul>
        </div>

        <!-- Slide 3: Agenda -->
        <div class="slide">
            <h2><i class="fas fa-list-check"></i> Agenda</h2>
            <div class="content-grid">
                <div class="feature-card">
                    <h3><i class="fas fa-bolt"></i> 1. HTTP/2</h3>
                    <p>Protocolo moderno de transporte</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-plug"></i> 2. WebSockets</h3>
                    <p>Conexi√≥n persistente bidireccional</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-rocket"></i> 3. gRPC</h3>
                    <p>RPC moderno de alto rendimiento</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-file-code"></i> 4. Serializaci√≥n</h3>
                    <p>JSON, Protobuf, MessagePack</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-code"></i> 5. XML</h3>
                    <p>Rol b√°sico y empresarial</p>
                </div>
            </div>
        </div>

        <!-- Slide 4: HTTP/2 -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-globe"></i> HTTP/2: Protocolo de Transporte Moderno</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Caracter√≠sticas -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "La app m√≥vil del Banco de Loja carga 8 recursos simult√°neamente"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Caracter√≠sticas</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Binario</strong>: M√°s eficiente</li>
                            <li><strong>Multiplexaci√≥n</strong>: Streams paralelos</li>
                            <li><strong>HPACK</strong>: Compresi√≥n headers</li>
                            <li><strong>Server push</strong>: Env√≠o proactivo</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Base para gRPC y app m√≥vil
                        </p>
                    </div>

                    <!-- Pesta√±as de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="http2-tab active" data-demo="multiplex"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Multiplexaci√≥n
                        </button>
                        <button class="http2-tab" data-demo="hpack"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            HPACK
                        </button>
                        <button class="http2-tab" data-demo="push"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Server Push
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startHttp2Demo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                        <div id="http2Controls" style="margin-top: 6px; font-size: 0.75rem;">
                            <label style="color: #e2e8f0;">Requests: </label>
                            <input type="number" id="http2Requests" value="6" min="3" max="10"
                                style="width: 50px; padding: 3px; background: rgba(255,255,255,0.1); border: 1px solid var(--uide-accent); color: white; border-radius: 4px; font-size: 0.75rem;">
                        </div>
                    </div>
                </div>

                <!-- Columna Derecha: Visualizaci√≥n Comparativa -->
                <div id="http2DemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Multiplexaci√≥n -->
                    <div id="demoMultiplex" class="http2-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <!-- HTTP/1.1 -->
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; min-height: 0; max-height: 45%;">
                            <h3
                                style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem; flex-shrink: 0;">
                                <i class="fas fa-times-circle"></i> HTTP/1.1 - Conexiones Secuenciales
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; position: relative; overflow: hidden; min-height: 0; height: 200px;">
                                <canvas id="http1Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="http1Time"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171; flex-shrink: 0;">
                                Tiempo: -</div>
                        </div>

                        <!-- HTTP/2 -->
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; min-height: 0; max-height: 45%;">
                            <h3
                                style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem; flex-shrink: 0;">
                                <i class="fas fa-check-circle"></i> HTTP/2 - Multiplexaci√≥n (Streams Paralelos)
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; position: relative; overflow: hidden; min-height: 0; height: 200px;">
                                <canvas id="http2Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="http2Time"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80; flex-shrink: 0;">
                                Tiempo: -</div>
                        </div>

                        <!-- Comparaci√≥n de mejora -->
                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="http2Improvement"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Comparaci√≥n de rendimiento HTTP/1.1 vs HTTP/2
                            </div>
                        </div>
                    </div>

                    <!-- Demo HPACK -->
                    <div id="demoHpack" class="http2-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-times-circle"></i> HTTP/1.1 - Headers Sin Comprimir
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="hpackHttp1Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="hpackHttp1Size"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Tama√±o: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-check-circle"></i> HTTP/2 - Headers Comprimidos (HPACK)
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="hpackHttp2Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="hpackHttp2Size"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Tama√±o: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px;">
                            <div id="hpackImprovement"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Compresi√≥n de headers con algoritmo HPACK
                            </div>
                        </div>
                    </div>

                    <!-- Demo Server Push -->
                    <div id="demoPush" class="http2-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-times-circle"></i> HTTP/1.1 - Request/Response Tradicional
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; position: relative; overflow: hidden; height: 200px;">
                                <canvas id="pushHttp1Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="pushHttp1Time"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Tiempo: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-check-circle"></i> HTTP/2 - Server Push Proactivo
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; position: relative; overflow: hidden; height: 200px;">
                                <canvas id="pushHttp2Canvas" style="display: block;"></canvas>
                            </div>
                            <div id="pushHttp2Time"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Tiempo: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px;">
                            <div id="pushImprovement"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Env√≠o proactivo de recursos sin solicitud previa
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== FUNCI√ìN HELPER PARA CANVAS DE ALTA RESOLUCI√ìN =====
            function setupHighDPICanvas(canvas, width, height) {
                const dpr = window.devicePixelRatio || 1;

                // Configurar dimensiones f√≠sicas del canvas (con DPR)
                canvas.width = width * dpr;
                canvas.height = height * dpr;

                // Configurar dimensiones CSS (visuales)
                canvas.style.width = width + 'px';
                canvas.style.height = height + 'px';

                // Obtener contexto y escalar
                const ctx = canvas.getContext('2d');
                ctx.scale(dpr, dpr);

                // Agregar propiedades l√≥gicas para compatibilidad con c√≥digo existente
                canvas.logicalWidth = width;
                canvas.logicalHeight = height;

                return ctx;
            }

            // Funci√≥n para obtener dimensiones del contenedor
            function getCanvasDimensions(canvas, padding = 16) {
                const container = canvas.parentElement;
                const rect = container.getBoundingClientRect();
                return {
                    width: rect.width - padding,
                    height: Math.max(rect.height - padding, 150) // M√≠nimo 150px
                };
            }

            // ===== HTTP/2 SIMULACIONES VISUALES CON CASOS DE USO REALES =====
            let currentHttp2Demo = 'multiplex';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos
                const tabs = document.querySelectorAll('.http2-tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchHttp2Demo(demoType);
                    });
                });

                // Bot√≥n iniciar demo
                const startHttp2Demo = document.getElementById('startHttp2Demo');
                if (startHttp2Demo) {
                    startHttp2Demo.addEventListener('click', function () {
                        const requests = parseInt(document.getElementById('http2Requests').value) || 6;

                        if (currentHttp2Demo === 'multiplex') {
                            runHttp2Comparison(requests);
                        } else if (currentHttp2Demo === 'hpack') {
                            runHpackDemo(requests);
                        } else if (currentHttp2Demo === 'push') {
                            runServerPushDemo();
                        }
                    });
                }
            });

            function switchHttp2Demo(demoType) {
                currentHttp2Demo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.http2-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.http2-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }

                // Mostrar/ocultar controles seg√∫n demo
                const controlsDiv = document.getElementById('http2Controls');
                if (demoType === 'push') {
                    controlsDiv.style.display = 'none';
                } else {
                    controlsDiv.style.display = 'block';
                }
            }

            // ===== DEMO 1: MULTIPLEXACI√ìN - Dashboard Banco de Loja =====
            function runHttp2Comparison(numRequests) {
                const resources = [
                    { name: 'Saldo cuenta', icon: '$', size: '15KB', color: '#60a5fa' },
                    { name: 'Transacciones', icon: '‚ñä', size: '25KB', color: '#f472b6' },
                    { name: 'Tarjetas', icon: '‚ñ≠', size: '12KB', color: '#fbbf24' },
                    { name: 'Notificaciones', icon: '‚óâ', size: '8KB', color: '#4ade80' },
                    { name: 'Inversiones', icon: '‚ñ≤', size: '18KB', color: '#a78bfa' },
                    { name: 'Sucursales', icon: '‚ñ†', size: '22KB', color: '#fb923c' },
                    { name: 'Cr√©ditos', icon: '‚â°', size: '16KB', color: '#ec4899' },
                    { name: 'Promociones', icon: '‚óé', size: '14KB', color: '#14b8a6' },
                    { name: 'Perfil usuario', icon: '‚ñØ', size: '10KB', color: '#f59e0b' },
                    { name: 'Seguridad', icon: '‚ä†', size: '9KB', color: '#8b5cf6' }
                ];

                const selectedResources = resources.slice(0, numRequests);
                simulateHttp1Visual(selectedResources);
                setTimeout(() => simulateHttp2Visual(selectedResources), 100);
            }

            function simulateHttp1Visual(resources) {
                const canvas = document.getElementById('http1Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const resourceHeight = 35;
                const gap = 8;
                const clientX = 30;
                const serverX = width - 80;
                const pipeWidth = serverX - clientX - 60;

                let currentResource = 0;
                let totalTime = 0;

                // Dibujar cliente y servidor
                function drawEndpoints() {
                    // Cliente
                    ctx.fillStyle = '#60a5fa';
                    ctx.fillRect(clientX - 15, 10, 30, height - 20);
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('CLIENT', clientX, height / 2);

                    // Servidor
                    ctx.fillStyle = '#f87171';
                    ctx.fillRect(serverX - 15, 10, 30, height - 20);
                    ctx.fillStyle = '#ffffff';
                    ctx.fillText('SERVER', serverX, height / 2);
                }

                drawEndpoints();

                const interval = setInterval(() => {
                    if (currentResource >= resources.length) {
                        clearInterval(interval);
                        document.getElementById('http1Time').innerHTML = `<i class="fas fa-stopwatch"></i> Tiempo Total: ${totalTime}ms | <i class="fas fa-circle" style="color: #f87171;"></i> Bloqueante`;
                        return;
                    }

                    const resource = resources[currentResource];
                    const y = 30 + currentResource * (resourceHeight + gap);

                    // Animaci√≥n de request y response
                    let progress = 0;
                    const animInterval = setInterval(() => {
                        progress += 4;
                        if (progress > 200) {
                            clearInterval(animInterval);
                            currentResource++;
                            return;
                        }

                        ctx.clearRect(clientX + 20, y - 5, pipeWidth + 40, resourceHeight + 10);

                        // Request (cliente ‚Üí servidor)
                        if (progress <= 100) {
                            const reqProgress = (pipeWidth * progress) / 100;
                            ctx.fillStyle = resource.color;
                            ctx.globalAlpha = 0.7;
                            ctx.fillRect(clientX + 20, y + 5, reqProgress, 10);

                            // Paquete animado
                            ctx.globalAlpha = 1;
                            ctx.fillStyle = resource.color;
                            ctx.fillRect(clientX + 20 + reqProgress - 15, y, 15, 20);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText(resource.icon, clientX + 20 + reqProgress - 7, y + 14);
                        }

                        // Response (servidor ‚Üí cliente)
                        if (progress > 100) {
                            const respProgress = (pipeWidth * (progress - 100)) / 100;
                            ctx.fillStyle = resource.color;
                            ctx.globalAlpha = 0.7;
                            ctx.fillRect(serverX - 40 - respProgress, y + 20, respProgress, 10);

                            // Paquete animado
                            ctx.globalAlpha = 1;
                            ctx.fillStyle = resource.color;
                            ctx.fillRect(serverX - 40 - respProgress, y + 15, 15, 20);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText(resource.icon, serverX - 40 - respProgress + 7, y + 29);
                        }

                        // Etiqueta del recurso
                        ctx.globalAlpha = 1;
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '9px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(resource.name, clientX + 25, y - 8);
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(resource.size, clientX + 120, y - 8);

                        totalTime += 10;
                        document.getElementById('http1Time').innerHTML = `<i class="fas fa-stopwatch"></i> Tiempo: ${Math.round(totalTime)}ms | <i class="fas fa-circle" style="color: #f87171;"></i> Bloqueante`;
                    }, 25);
                }, 500);
            }

            function simulateHttp2Visual(resources) {
                const canvas = document.getElementById('http2Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const resourceHeight = 35;
                const gap = 8;
                const clientX = 30;
                const serverX = width - 80;
                const pipeWidth = serverX - clientX - 60;

                // Dibujar cliente y servidor
                ctx.fillStyle = '#22c55e';
                ctx.fillRect(clientX - 15, 10, 30, height - 20);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('CLIENT', clientX, height / 2);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(serverX - 15, 10, 30, height - 20);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('SERVER', serverX, height / 2);

                // Dibujar conexi√≥n √∫nica
                ctx.strokeStyle = '#22c55e';
                ctx.lineWidth = 3;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(clientX + 20, height / 2);
                ctx.lineTo(serverX - 20, height / 2);
                ctx.stroke();
                ctx.setLineDash([]);

                // Todos los recursos en paralelo
                const progresses = resources.map(() => ({ req: 0, resp: 0 }));
                let maxTime = 0;

                const interval = setInterval(() => {
                    let allComplete = true;

                    resources.forEach((resource, i) => {
                        const y = 30 + i * (resourceHeight + gap);

                        if (progresses[i].req < 100) {
                            allComplete = false;
                            progresses[i].req += 4;
                        } else if (progresses[i].resp < 100) {
                            allComplete = false;
                            progresses[i].resp += 4;
                        }

                        ctx.clearRect(clientX + 20, y - 10, pipeWidth + 40, resourceHeight + 15);

                        // Request
                        if (progresses[i].req <= 100) {
                            const reqProgress = (pipeWidth * progresses[i].req) / 100;
                            ctx.fillStyle = resource.color;
                            ctx.globalAlpha = 0.5;
                            ctx.fillRect(clientX + 20, y + 5, reqProgress, 8);

                            if (progresses[i].req < 100) {
                                ctx.globalAlpha = 1;
                                ctx.fillStyle = resource.color;
                                ctx.fillRect(clientX + 20 + reqProgress - 12, y, 12, 18);
                                ctx.fillStyle = '#ffffff';
                                ctx.font = '10px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText(resource.icon, clientX + 20 + reqProgress - 6, y + 12);
                            }
                        }

                        // Response
                        if (progresses[i].req >= 100 && progresses[i].resp <= 100) {
                            const respProgress = (pipeWidth * progresses[i].resp) / 100;
                            ctx.fillStyle = resource.color;
                            ctx.globalAlpha = 0.5;
                            ctx.fillRect(serverX - 40 - respProgress, y + 18, respProgress, 8);

                            if (progresses[i].resp < 100) {
                                ctx.globalAlpha = 1;
                                ctx.fillStyle = resource.color;
                                ctx.fillRect(serverX - 40 - respProgress, y + 13, 12, 18);
                                ctx.fillStyle = '#ffffff';
                                ctx.font = '10px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText(resource.icon, serverX - 40 - respProgress + 6, y + 25);
                            }
                        }

                        // Etiqueta
                        ctx.globalAlpha = 1;
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '9px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(resource.name, clientX + 25, y - 8);
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(resource.size, clientX + 120, y - 8);

                        // Stream ID
                        ctx.fillStyle = '#fbbf24';
                        ctx.font = 'bold 8px Arial';
                        ctx.fillText(`#${i + 1}`, clientX + 180, y - 8);
                    });

                    maxTime += 25;
                    document.getElementById('http2Time').innerHTML = `<i class="fas fa-stopwatch"></i> Tiempo: ${maxTime}ms | <i class="fas fa-circle" style="color: #4ade80;"></i> Paralelo`;

                    if (allComplete) {
                        clearInterval(interval);
                        const http1Total = resources.length * 500;
                        const improvement = ((http1Total - maxTime) / http1Total * 100).toFixed(1);
                        document.getElementById('http2Improvement').innerHTML =
                            `<i class="fas fa-rocket"></i> HTTP/2 carga la p√°gina <strong>${improvement}% m√°s r√°pido</strong> con multiplexaci√≥n en una sola conexi√≥n`;
                    }
                }, 25);
            }

            // ===== DEMO 2: HPACK - Visualizaci√≥n de Paquetes de Red =====
            function runHpackDemo(numRequests) {
                const headers = [
                    { key: ':method', value: 'GET', size: 10 },
                    { key: ':scheme', value: 'https', size: 12 },
                    { key: ':path', value: '/api/accounts/balance', size: 28 },
                    { key: ':authority', value: 'api.bancodeloja.fin.ec', size: 28 },
                    { key: 'user-agent', value: 'BancoLoja-App/2.1.0', size: 25 },
                    { key: 'accept', value: 'application/json', size: 22 },
                    { key: 'accept-encoding', value: 'gzip, deflate, br', size: 25 },
                    { key: 'accept-language', value: 'es-EC,es;q=0.9', size: 22 },
                    { key: 'cache-control', value: 'no-cache', size: 18 },
                    { key: 'authorization', value: 'Bearer JWT_TOKEN...', size: 45 }
                ];

                animateHttp1Headers(headers, numRequests);
                setTimeout(() => animateHttp2Headers(headers, numRequests), 100);
            }

            function animateHttp1Headers(headers, numRequests) {
                const canvas = document.getElementById('hpackHttp1Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                let totalSize = 0;
                let currentReq = 0;

                const interval = setInterval(() => {
                    if (currentReq >= numRequests) {
                        clearInterval(interval);
                        document.getElementById('hpackHttp1Size').innerHTML =
                            `<i class="fas fa-box"></i> Total: ${totalSize} bytes | <i class="fas fa-circle" style="color: #f87171;"></i> Sin compresion`;
                        return;
                    }

                    const y = 15 + currentReq * 55;
                    const headerSize = headers.reduce((sum, h) => sum + h.size, 0);
                    totalSize += headerSize;

                    // Paquete
                    const packetWidth = Math.min((width - 100) * (headerSize / 300), width - 100);

                    ctx.fillStyle = 'rgba(248, 113, 113, 0.2)';
                    ctx.fillRect(80, y, packetWidth, 45);
                    ctx.strokeStyle = '#f87171';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(80, y, packetWidth, 45);

                    // Etiqueta
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`Request ${currentReq + 1}`, 10, y + 12);

                    // Headers dentro del paquete
                    ctx.font = '8px monospace';
                    ctx.fillStyle = '#e2e8f0';
                    headers.slice(0, 5).forEach((h, i) => {
                        ctx.fillText(`${h.key}: ${h.value}`, 85, y + 15 + i * 8);
                    });
                    if (headers.length > 5) {
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(`... +${headers.length - 5} m√°s`, 85, y + 55);
                    }

                    // Tama√±o
                    ctx.fillStyle = '#f87171';
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${headerSize}B`, width - 10, y + 25);

                    document.getElementById('hpackHttp1Size').innerHTML =
                        `<i class="fas fa-box"></i> Acumulado: ${totalSize} bytes | <i class="fas fa-circle" style="color: #f87171;"></i> Sin compresi√≥n`;

                    currentReq++;
                }, 400);
            }

            function animateHttp2Headers(headers, numRequests) {
                const canvas = document.getElementById('hpackHttp2Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // Tabla de √≠ndices HPACK
                ctx.fillStyle = 'rgba(74, 222, 128, 0.1)';
                ctx.fillRect(10, 10, width - 20, 50);
                ctx.strokeStyle = '#4ade80';
                ctx.lineWidth = 1;
                ctx.strokeRect(10, 10, width - 20, 50);

                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 9px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('‚ñ§ HPACK Static Table', 15, 22);

                ctx.font = '7px monospace';
                ctx.fillStyle = '#94a3b8';
                ctx.fillText('[1]:method GET  [2]:scheme https  [3]:path /  [4]:authority', 15, 35);
                ctx.fillText('[15]:accept-encoding gzip  [16]:accept-language  [17]:cache-control', 15, 45);
                ctx.fillText('[32]:authorization  [33]:user-agent  ...', 15, 55);

                let totalSize = 0;
                let currentReq = 0;

                const interval = setInterval(() => {
                    if (currentReq >= numRequests) {
                        clearInterval(interval);
                        const http1Total = headers.reduce((sum, h) => sum + h.size, 0) * numRequests;
                        const reduction = ((http1Total - totalSize) / http1Total * 100).toFixed(1);
                        document.getElementById('hpackHttp2Size').innerHTML =
                            `<i class="fas fa-box"></i> Total: ${totalSize} bytes | <i class="fas fa-circle" style="color: #4ade80;"></i> Comprimido`;
                        document.getElementById('hpackImprovement').innerHTML =
                            `<i class="fas fa-compress-arrows-alt"></i> HPACK ahorra <strong>${http1Total - totalSize} bytes (${reduction}%)</strong> usando tabla de √≠ndices`;
                        return;
                    }

                    const y = 75 + currentReq * 55;

                    // Primera request: headers completos
                    // Siguientes: solo √≠ndices
                    const isFirst = currentReq === 0;
                    const headerSize = isFirst ?
                        headers.reduce((sum, h) => sum + h.size, 0) :
                        Math.floor(headers.length * 2.5); // ~2.5 bytes por √≠ndice

                    totalSize += headerSize;

                    const packetWidth = Math.min((width - 100) * (headerSize / 300), width - 100);

                    // Paquete
                    ctx.fillStyle = isFirst ? 'rgba(74, 222, 128, 0.2)' : 'rgba(34, 197, 94, 0.2)';
                    ctx.fillRect(80, y, packetWidth, 45);
                    ctx.strokeStyle = isFirst ? '#4ade80' : '#22c55e';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(80, y, packetWidth, 45);

                    // Etiqueta
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`Request ${currentReq + 1}`, 10, y + 12);

                    // Contenido
                    ctx.font = '8px monospace';
                    if (isFirst) {
                        ctx.fillStyle = '#e2e8f0';
                        headers.slice(0, 4).forEach((h, i) => {
                            ctx.fillText(`${h.key}: ${h.value}`, 85, y + 15 + i * 8);
                        });
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(`... +${headers.length - 4} m√°s`, 85, y + 47);
                    } else {
                        ctx.fillStyle = '#fbbf24';
                        ctx.fillText('# √çndices: [1][2][3:12345][4]', 85, y + 20);
                        ctx.fillText('[33][15][16][17][32:Bearer...]', 85, y + 30);
                        ctx.fillStyle = '#22c55e';
                        ctx.font = 'bold 8px Arial';
                        ctx.fillText('‚àö Referencia a tabla', 85, y + 42);
                    }

                    // Tama√±o
                    ctx.fillStyle = isFirst ? '#4ade80' : '#22c55e';
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${headerSize}B`, width - 10, y + 25);

                    if (!isFirst) {
                        ctx.fillStyle = '#fbbf24';
                        ctx.font = '8px Arial';
                        ctx.fillText('‚Üì 90%', width - 10, y + 38);
                    }

                    document.getElementById('hpackHttp2Size').innerHTML =
                        `<i class="fas fa-box"></i> Acumulado: ${totalSize} bytes | <i class="fas fa-circle" style="color: #4ade80;"></i> Comprimido`;

                    currentReq++;
                }, 400);
            }

            // ===== DEMO 3: SERVER PUSH - E-commerce Product Page =====
            function runServerPushDemo() {
                const resources = [
                    { name: 'dashboard.html', icon: '‚ñ≠', desc: 'Dashboard bancario', time: 50 },
                    { name: 'banking.css', icon: '‚ó®', desc: 'Estilos', time: 40 },
                    { name: 'app.js', icon: '‚ö°', desc: 'L√≥gica app', time: 60 },
                    { name: 'promociones.json', icon: '‚óé', desc: 'Ofertas activas', time: 30 },
                    { name: 'tasas.json', icon: '‚ñä', desc: 'Tasas de inter√©s', time: 25 }
                ];

                animateHttp1Push(resources);
                setTimeout(() => animateHttp2Push(resources), 100);
            }

            function animateHttp1Push(resources) {
                const canvas = document.getElementById('pushHttp1Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 40;
                const serverX = width - 60;
                const centerX = width / 2;

                // Dibujar endpoints
                ctx.fillStyle = '#f87171';
                ctx.fillRect(clientX - 20, 20, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚ñØ', clientX, 38);
                ctx.fillText('Browser', clientX, 52);

                ctx.fillStyle = '#f87171';
                ctx.fillRect(serverX - 20, 20, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('‚óâ', serverX, 38);
                ctx.fillText('Server', serverX, 52);

                let http1Time = 0;
                let currentResource = 0;

                const http1Interval = setInterval(() => {
                    if (currentResource >= resources.length) {
                        clearInterval(http1Interval);
                        document.getElementById('pushHttp1Time').textContent =
                            `‚è±Ô∏è Total: ${http1Time}ms | üî¥ ${resources.length} round-trips`;
                        return;
                    }

                    const resource = resources[currentResource];
                    const y = 80 + currentResource * 70;

                    // Request (cliente ‚Üí servidor)
                    let requestProgress = 0;
                    const requestInterval = setInterval(() => {
                        requestProgress += 8;
                        if (requestProgress > 100) {
                            clearInterval(requestInterval);

                            // Response (servidor ‚Üí cliente)
                            setTimeout(() => {
                                let responseProgress = 0;
                                const responseInterval = setInterval(() => {
                                    responseProgress += 8;
                                    if (responseProgress > 100) {
                                        clearInterval(responseInterval);
                                        currentResource++;
                                        return;
                                    }

                                    ctx.clearRect(0, y - 15, width, 70);

                                    // T√≠tulo del recurso
                                    ctx.fillStyle = '#ffffff';
                                    ctx.font = 'bold 11px Arial';
                                    ctx.textAlign = 'left';
                                    ctx.fillText(`${resource.icon} ${resource.name}`, 10, y - 5);
                                    ctx.font = '9px Arial';
                                    ctx.fillStyle = '#94a3b8';
                                    ctx.fillText(resource.desc, 10, y + 8);

                                    // Request arrow (completo)
                                    ctx.fillStyle = '#60a5fa';
                                    ctx.fillRect(clientX + 25, y + 15, centerX - clientX - 35, 6);
                                    ctx.beginPath();
                                    ctx.moveTo(centerX - 10, y + 18);
                                    ctx.lineTo(centerX, y + 13);
                                    ctx.lineTo(centerX, y + 23);
                                    ctx.fill();

                                    ctx.fillStyle = '#60a5fa';
                                    ctx.font = '8px Arial';
                                    ctx.textAlign = 'center';
                                    ctx.fillText('REQUEST', centerX - 50, y + 12);

                                    // Response arrow (animado)
                                    const respWidth = ((centerX - clientX - 35) * responseProgress) / 100;
                                    ctx.fillStyle = '#4ade80';
                                    ctx.fillRect(serverX - 25 - respWidth, y + 30, respWidth, 6);
                                    ctx.beginPath();
                                    ctx.moveTo(serverX - 25 - respWidth, y + 33);
                                    ctx.lineTo(serverX - 25 - respWidth - 10, y + 28);
                                    ctx.lineTo(serverX - 25 - respWidth - 10, y + 38);
                                    ctx.fill();

                                    ctx.fillStyle = '#4ade80';
                                    ctx.font = '8px Arial';
                                    ctx.textAlign = 'center';
                                    ctx.fillText('RESPONSE', centerX + 50, y + 42);

                                    // Tiempo
                                    ctx.fillStyle = '#fbbf24';
                                    ctx.font = 'bold 9px Arial';
                                    ctx.textAlign = 'right';
                                    ctx.fillText(`+${resource.time}ms`, width - 10, y + 25);

                                    http1Time += 5;
                                    document.getElementById('pushHttp1Time').textContent =
                                        `‚è±Ô∏è Tiempo: ${http1Time}ms | üî¥ Esperando...`;
                                }, 20);
                            }, 50);
                            return;
                        }

                        ctx.clearRect(0, y - 15, width, 70);

                        // T√≠tulo
                        ctx.fillStyle = '#ffffff';
                        ctx.font = 'bold 11px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(`${resource.icon} ${resource.name}`, 10, y - 5);
                        ctx.font = '9px Arial';
                        ctx.fillStyle = '#94a3b8';
                        ctx.fillText(resource.desc, 10, y + 8);

                        // Request arrow (animado)
                        const reqWidth = ((centerX - clientX - 35) * requestProgress) / 100;
                        ctx.fillStyle = '#60a5fa';
                        ctx.fillRect(clientX + 25, y + 15, reqWidth, 6);
                        ctx.beginPath();
                        ctx.moveTo(clientX + 25 + reqWidth, y + 18);
                        ctx.lineTo(clientX + 25 + reqWidth + 10, y + 13);
                        ctx.lineTo(clientX + 25 + reqWidth + 10, y + 23);
                        ctx.fill();

                        ctx.fillStyle = '#60a5fa';
                        ctx.font = '8px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('REQUEST', centerX - 50, y + 12);

                        http1Time += 5;
                        document.getElementById('pushHttp1Time').textContent =
                            `‚è±Ô∏è Tiempo: ${http1Time}ms | üî¥ Solicitando...`;
                    }, 20);
                }, 200);
            }

            function animateHttp2Push(resources) {
                const canvas = document.getElementById('pushHttp2Canvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 40;
                const serverX = width - 60;
                const centerX = width / 2;

                // Dibujar endpoints
                ctx.fillStyle = '#4ade80';
                ctx.fillRect(clientX - 20, 20, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚ñØ', clientX, 38);
                ctx.fillText('Browser', clientX, 52);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(serverX - 20, 20, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('‚óâ', serverX, 38);
                ctx.fillText('Server', serverX, 52);

                let http2Time = 0;

                // Request inicial solo para el HTML
                const firstResource = resources[0];
                const y0 = 80;

                let initialProgress = 0;
                const initialInterval = setInterval(() => {
                    initialProgress += 8;
                    if (initialProgress > 100) {
                        clearInterval(initialInterval);

                        // Server Push de todos los dem√°s recursos simult√°neamente
                        const pushResources = resources.slice(1);
                        const pushProgresses = pushResources.map(() => 0);

                        const pushInterval = setInterval(() => {
                            let allComplete = true;

                            pushProgresses.forEach((prog, i) => {
                                if (prog < 100) {
                                    allComplete = false;
                                    pushProgresses[i] += 8;
                                }
                            });

                            ctx.clearRect(0, 150, width, height - 150);

                            pushResources.forEach((resource, i) => {
                                const y = 160 + i * 60;

                                // T√≠tulo
                                ctx.fillStyle = '#fbbf24';
                                ctx.font = 'bold 10px Arial';
                                ctx.textAlign = 'left';
                                ctx.fillText('‚ñ≤ PUSH', 10, y - 5);

                                ctx.fillStyle = '#ffffff';
                                ctx.font = 'bold 11px Arial';
                                ctx.fillText(`${resource.icon} ${resource.name}`, 60, y - 5);
                                ctx.font = '9px Arial';
                                ctx.fillStyle = '#94a3b8';
                                ctx.fillText(resource.desc, 60, y + 8);

                                // Push arrow (servidor ‚Üí cliente, sin request previo)
                                const pushWidth = ((centerX - clientX - 35) * pushProgresses[i]) / 100;
                                ctx.fillStyle = '#22c55e';
                                ctx.fillRect(serverX - 25 - pushWidth, y + 15, pushWidth, 8);
                                ctx.beginPath();
                                ctx.moveTo(serverX - 25 - pushWidth, y + 19);
                                ctx.lineTo(serverX - 25 - pushWidth - 10, y + 13);
                                ctx.lineTo(serverX - 25 - pushWidth - 10, y + 25);
                                ctx.fill();

                                ctx.fillStyle = '#22c55e';
                                ctx.font = 'bold 8px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText('PUSH (sin request)', centerX, y + 12);

                                // Checkmark cuando completa
                                if (pushProgresses[i] >= 100) {
                                    ctx.fillStyle = '#22c55e';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('‚àö', clientX - 30, y + 22);
                                }
                            });

                            http2Time += 5;
                            document.getElementById('pushHttp2Time').innerHTML =
                                `<i class="fas fa-stopwatch"></i> Tiempo: ${http2Time}ms | <i class="fas fa-circle" style="color: #4ade80;"></i> Push proactivo`;

                            if (allComplete) {
                                clearInterval(pushInterval);

                                // Calcular mejora
                                const http1Total = resources.reduce((sum, r) => sum + r.time, 0) + (resources.length * 50);
                                const savedTime = http1Total - http2Time;
                                const improvement = ((savedTime / http1Total) * 100).toFixed(1);

                                document.getElementById('pushHttp2Time').textContent =
                                    `‚è±Ô∏è Total: ${http2Time}ms | üü¢ 1 round-trip`;
                                document.getElementById('pushImprovement').innerHTML =
                                    `<i class="fas fa-rocket"></i> Server Push ahorra <strong>${savedTime}ms (${improvement}%)</strong> enviando recursos proactivamente`;
                            }
                        }, 20);
                        return;
                    }

                    ctx.clearRect(0, y0 - 15, canvas.width, 70);

                    // T√≠tulo
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`${firstResource.icon} ${firstResource.name}`, 10, y0 - 5);
                    ctx.font = '9px Arial';
                    ctx.fillStyle = '#94a3b8';
                    ctx.fillText(firstResource.desc, 10, y0 + 8);

                    // Request arrow
                    const reqWidth = ((centerX - clientX - 35) * initialProgress) / 100;
                    ctx.fillStyle = '#60a5fa';
                    ctx.fillRect(clientX + 25, y0 + 15, reqWidth, 6);
                    ctx.beginPath();
                    ctx.moveTo(clientX + 25 + reqWidth, y0 + 18);
                    ctx.lineTo(clientX + 25 + reqWidth + 10, y0 + 13);
                    ctx.lineTo(clientX + 25 + reqWidth + 10, y0 + 23);
                    ctx.fill();

                    // Response arrow
                    ctx.fillStyle = '#4ade80';
                    ctx.fillRect(serverX - 25 - reqWidth, y0 + 30, reqWidth, 6);
                    ctx.beginPath();
                    ctx.moveTo(serverX - 25 - reqWidth, y0 + 33);
                    ctx.lineTo(serverX - 25 - reqWidth - 10, y0 + 28);
                    ctx.lineTo(serverX - 25 - reqWidth - 10, y0 + 38);
                    ctx.fill();

                    http2Time += 5;
                    document.getElementById('pushHttp2Time').textContent =
                        `‚è±Ô∏è Tiempo: ${http2Time}ms | üü¢ Cargando HTML...`;
                }, 20);
            }

            // ===== WEBSOCKETS SIMULACIONES =====
            let currentWsDemo = 'handshake';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos WebSocket
                const wsTabs = document.querySelectorAll('.ws-tab');
                wsTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchWsDemo(demoType);
                    });
                });

                // Bot√≥n iniciar demo WebSocket
                const startWsDemo = document.getElementById('startWsDemo');
                if (startWsDemo) {
                    startWsDemo.addEventListener('click', function () {
                        const messages = parseInt(document.getElementById('wsMessages').value) || 5;

                        if (currentWsDemo === 'handshake') {
                            runHandshakeDemo(messages);
                        } else if (currentWsDemo === 'chat') {
                            runChatDemo(messages);
                        } else if (currentWsDemo === 'latency') {
                            runLatencyDemo(messages);
                        }
                    });
                }
            });

            function switchWsDemo(demoType) {
                currentWsDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.ws-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.ws-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }

                // Mostrar/ocultar controles
                const controlsDiv = document.getElementById('wsControls');
                if (demoType === 'latency') {
                    controlsDiv.style.display = 'none';
                } else {
                    controlsDiv.style.display = 'block';
                }
            }

            // ===== DEMO 1: HANDSHAKE - HTTP Polling vs WebSocket =====
            function runHandshakeDemo(numMessages) {
                animatePolling(numMessages);
                setTimeout(() => animateWebSocket(numMessages), 100);
            }

            function animatePolling(numMessages) {
                const canvas = document.getElementById('pollingCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 16);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 40;
                const serverX = width - 60;

                // Dibujar endpoints
                ctx.fillStyle = '#f87171';
                ctx.fillRect(clientX - 20, 10, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚ñØ', clientX, 28);
                ctx.fillText('Client', clientX, 42);

                ctx.fillStyle = '#f87171';
                ctx.fillRect(serverX - 20, 10, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('‚óâ', serverX, 28);
                ctx.fillText('Server', serverX, 42);

                let connections = 0;
                let currentMsg = 0;

                const interval = setInterval(() => {
                    if (currentMsg >= numMessages) {
                        clearInterval(interval);
                        document.getElementById('pollingInfo').textContent =
                            `üî¥ Total: ${connections} conexiones | Overhead alto`;
                        return;
                    }

                    const y = 70 + (currentMsg % 3) * 40;

                    // Nueva conexi√≥n para cada mensaje
                    connections++;

                    let progress = 0;
                    const animInterval = setInterval(() => {
                        progress += 10;
                        if (progress > 200) {
                            clearInterval(animInterval);
                            currentMsg++;
                            return;
                        }

                        ctx.clearRect(0, y - 5, canvas.width, 35);

                        // Handshake + Request
                        if (progress <= 100) {
                            const width = ((serverX - clientX - 40) * progress) / 100;

                            // L√≠nea de conexi√≥n
                            ctx.strokeStyle = '#f87171';
                            ctx.lineWidth = 2;
                            ctx.setLineDash([3, 3]);
                            ctx.beginPath();
                            ctx.moveTo(clientX + 20, y + 10);
                            ctx.lineTo(clientX + 20 + width, y + 10);
                            ctx.stroke();
                            ctx.setLineDash([]);

                            // Paquete
                            ctx.fillStyle = '#f87171';
                            ctx.fillRect(clientX + 20 + width - 10, y + 5, 10, 10);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '8px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('‚óà', clientX + 20 + width - 5, y + 13);
                        }

                        // Response + Close
                        if (progress > 100) {
                            const respProgress = progress - 100;
                            const width = ((serverX - clientX - 40) * respProgress) / 100;

                            // L√≠nea de respuesta
                            ctx.strokeStyle = '#4ade80';
                            ctx.lineWidth = 2;
                            ctx.setLineDash([3, 3]);
                            ctx.beginPath();
                            ctx.moveTo(serverX - 20, y + 20);
                            ctx.lineTo(serverX - 20 - width, y + 20);
                            ctx.stroke();
                            ctx.setLineDash([]);

                            // Paquete
                            ctx.fillStyle = '#4ade80';
                            ctx.fillRect(serverX - 20 - width - 10, y + 15, 10, 10);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '8px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('üì¨', serverX - 20 - width - 5, y + 23);

                            // X de cierre
                            if (respProgress > 80) {
                                ctx.fillStyle = '#f87171';
                                ctx.font = 'bold 12px Arial';
                                ctx.fillText('√ó', width / 2, y + 18);
                            }
                        }

                        // Contador
                        ctx.fillStyle = '#fbbf24';
                        ctx.font = 'bold 9px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(`Conn #${connections}`, 10, y + 15);

                        document.getElementById('pollingInfo').textContent =
                            `üî¥ Conexiones: ${connections} | Polling cada request`;
                    }, 15);
                }, 300);
            }

            function animateWebSocket(numMessages) {
                const canvas = document.getElementById('wsCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 16);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 40;
                const serverX = width - 60;

                // Dibujar endpoints
                ctx.fillStyle = '#4ade80';
                ctx.fillRect(clientX - 20, 10, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚ñØ', clientX, 28);
                ctx.fillText('Client', clientX, 42);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(serverX - 20, 10, 40, 40);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('‚óâ', serverX, 28);
                ctx.fillText('Server', serverX, 42);

                // Handshake inicial
                let progress = 0;
                const handshakeInterval = setInterval(() => {
                    progress += 10;
                    if (progress > 100) {
                        clearInterval(handshakeInterval);

                        // Dibujar conexi√≥n persistente
                        ctx.strokeStyle = '#22c55e';
                        ctx.lineWidth = 3;
                        ctx.beginPath();
                        ctx.moveTo(clientX + 20, 30);
                        ctx.lineTo(serverX - 20, 30);
                        ctx.stroke();

                        ctx.fillStyle = '#22c55e';
                        ctx.font = 'bold 9px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('‚ö° CONEXION PERSISTENTE', width / 2, 25);

                        // Enviar mensajes por la conexi√≥n persistente
                        let currentMsg = 0;
                        const msgInterval = setInterval(() => {
                            if (currentMsg >= numMessages) {
                                clearInterval(msgInterval);
                                document.getElementById('wsInfo').textContent =
                                    `üü¢ Total: 1 conexi√≥n | ${numMessages} mensajes`;

                                const pollingConns = numMessages;
                                const reduction = ((pollingConns - 1) / pollingConns * 100).toFixed(0);
                                document.getElementById('wsHandshakeResult').innerHTML =
                                    `<i class="fas fa-bolt"></i> WebSocket reduce <strong>${reduction}% las conexiones</strong> (${pollingConns} ‚Üí 1)`;
                                return;
                            }

                            const y = 60 + (currentMsg % 4) * 30;

                            let msgProgress = 0;
                            const msgAnimInterval = setInterval(() => {
                                msgProgress += 15;
                                if (msgProgress > 100) {
                                    clearInterval(msgAnimInterval);
                                    currentMsg++;
                                    return;
                                }

                                ctx.clearRect(clientX + 25, y - 5, serverX - clientX - 50, 25);

                                // Mensaje viajando
                                const msgX = clientX + 25 + ((serverX - clientX - 50) * msgProgress) / 100;

                                ctx.fillStyle = currentMsg % 2 === 0 ? '#60a5fa' : '#a78bfa';
                                ctx.fillRect(msgX - 8, y, 16, 16);
                                ctx.fillStyle = '#ffffff';
                                ctx.font = '10px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText('üí¨', msgX, y + 11);

                                // N√∫mero de mensaje
                                ctx.fillStyle = '#fbbf24';
                                ctx.font = 'bold 8px Arial';
                                ctx.fillText(`#${currentMsg + 1}`, msgX, y - 2);

                                document.getElementById('wsInfo').textContent =
                                    `üü¢ Conexi√≥n: 1 | Mensaje ${currentMsg + 1}/${numMessages}`;
                            }, 20);
                        }, 250);
                        return;
                    }

                    ctx.clearRect(0, 55, width, 20);

                    // Handshake animation
                    const lineWidth = ((serverX - clientX - 40) * progress) / 100;
                    ctx.strokeStyle = '#fbbf24';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(clientX + 20, 65);
                    ctx.lineTo(clientX + 20 + lineWidth, 65);
                    ctx.stroke();
                    ctx.setLineDash([]);

                    ctx.fillStyle = '#fbbf24';
                    ctx.font = 'bold 9px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ü§ù HTTP Upgrade', width / 2, 60);

                    document.getElementById('wsInfo').textContent =
                        `üü° Estableciendo conexi√≥n WebSocket...`;
                }, 30);
            }

            // ===== DEMO 2: CHAT EN TIEMPO REAL =====
            function runChatDemo(numMessages) {
                const canvas = document.getElementById('chatCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const messages = [
                    { user: 'Cliente', text: 'Hola, necesito ayuda con una transferencia', color: '#60a5fa' },
                    { user: 'Soporte BdL', text: 'Con gusto le ayudo. ¬øQu√© necesita?', color: '#a78bfa' },
                    { user: 'Cliente', text: 'No puedo transferir a cuenta del Pichincha', color: '#60a5fa' },
                    { user: 'Soporte BdL', text: 'Verifico su cuenta. Un momento por favor', color: '#a78bfa' },
                    { user: 'Soporte BdL', text: 'Ya est√° solucionado. Puede intentar de nuevo', color: '#a78bfa' },
                    { user: 'Cliente', text: 'Perfecto! Ya funcion√≥. Gracias!', color: '#60a5fa' },
                    { user: 'Soporte BdL', text: '¬øNecesita algo m√°s?', color: '#a78bfa' },
                    { user: 'Cliente', text: 'No, eso es todo. Excelente servicio!', color: '#60a5fa' },
                    { user: 'Soporte BdL', text: 'Gracias por confiar en Banco de Loja ‚ñ†', color: '#a78bfa' },
                    { user: 'Cliente', text: 'Hasta luego!', color: '#60a5fa' }
                ];

                const selectedMessages = messages.slice(0, numMessages);
                let currentMsg = 0;
                let yOffset = 20;

                // T√≠tulo
                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üí¨ Chat Room - WebSocket Connection', canvas.width / 2, 15);

                const interval = setInterval(() => {
                    if (currentMsg >= selectedMessages.length) {
                        clearInterval(interval);
                        document.getElementById('chatInfo').textContent =
                            `üí¨ ${selectedMessages.length} mensajes enviados | Latencia < 10ms`;
                        document.getElementById('chatResult').innerHTML =
                            `<i class="fas fa-comments"></i> Chat en tiempo real con <strong>comunicaci√≥n bidireccional simult√°nea</strong>`;
                        return;
                    }

                    const msg = selectedMessages[currentMsg];
                    const isAlice = msg.user === 'Alice';
                    const x = isAlice ? 20 : canvas.width - 20;
                    const align = isAlice ? 'left' : 'right';

                    // Burbuja de mensaje
                    const textWidth = ctx.measureText(msg.text).width + 20;
                    const bubbleX = isAlice ? x : x - textWidth;

                    ctx.fillStyle = msg.color + '30';
                    ctx.fillRect(bubbleX, yOffset, textWidth, 40);
                    ctx.strokeStyle = msg.color;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(bubbleX, yOffset, textWidth, 40);

                    // Usuario
                    ctx.fillStyle = msg.color;
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = align;
                    ctx.fillText(msg.user, isAlice ? x + 10 : x - 10, yOffset + 15);

                    // Mensaje
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '9px Arial';
                    ctx.fillText(msg.text, isAlice ? x + 10 : x - 10, yOffset + 30);

                    // Timestamp
                    ctx.fillStyle = '#94a3b8';
                    ctx.font = '7px Arial';
                    ctx.fillText(`${currentMsg * 0.5}s`, isAlice ? x + 10 : x - 10, yOffset + 38);

                    yOffset += 45;
                    currentMsg++;

                    document.getElementById('chatInfo').textContent =
                        `üí¨ Mensajes: ${currentMsg}/${selectedMessages.length} | En tiempo real`;
                }, 500);
            }

            // ===== DEMO 3: COMPARACI√ìN DE LATENCIA =====
            function runLatencyDemo(numTests = 10) {
                const canvas = document.getElementById('latencyCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // T√≠tulo
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Latencia: HTTP Polling vs WebSocket', width / 2, 20);

                // Leyenda
                ctx.fillStyle = '#f87171';
                ctx.fillRect(20, 35, 15, 15);
                ctx.fillStyle = '#ffffff';
                ctx.font = '10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('HTTP Polling', 40, 47);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(width / 2 + 20, 35, 15, 15);
                ctx.fillText('WebSocket', width / 2 + 40, 47);

                // Ejes
                ctx.strokeStyle = '#94a3b8';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(40, 80);
                ctx.lineTo(40, 380);
                ctx.lineTo(width - 40, 380);
                ctx.stroke();

                ctx.fillStyle = '#94a3b8';
                ctx.font = '9px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Latencia (ms)', 20, 230);
                ctx.fillText('Requests', width / 2, 395);

                // Escala Y
                for (let i = 0; i <= 5; i++) {
                    const y = 380 - (i * 60);
                    const latency = i * 50;
                    ctx.fillStyle = '#94a3b8';
                    ctx.font = '8px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${latency}`, 35, y + 3);

                    ctx.strokeStyle = '#94a3b833';
                    ctx.beginPath();
                    ctx.moveTo(40, y);
                    ctx.lineTo(width - 40, y);
                    ctx.stroke();
                }

                let currentTest = 0;
                const pollingLatencies = [];
                const wsLatencies = [];

                const interval = setInterval(() => {
                    if (currentTest >= numTests) {
                        clearInterval(interval);

                        const avgPolling = pollingLatencies.reduce((a, b) => a + b, 0) / pollingLatencies.length;
                        const avgWs = wsLatencies.reduce((a, b) => a + b, 0) / wsLatencies.length;
                        const improvement = ((avgPolling - avgWs) / avgPolling * 100).toFixed(0);

                        document.getElementById('latencyInfo').textContent =
                            `‚ñä Polling: ${avgPolling.toFixed(0)}ms | WebSocket: ${avgWs.toFixed(0)}ms`;
                        document.getElementById('latencyResult').innerHTML =
                            `<i class="fas fa-tachometer-alt"></i> WebSocket es <strong>${improvement}% m√°s r√°pido</strong> (${(avgPolling - avgWs).toFixed(0)}ms menos latencia)`;
                        return;
                    }

                    // Generar latencias simuladas
                    const pollingLatency = 150 + Math.random() * 100; // 150-250ms
                    const wsLatency = 5 + Math.random() * 15; // 5-20ms

                    pollingLatencies.push(pollingLatency);
                    wsLatencies.push(wsLatency);

                    const x = 50 + (currentTest * ((width - 100) / numTests));

                    // Barra HTTP Polling
                    const pollingHeight = (pollingLatency / 250) * 300;
                    ctx.fillStyle = '#f87171';
                    ctx.fillRect(x - 8, 380 - pollingHeight, 8, pollingHeight);

                    // Barra WebSocket
                    const wsHeight = (wsLatency / 250) * 300;
                    ctx.fillStyle = '#4ade80';
                    ctx.fillRect(x + 2, 380 - wsHeight, 8, wsHeight);

                    // Valores
                    ctx.fillStyle = '#f87171';
                    ctx.font = '7px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${pollingLatency.toFixed(0)}`, x - 4, 380 - pollingHeight - 3);

                    ctx.fillStyle = '#4ade80';
                    ctx.fillText(`${wsLatency.toFixed(0)}`, x + 6, 380 - wsHeight - 3);

                    currentTest++;

                    const avgPolling = pollingLatencies.reduce((a, b) => a + b, 0) / pollingLatencies.length;
                    const avgWs = wsLatencies.reduce((a, b) => a + b, 0) / wsLatencies.length;

                    document.getElementById('latencyInfo').textContent =
                        `‚ñä Test ${currentTest}/${numTests} | Polling: ${avgPolling.toFixed(0)}ms | WS: ${avgWs.toFixed(0)}ms`;
                }, 400);
            }
        </script>

        <!-- Slide 5: WebSockets -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-plug"></i> WebSockets: Conexi√≥n Persistente
                Bidireccional</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Caracter√≠sticas -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Notificaciones en tiempo real cuando llega una transferencia"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Caracter√≠sticas</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Full-duplex</strong>: Bidireccional</li>
                            <li><strong>Persistente</strong>: Conexi√≥n continua</li>
                            <li><strong>Bajo overhead</strong>: Sin headers repetidos</li>
                            <li><strong>Tiempo real</strong>: Latencia m√≠nima</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Notificaciones y soporte en vivo
                        </p>
                    </div>

                    <!-- Pesta√±as de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="ws-tab active" data-demo="handshake"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Handshake
                        </button>
                        <button class="ws-tab" data-demo="chat"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Chat
                        </button>
                        <button class="ws-tab" data-demo="latency"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Latencia
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startWsDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                        <div id="wsControls" style="margin-top: 6px; font-size: 0.75rem;">
                            <label style="color: #e2e8f0;">Mensajes: </label>
                            <input type="number" id="wsMessages" value="5" min="3" max="10"
                                style="width: 50px; padding: 3px; background: rgba(255,255,255,0.1); border: 1px solid var(--uide-accent); color: white; border-radius: 4px; font-size: 0.75rem;">
                        </div>
                    </div>
                </div>

                <!-- Columna Derecha: Visualizaci√≥n -->
                <div id="wsDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Handshake -->
                    <div id="demoHandshake" class="ws-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-times-circle"></i> HTTP Polling - M√∫ltiples Conexiones
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; position: relative; overflow: hidden; height: 200px;">
                                <canvas id="pollingCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="pollingInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Conexiones: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 45%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-check-circle"></i> WebSocket - Conexi√≥n Persistente
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; position: relative; overflow: hidden; height: 200px;">
                                <canvas id="wsCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="wsInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Conexiones: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="wsHandshakeResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Comparaci√≥n de rendimiento HTTP/1.1 vs HTTP/2
                            </div>
                        </div>
                    </div>

                    <!-- Demo Chat -->
                    <div id="demoChat" class="ws-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-comments"></i> Chat en Tiempo Real - WebSocket
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 420px;">
                                <canvas id="chatCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="chatInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Mensajes: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="chatResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el chat
                            </div>
                        </div>
                    </div>

                    <!-- Demo Latencia -->
                    <div id="demoLatency" class="ws-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-tachometer-alt"></i> Comparaci√≥n de Latencia
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 420px;">
                                <canvas id="latencyCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="latencyInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Latencia promedio: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="latencyResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para medir latencia
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 6: gRPC Intro -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-rocket"></i> gRPC: Remote Procedure Call Moderno</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Caracter√≠sticas -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Comunicaci√≥n entre microsservicios del Banco de Loja"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Ventajas</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Protobuf</strong>: Binario compacto</li>
                            <li><strong>HTTP/2</strong>: Multiplexaci√≥n</li>
                            <li><strong>Baja latencia</strong>: Microsservicios</li>
                            <li><strong>Streaming</strong>: Bidireccional</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Microsservicios internos del banco
                        </p>
                    </div>

                    <!-- Pesta√±as de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="grpc-tab active" data-demo="rpc"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            RPC Flow
                        </button>
                        <button class="grpc-tab" data-demo="payload"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            JSON vs Protobuf
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startGrpcDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualizaci√≥n -->
                <div id="grpcDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo RPC Flow -->
                    <div id="demoRpc" class="grpc-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-rocket"></i> gRPC Remote Procedure Call
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                                <canvas id="rpcCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="rpcInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Tiempo: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="rpcResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el flujo RPC
                            </div>
                        </div>
                    </div>

                    <!-- Demo Payload Comparison -->
                    <div id="demoPayload" class="grpc-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-file-code"></i> JSON (Texto)
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="jsonCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="jsonSize"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa;">
                                Tama√±o: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-file-binary"></i> Protobuf (Binario)
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="protobufCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="protobufSize"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Tama√±o: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="payloadResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para comparar tama√±os
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== GRPC SIMULACIONES =====
            let currentGrpcDemo = 'rpc';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos gRPC
                const grpcTabs = document.querySelectorAll('.grpc-tab');
                grpcTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchGrpcDemo(demoType);
                    });
                });

                // Bot√≥n iniciar demo gRPC
                const startGrpcDemo = document.getElementById('startGrpcDemo');
                if (startGrpcDemo) {
                    startGrpcDemo.addEventListener('click', function () {
                        if (currentGrpcDemo === 'rpc') {
                            runRpcFlowDemo();
                        } else if (currentGrpcDemo === 'payload') {
                            runPayloadComparisonDemo();
                        }
                    });
                }
            });

            function switchGrpcDemo(demoType) {
                currentGrpcDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.grpc-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.grpc-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: RPC FLOW - Visualizaci√≥n de llamada remota =====
            function runRpcFlowDemo() {
                const canvas = document.getElementById('rpcCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const clientX = 50;
                const serverX = width - 80;
                const centerX = width / 2;

                // Dibujar cliente y servidor
                ctx.fillStyle = '#60a5fa';
                ctx.fillRect(clientX - 25, 20, 50, 50);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚ñØ', clientX, 42);
                ctx.fillText('Client', clientX, 58);

                ctx.fillStyle = '#4ade80';
                ctx.fillRect(serverX - 25, 20, 50, 50);
                ctx.fillStyle = '#ffffff';
                ctx.fillText('‚óâ', serverX, 42);
                ctx.fillText('Server', serverX, 58);

                const steps = [
                    { name: '1. Invocaci√≥n M√©todo', y: 100, desc: 'getUserById(123)', color: '#60a5fa', time: 5 },
                    { name: '2. Serializaci√≥n Protobuf', y: 160, desc: 'Objeto ‚Üí Binario', color: '#a78bfa', time: 8 },
                    { name: '3. HTTP/2 Stream', y: 220, desc: 'Env√≠o por red', color: '#fbbf24', time: 15 },
                    { name: '4. Deserializaci√≥n', y: 280, desc: 'Binario ‚Üí Objeto', color: '#f472b6', time: 7 },
                    { name: '5. Ejecuci√≥n', y: 340, desc: 'L√≥gica del servidor', color: '#22c55e', time: 20 },
                    { name: '6. Respuesta', y: 400, desc: 'Retorno al cliente', color: '#4ade80', time: 12 }
                ];

                let currentStep = 0;
                let totalTime = 0;

                const interval = setInterval(() => {
                    if (currentStep >= steps.length) {
                        clearInterval(interval);
                        document.getElementById('rpcInfo').textContent =
                            `‚ö° Tiempo total: ${totalTime}ms | Latencia ultra-baja`;
                        document.getElementById('rpcResult').innerHTML =
                            `<i class="fas fa-bolt"></i> gRPC completa la llamada RPC en <strong>${totalTime}ms</strong> con serializaci√≥n binaria`;
                        return;
                    }

                    const step = steps[currentStep];

                    // Dibujar paso
                    ctx.fillStyle = step.color + '30';
                    ctx.fillRect(20, step.y - 20, width - 40, 50);
                    ctx.strokeStyle = step.color;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(20, step.y - 20, width - 40, 50);

                    // T√≠tulo del paso
                    ctx.fillStyle = step.color;
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(step.name, 30, step.y - 5);

                    // Descripci√≥n
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '10px Arial';
                    ctx.fillText(step.desc, 30, step.y + 10);

                    // Tiempo
                    ctx.fillStyle = '#fbbf24';
                    ctx.font = 'bold 9px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${step.time}ms`, width - 30, step.y + 5);

                    // Animaci√≥n de flujo
                    if (currentStep === 2) {
                        // HTTP/2 Stream - mostrar paquete viajando
                        let progress = 0;
                        const streamInterval = setInterval(() => {
                            progress += 10;
                            if (progress > 100) {
                                clearInterval(streamInterval);
                                return;
                            }

                            const x = clientX + ((serverX - clientX) * progress) / 100;

                            ctx.clearRect(clientX + 30, step.y + 15, serverX - clientX - 60, 15);

                            // L√≠nea de conexi√≥n
                            ctx.strokeStyle = step.color;
                            ctx.lineWidth = 2;
                            ctx.beginPath();
                            ctx.moveTo(clientX + 30, step.y + 22);
                            ctx.lineTo(x, step.y + 22);
                            ctx.stroke();

                            // Paquete
                            ctx.fillStyle = step.color;
                            ctx.fillRect(x - 8, step.y + 18, 16, 8);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '8px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('üì¶', x, step.y + 24);
                        }, 20);
                    } else if (currentStep === 5) {
                        // Respuesta - paquete regresando
                        let progress = 0;
                        const responseInterval = setInterval(() => {
                            progress += 10;
                            if (progress > 100) {
                                clearInterval(responseInterval);
                                return;
                            }

                            const x = serverX - ((serverX - clientX) * progress) / 100;

                            ctx.clearRect(clientX + 30, step.y + 15, serverX - clientX - 60, 15);

                            // L√≠nea de conexi√≥n
                            ctx.strokeStyle = step.color;
                            ctx.lineWidth = 2;
                            ctx.beginPath();
                            ctx.moveTo(serverX - 30, step.y + 22);
                            ctx.lineTo(x, step.y + 22);
                            ctx.stroke();

                            // Paquete
                            ctx.fillStyle = step.color;
                            ctx.fillRect(x - 8, step.y + 18, 16, 8);
                            ctx.fillStyle = '#ffffff';
                            ctx.font = '8px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('‚àö', x, step.y + 24);
                        }, 20);
                    }

                    totalTime += step.time;
                    currentStep++;

                    document.getElementById('rpcInfo').textContent =
                        `‚ö° Paso ${currentStep}/${steps.length} | Tiempo: ${totalTime}ms`;
                }, 600);
            }

            // ===== DEMO 2: PAYLOAD COMPARISON - JSON vs Protobuf =====
            function runPayloadComparisonDemo() {
                const userData = {
                    id: 12345,
                    name: 'Juan P√©rez',
                    email: 'juan.perez@example.com',
                    age: 28,
                    active: true,
                    roles: ['user', 'admin'],
                    created_at: '2024-01-15T10:30:00Z',
                    metadata: {
                        last_login: '2024-11-08T14:22:00Z',
                        login_count: 156
                    }
                };

                animateJsonPayload(userData);
                setTimeout(() => animateProtobufPayload(userData), 100);
            }

            function animateJsonPayload(data) {
                const canvas = document.getElementById('jsonCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // JSON string
                const jsonStr = JSON.stringify(data, null, 2);
                const jsonSize = new Blob([jsonStr]).size;

                // Dibujar JSON
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(10, 10, width - 20, height - 20);
                ctx.strokeStyle = '#60a5fa';
                ctx.lineWidth = 2;
                ctx.strokeRect(10, 10, width - 20, height - 20);

                // Contenido JSON
                const lines = jsonStr.split('\n').slice(0, 10);
                ctx.fillStyle = '#e2e8f0';
                ctx.font = '8px monospace';
                ctx.textAlign = 'left';

                lines.forEach((line, i) => {
                    ctx.fillText(line.substring(0, 50), 15, 25 + i * 12);
                });

                if (jsonStr.split('\n').length > 10) {
                    ctx.fillStyle = '#94a3b8';
                    ctx.fillText('...', 15, 25 + 10 * 12);
                }

                // Visualizaci√≥n de bytes
                const bytesPerRow = 20;
                const totalBytes = jsonSize;
                const rows = Math.ceil(totalBytes / bytesPerRow);

                ctx.fillStyle = '#60a5fa';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${totalBytes} bytes`, width / 2, height - 10);

                document.getElementById('jsonSize').textContent =
                    `‚ñ≠ Tama√±o: ${jsonSize} bytes | Texto legible`;
            }

            function animateProtobufPayload(data) {
                const canvas = document.getElementById('protobufCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // Calcular tama√±o aproximado de Protobuf (60-70% del JSON)
                const jsonSize = new Blob([JSON.stringify(data)]).size;
                const protobufSize = Math.floor(jsonSize * 0.35); // ~65% reducci√≥n

                // Dibujar contenedor
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(10, 10, width - 20, height - 20);
                ctx.strokeStyle = '#4ade80';
                ctx.lineWidth = 2;
                ctx.strokeRect(10, 10, width - 20, height - 20);

                // Representaci√≥n binaria
                ctx.font = '9px monospace';
                ctx.textAlign = 'left';

                // Generar representaci√≥n binaria visual
                let y = 25;
                for (let i = 0; i < 8; i++) {
                    let line = '';
                    for (let j = 0; j < 16; j++) {
                        const byte = Math.floor(Math.random() * 256).toString(16).padStart(2, '0');
                        line += byte + ' ';
                    }

                    ctx.fillStyle = '#4ade80';
                    ctx.fillText(line, 15, y);
                    y += 12;
                }

                ctx.fillStyle = '#94a3b8';
                ctx.fillText('...', 15, y);

                // Etiquetas de campos
                ctx.fillStyle = '#fbbf24';
                ctx.font = '8px Arial';
                ctx.textAlign = 'right';
                ctx.fillText('Field 1: id', width - 15, 35);
                ctx.fillText('Field 2: name', width - 15, 50);
                ctx.fillText('Field 3: email', width - 15, 65);
                ctx.fillText('Field 4: age', width - 15, 80);
                ctx.fillText('...', width - 15, 95);

                // Tama√±o
                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${protobufSize} bytes`, width / 2, height - 10);

                document.getElementById('protobufSize').textContent =
                    `üì¶ Tama√±o: ${protobufSize} bytes | Binario compacto`;

                // Calcular reducci√≥n
                const reduction = ((jsonSize - protobufSize) / jsonSize * 100).toFixed(0);
                const savedBytes = jsonSize - protobufSize;

                document.getElementById('payloadResult').innerHTML =
                    `<i class="fas fa-compress-alt"></i> Protobuf reduce <strong>${reduction}%</strong> el tama√±o (${savedBytes} bytes ahorrados)`;
            }
        </script>

        <!-- Slide 7: gRPC Limitaciones -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-exclamation-triangle"></i> gRPC: Limitaciones y
                Trade-offs</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Caracter√≠sticas -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "M√°s dependencias = m√°s actualizaciones frecuentes"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Complejidad</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Dependencias</strong>: Numerosas</li>
                            <li><strong>Actualizaciones</strong>: Frecuentes</li>
                            <li><strong>Acoplamiento</strong>: Fuerte</li>
                            <li><strong>Debugging</strong>: Complejo</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(248, 113, 113, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid #f87171; flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-exclamation-triangle"></i> HTTP/2 requerido
                        </p>
                    </div>

                    <!-- Pesta√±as de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="grpc-limit-tab active" data-demo="dependencies"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Dependencias
                        </button>
                        <button class="grpc-limit-tab" data-demo="updates"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Actualizaciones
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startGrpcLimitDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualizaci√≥n -->
                <div id="grpcLimitDemoContainer"
                    style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Dependencias -->
                    <div id="demoDependencies" class="grpc-limit-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-project-diagram"></i> Gr√°fico de Dependencias
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                                <canvas id="dependenciesCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="dependenciesInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Dependencias: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="dependenciesResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver las dependencias
                            </div>
                        </div>
                    </div>

                    <!-- Demo Actualizaciones -->
                    <div id="demoUpdates" class="grpc-limit-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #fbbf24; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #fbbf24; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-clock"></i> Timeline de Actualizaciones
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="updatesCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="updatesInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #fbbf24;">
                                Frecuencia: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="updatesResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el timeline
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== GRPC LIMITACIONES SIMULACIONES =====
            let currentGrpcLimitDemo = 'dependencies';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos gRPC Limitaciones
                const grpcLimitTabs = document.querySelectorAll('.grpc-limit-tab');
                grpcLimitTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchGrpcLimitDemo(demoType);
                    });
                });

                // Bot√≥n iniciar demo gRPC Limitaciones
                const startGrpcLimitDemo = document.getElementById('startGrpcLimitDemo');
                if (startGrpcLimitDemo) {
                    startGrpcLimitDemo.addEventListener('click', function () {
                        if (currentGrpcLimitDemo === 'dependencies') {
                            runDependenciesDemo();
                        } else if (currentGrpcLimitDemo === 'updates') {
                            runUpdatesDemo();
                        }
                    });
                }
            });

            function switchGrpcLimitDemo(demoType) {
                currentGrpcLimitDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.grpc-limit-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.grpc-limit-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: GR√ÅFICO DE DEPENDENCIAS =====
            function runDependenciesDemo() {
                const canvas = document.getElementById('dependenciesCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const centerX = width / 2;
                const centerY = height / 2;

                // gRPC en el centro
                ctx.fillStyle = '#f87171';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 40, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('gRPC', centerX, centerY - 5);
                ctx.font = '10px Arial';
                ctx.fillText('Core', centerX, centerY + 8);

                // Dependencias
                const dependencies = [
                    { name: 'HTTP/2', color: '#60a5fa', angle: 0 },
                    { name: 'Protobuf', color: '#a78bfa', angle: Math.PI / 4 },
                    { name: 'OpenSSL', color: '#f472b6', angle: Math.PI / 2 },
                    { name: 'c-ares', color: '#fbbf24', angle: 3 * Math.PI / 4 },
                    { name: 'zlib', color: '#4ade80', angle: Math.PI },
                    { name: 'abseil', color: '#fb923c', angle: 5 * Math.PI / 4 },
                    { name: 're2', color: '#14b8a6', angle: 3 * Math.PI / 2 },
                    { name: 'upb', color: '#8b5cf6', angle: 7 * Math.PI / 4 }
                ];

                const radius = 150;
                let currentDep = 0;

                const interval = setInterval(() => {
                    if (currentDep >= dependencies.length) {
                        clearInterval(interval);

                        // Comparaci√≥n con HTTP/REST
                        ctx.fillStyle = '#4ade80';
                        ctx.beginPath();
                        ctx.arc(centerX + 200, 80, 30, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#ffffff';
                        ctx.font = 'bold 10px Arial';
                        ctx.fillText('HTTP', centerX + 200, 78);
                        ctx.fillText('REST', centerX + 200, 90);

                        // Pocas dependencias
                        ctx.fillStyle = '#22c55e';
                        ctx.beginPath();
                        ctx.arc(centerX + 200, 130, 15, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '8px Arial';
                        ctx.fillText('JSON', centerX + 200, 133);

                        ctx.fillStyle = '#22c55e';
                        ctx.beginPath();
                        ctx.arc(centerX + 240, 100, 15, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#ffffff';
                        ctx.fillText('TLS', centerX + 240, 103);

                        // L√≠neas
                        ctx.strokeStyle = '#4ade80';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(centerX + 200, 110);
                        ctx.lineTo(centerX + 200, 115);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(centerX + 200, 110);
                        ctx.lineTo(centerX + 230, 100);
                        ctx.stroke();

                        document.getElementById('dependenciesInfo').textContent =
                            `üì¶ gRPC: ${dependencies.length} deps | HTTP/REST: 2-3 deps`;
                        document.getElementById('dependenciesResult').innerHTML =
                            `<i class="fas fa-exclamation-triangle"></i> gRPC tiene <strong>${dependencies.length - 2}x m√°s dependencias</strong> que HTTP/REST`;
                        return;
                    }

                    const dep = dependencies[currentDep];
                    const x = centerX + Math.cos(dep.angle) * radius;
                    const y = centerY + Math.sin(dep.angle) * radius;

                    // L√≠nea de conexi√≥n
                    ctx.strokeStyle = dep.color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();

                    // Nodo de dependencia
                    ctx.fillStyle = dep.color;
                    ctx.beginPath();
                    ctx.arc(x, y, 25, 0, Math.PI * 2);
                    ctx.fill();

                    // Nombre
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 9px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(dep.name, x, y + 3);

                    // Icono de actualizaci√≥n
                    ctx.fillStyle = '#fbbf24';
                    ctx.font = '12px Arial';
                    ctx.fillText('‚ö†', x + 20, y - 20);

                    currentDep++;

                    document.getElementById('dependenciesInfo').textContent =
                        `‚ñ£ Dependencias: ${currentDep}/${dependencies.length}`;
                }, 300);
            }

            // ===== DEMO 2: TIMELINE DE ACTUALIZACIONES =====
            function runUpdatesDemo() {
                const canvas = document.getElementById('updatesCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // Timeline
                const startY = 50;
                const endY = height - 50;
                const lineX = 80;

                // L√≠nea principal
                ctx.strokeStyle = '#94a3b8';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(lineX, startY);
                ctx.lineTo(lineX, endY);
                ctx.stroke();

                // Etiquetas de tiempo
                const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
                const monthHeight = (endY - startY) / 12;

                months.forEach((month, i) => {
                    const y = startY + i * monthHeight;

                    ctx.fillStyle = '#94a3b8';
                    ctx.font = '9px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(month, lineX - 10, y + 3);

                    // Marca
                    ctx.strokeStyle = '#94a3b8';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(lineX - 5, y);
                    ctx.lineTo(lineX + 5, y);
                    ctx.stroke();
                });

                // Actualizaciones de gRPC (frecuentes)
                const grpcUpdates = [
                    { month: 0, type: 'security', desc: 'Security patch' },
                    { month: 1, type: 'minor', desc: 'Minor update' },
                    { month: 2, type: 'security', desc: 'CVE fix' },
                    { month: 3, type: 'major', desc: 'Major release' },
                    { month: 4, type: 'security', desc: 'Security patch' },
                    { month: 5, type: 'minor', desc: 'Bug fixes' },
                    { month: 6, type: 'security', desc: 'CVE fix' },
                    { month: 7, type: 'minor', desc: 'Minor update' },
                    { month: 8, type: 'security', desc: 'Security patch' },
                    { month: 9, type: 'minor', desc: 'Bug fixes' },
                    { month: 10, type: 'security', desc: 'CVE fix' },
                    { month: 11, type: 'major', desc: 'Major release' }
                ];

                let currentUpdate = 0;

                const interval = setInterval(() => {
                    if (currentUpdate >= grpcUpdates.length) {
                        clearInterval(interval);

                        // Comparaci√≥n con HTTP/REST
                        ctx.fillStyle = '#4ade80';
                        ctx.font = 'bold 11px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText('HTTP/REST: 2-3 actualizaciones/a√±o', lineX + 200, 30);

                        // Pocas actualizaciones
                        [2, 6, 10].forEach((month, i) => {
                            const y = startY + month * monthHeight;
                            ctx.fillStyle = '#4ade80';
                            ctx.beginPath();
                            ctx.arc(lineX + 220, y, 8, 0, Math.PI * 2);
                            ctx.fill();
                        });

                        document.getElementById('updatesInfo').textContent =
                            `üìÖ gRPC: ${grpcUpdates.length} updates/a√±o | HTTP: 2-3 updates/a√±o`;
                        document.getElementById('updatesResult').innerHTML =
                            `<i class="fas fa-sync-alt"></i> gRPC requiere <strong>4x m√°s actualizaciones</strong> que HTTP/REST`;
                        return;
                    }

                    const update = grpcUpdates[currentUpdate];
                    const y = startY + update.month * monthHeight;

                    // Color seg√∫n tipo
                    let color;
                    if (update.type === 'security') color = '#f87171';
                    else if (update.type === 'major') color = '#fbbf24';
                    else color = '#60a5fa';

                    // Punto en timeline
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(lineX, y, 10, 0, Math.PI * 2);
                    ctx.fill();

                    // L√≠nea al texto
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(lineX + 10, y);
                    ctx.lineTo(lineX + 30, y);
                    ctx.stroke();

                    // Descripci√≥n
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '9px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(update.desc, lineX + 35, y + 3);

                    // Icono seg√∫n tipo
                    ctx.font = '10px Arial';
                    if (update.type === 'security') {
                        ctx.fillText('‚ä†', lineX + 120, y + 3);
                    } else if (update.type === 'major') {
                        ctx.fillText('‚ñ≤', lineX + 120, y + 3);
                    } else {
                        ctx.fillText('üîß', lineX + 120, y + 3);
                    }

                    currentUpdate++;

                    document.getElementById('updatesInfo').textContent =
                        `üìÖ Actualizaciones: ${currentUpdate}/${grpcUpdates.length} en el a√±o`;
                }, 250);
            }
        </script>

        <!-- Slide 8: JSON -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-file-code"></i> JSON: Formato de Serializaci√≥n Popular
            </h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Caracter√≠sticas -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "API REST p√∫blica para partners del Banco de Loja"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Ventajas</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Legible</strong>: Human-readable</li>
                            <li><strong>Simple</strong>: F√°cil de usar</li>
                            <li><strong>Universal</strong>: Amplio soporte</li>
                            <li><strong>Compacto</strong>: M√°s que XML</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> API p√∫blica y app m√≥vil
                        </p>
                    </div>

                    <!-- Pesta√±as de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="json-tab active" data-demo="editor"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Editor
                        </button>
                        <button class="json-tab" data-demo="validation"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Validaci√≥n
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startJsonDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualizaci√≥n -->
                <div id="jsonDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Editor -->
                    <div id="demoEditor" class="json-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-code"></i> Editor JSON Interactivo
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="jsonEditorCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="jsonEditorInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa;">
                                Tama√±o: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="jsonEditorResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el editor
                            </div>
                        </div>
                    </div>

                    <!-- Demo Validaci√≥n -->
                    <div id="demoValidation" class="json-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-times-circle"></i> JSON Inv√°lido
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="jsonInvalidCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="jsonInvalidInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Error: -</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-check-circle"></i> JSON V√°lido
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="jsonValidCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="jsonValidInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Estado: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="jsonValidationResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver la validaci√≥n
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== JSON SIMULACIONES =====
            let currentJsonDemo = 'editor';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos JSON
                const jsonTabs = document.querySelectorAll('.json-tab');
                jsonTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchJsonDemo(demoType);
                    });
                });

                // Bot√≥n iniciar demo JSON
                const startJsonDemo = document.getElementById('startJsonDemo');
                if (startJsonDemo) {
                    startJsonDemo.addEventListener('click', function () {
                        if (currentJsonDemo === 'editor') {
                            runJsonEditorDemo();
                        } else if (currentJsonDemo === 'validation') {
                            runJsonValidationDemo();
                        }
                    });
                }
            });

            function switchJsonDemo(demoType) {
                currentJsonDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.json-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.json-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: EDITOR JSON INTERACTIVO =====
            function runJsonEditorDemo() {
                const canvas = document.getElementById('jsonEditorCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const jsonData = {
                    "transaction": {
                        "id": "TRX-2024-001234",
                        "accountNumber": "2100456789",
                        "customerName": "Mar√≠a S√°nchez",
                        "amount": 150.00,
                        "currency": "USD",
                        "type": "transfer",
                        "branch": "Loja Centro",
                        "timestamp": "2024-11-08T14:30:00-05:00"
                    }
                };

                const jsonStr = JSON.stringify(jsonData, null, 2);
                const lines = jsonStr.split('\n');

                // Dibujar fondo del editor
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                // Barra superior
                ctx.fillStyle = '#2d2d2d';
                ctx.fillRect(0, 0, width, 30);
                ctx.fillStyle = '#60a5fa';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('‚ñ≠ user.json', 10, 20);

                // N√∫meros de l√≠nea
                ctx.fillStyle = '#3d3d3d';
                ctx.fillRect(0, 30, 40, height - 30);

                let currentLine = 0;
                const lineHeight = 16;
                const startY = 50;

                const interval = setInterval(() => {
                    if (currentLine >= lines.length) {
                        clearInterval(interval);

                        const size = new Blob([jsonStr]).size;
                        document.getElementById('jsonEditorInfo').textContent =
                            `‚ñä Tama√±o: ${size} bytes | ${lines.length} l√≠neas`;
                        document.getElementById('jsonEditorResult').innerHTML =
                            `<i class="fas fa-check"></i> JSON parseado correctamente | <strong>Human-readable</strong> y f√°cil de editar`;
                        return;
                    }

                    const line = lines[currentLine];
                    const y = startY + currentLine * lineHeight;

                    // N√∫mero de l√≠nea
                    ctx.fillStyle = '#858585';
                    ctx.font = '10px monospace';
                    ctx.textAlign = 'right';
                    ctx.fillText((currentLine + 1).toString(), 35, y);

                    // Contenido de la l√≠nea con syntax highlighting
                    ctx.textAlign = 'left';
                    let x = 50;

                    // Detectar tipo de contenido
                    if (line.includes('{') || line.includes('}') || line.includes('[') || line.includes(']')) {
                        ctx.fillStyle = '#ffd700';
                        ctx.fillText(line, x, y);
                    } else if (line.includes(':')) {
                        // Separar key y value
                        const parts = line.split(':');

                        // Key (propiedad)
                        ctx.fillStyle = '#9cdcfe';
                        ctx.fillText(parts[0], x, y);
                        x += ctx.measureText(parts[0]).width;

                        // :
                        ctx.fillStyle = '#ffffff';
                        ctx.fillText(':', x, y);
                        x += ctx.measureText(':').width;

                        // Value
                        const value = parts[1];
                        if (value.includes('"')) {
                            ctx.fillStyle = '#ce9178'; // String
                        } else if (value.includes('true') || value.includes('false')) {
                            ctx.fillStyle = '#569cd6'; // Boolean
                        } else if (!isNaN(value.trim().replace(',', ''))) {
                            ctx.fillStyle = '#b5cea8'; // Number
                        } else {
                            ctx.fillStyle = '#ffffff';
                        }
                        ctx.fillText(value, x, y);
                    } else {
                        ctx.fillStyle = '#d4d4d4';
                        ctx.fillText(line, x, y);
                    }

                    currentLine++;

                    document.getElementById('jsonEditorInfo').textContent =
                        `üìù Parseando l√≠nea ${currentLine}/${lines.length}...`;
                }, 100);
            }

            // ===== DEMO 2: VALIDACI√ìN JSON =====
            function runJsonValidationDemo() {
                animateInvalidJson();
                setTimeout(() => animateValidJson(), 100);
            }

            function animateInvalidJson() {
                const canvas = document.getElementById('jsonInvalidCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // JSON con error (falta comilla de cierre)
                const invalidJson = `{
  "name": "Test,
  "value": 123
}`;

                const lines = invalidJson.split('\n');

                // Fondo
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                // N√∫meros de l√≠nea
                ctx.fillStyle = '#3d3d3d';
                ctx.fillRect(0, 0, 40, height);

                lines.forEach((line, i) => {
                    const y = 20 + i * 20;

                    // N√∫mero de l√≠nea
                    ctx.fillStyle = '#858585';
                    ctx.font = '10px monospace';
                    ctx.textAlign = 'right';
                    ctx.fillText((i + 1).toString(), 35, y);

                    // L√≠nea de c√≥digo
                    ctx.textAlign = 'left';
                    ctx.fillStyle = '#d4d4d4';
                    ctx.fillText(line, 50, y);

                    // Marcar error en l√≠nea 2
                    if (i === 1) {
                        // Subrayado rojo
                        ctx.strokeStyle = '#f87171';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(50, y + 3);
                        ctx.lineTo(50 + ctx.measureText(line).width, y + 3);
                        ctx.stroke();

                        // Icono de error
                        ctx.fillStyle = '#f87171';
                        ctx.font = '12px Arial';
                        ctx.fillText('√ó', width - 30, y);
                    }
                });

                // Mensaje de error
                ctx.fillStyle = '#f87171';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('‚ö† SyntaxError: Unexpected token', 50, 120);
                ctx.font = '9px Arial';
                ctx.fillText('L√≠nea 2: Falta comilla de cierre en "Test', 50, 135);

                document.getElementById('jsonInvalidInfo').textContent =
                    `‚ùå Error en l√≠nea 2 | Sintaxis incorrecta`;
            }

            function animateValidJson() {
                const canvas = document.getElementById('jsonValidCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // JSON v√°lido
                const validJson = `{
  "name": "Test",
  "value": 123
}`;

                const lines = validJson.split('\n');

                // Fondo
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                // N√∫meros de l√≠nea
                ctx.fillStyle = '#3d3d3d';
                ctx.fillRect(0, 0, 40, height);

                lines.forEach((line, i) => {
                    const y = 20 + i * 20;

                    // N√∫mero de l√≠nea
                    ctx.fillStyle = '#858585';
                    ctx.font = '10px monospace';
                    ctx.textAlign = 'right';
                    ctx.fillText((i + 1).toString(), 35, y);

                    // L√≠nea de c√≥digo con syntax highlighting
                    ctx.textAlign = 'left';
                    if (line.includes('"name"') || line.includes('"value"')) {
                        ctx.fillStyle = '#9cdcfe';
                        ctx.fillText(line.substring(0, line.indexOf(':')), 50, y);
                        ctx.fillStyle = '#ffffff';
                        ctx.fillText(':', 50 + ctx.measureText(line.substring(0, line.indexOf(':'))).width, y);

                        const value = line.substring(line.indexOf(':') + 1);
                        if (value.includes('"')) {
                            ctx.fillStyle = '#ce9178';
                        } else {
                            ctx.fillStyle = '#b5cea8';
                        }
                        ctx.fillText(value, 50 + ctx.measureText(line.substring(0, line.indexOf(':') + 1)).width, y);
                    } else {
                        ctx.fillStyle = '#ffd700';
                        ctx.fillText(line, 50, y);
                    }

                    // Checkmark verde
                    ctx.fillStyle = '#4ade80';
                    ctx.font = '12px Arial';
                    ctx.fillText('‚àö', width - 30, y);
                });

                // Mensaje de √©xito
                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('‚àö JSON valido', 50, 120);
                ctx.font = '9px Arial';
                ctx.fillText('Parseado correctamente | Sin errores de sintaxis', 50, 135);

                // Objeto parseado
                ctx.fillStyle = '#94a3b8';
                ctx.font = '9px monospace';
                ctx.fillText('Objeto: { name: "Test", value: 123 }', 50, 155);

                document.getElementById('jsonValidInfo').textContent =
                    `‚úÖ JSON v√°lido | Parseado correctamente`;

                document.getElementById('jsonValidationResult').innerHTML =
                    `<i class="fas fa-check-circle"></i> Validaci√≥n en tiempo real detecta errores de sintaxis <strong>inmediatamente</strong>`;
            }
        </script>

        <!-- Slide 9: Protobuf -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-cogs"></i> Protocol Buffers: Serializaci√≥n Eficiente
            </h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Caracter√≠sticas -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Esquemas de datos para transacciones bancarias"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Caracter√≠sticas</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Binario</strong>: Muy compacto</li>
                            <li><strong>R√°pido</strong>: Alta velocidad</li>
                            <li><strong>Multiplataforma</strong>: Varios lenguajes</li>
                            <li><strong>Evoluci√≥n</strong>: Sin ruptura</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Field numbers = compatibilidad
                        </p>
                    </div>

                    <!-- Pesta√±as de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="protobuf-tab active" data-demo="code"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            C√≥digo
                        </button>
                        <button class="protobuf-tab" data-demo="evolution"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Evoluci√≥n
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startProtobufDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                        <div id="protobufControls" style="margin-top: 6px; font-size: 0.75rem;">
                            <label style="color: #e2e8f0;">Lenguaje: </label>
                            <select id="protobufLang"
                                style="padding: 3px; background: rgba(255,255,255,0.1); border: 1px solid var(--uide-accent); color: white; border-radius: 4px; font-size: 0.75rem;">
                                <option value="python">Python</option>
                                <option value="java">Java</option>
                                <option value="go">Go</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Columna Derecha: Visualizaci√≥n -->
                <div id="protobufDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo C√≥digo -->
                    <div id="demoCode" class="protobuf-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #a78bfa; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #a78bfa; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-file-code"></i> Definici√≥n .proto
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="protoDefCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="protoDefInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #a78bfa;">
                                Archivo: user.proto</div>
                        </div>

                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column; max-height: 48%;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-code"></i> C√≥digo Generado
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 200px;">
                                <canvas id="generatedCodeCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="generatedCodeInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Lenguaje: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="protoCodeResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver la generaci√≥n de c√≥digo
                            </div>
                        </div>
                    </div>

                    <!-- Demo Evoluci√≥n -->
                    <div id="demoEvolution" class="protobuf-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-code-branch"></i> Evoluci√≥n de Esquema
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="evolutionCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="evolutionInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Versi√≥n: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="evolutionResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver la evoluci√≥n
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== PROTOBUF SIMULACIONES =====
            let currentProtobufDemo = 'code';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos Protobuf
                const protobufTabs = document.querySelectorAll('.protobuf-tab');
                protobufTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchProtobufDemo(demoType);
                    });
                });

                // Bot√≥n iniciar demo Protobuf
                const startProtobufDemo = document.getElementById('startProtobufDemo');
                if (startProtobufDemo) {
                    startProtobufDemo.addEventListener('click', function () {
                        if (currentProtobufDemo === 'code') {
                            const lang = document.getElementById('protobufLang').value;
                            runProtobufCodeDemo(lang);
                        } else if (currentProtobufDemo === 'evolution') {
                            runProtobufEvolutionDemo();
                        }
                    });
                }
            });

            function switchProtobufDemo(demoType) {
                currentProtobufDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.protobuf-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.protobuf-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }

                // Mostrar/ocultar controles
                const controlsDiv = document.getElementById('protobufControls');
                if (demoType === 'evolution') {
                    controlsDiv.style.display = 'none';
                } else {
                    controlsDiv.style.display = 'block';
                }
            }

            // ===== DEMO 1: C√ìDIGO .PROTO ‚Üí C√ìDIGO GENERADO =====
            function runProtobufCodeDemo(lang) {
                animateProtoDefinition();
                setTimeout(() => animateGeneratedCode(lang), 1000);
            }

            function animateProtoDefinition() {
                const canvas = document.getElementById('protoDefCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const protoCode = [
                    'syntax = "proto3";',
                    '',
                    'message User {',
                    '  int32 id = 1;',
                    '  string name = 2;',
                    '  string email = 3;',
                    '  repeated string roles = 4;',
                    '}'
                ];

                // Fondo
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                let currentLine = 0;
                const lineHeight = 20;

                const interval = setInterval(() => {
                    if (currentLine >= protoCode.length) {
                        clearInterval(interval);
                        document.getElementById('protoDefInfo').textContent =
                            `‚ñ≠ user.proto | ${protoCode.length} l√≠neas`;
                        return;
                    }

                    const line = protoCode[currentLine];
                    const y = 20 + currentLine * lineHeight;

                    // Syntax highlighting
                    ctx.font = '11px monospace';
                    ctx.textAlign = 'left';

                    if (line.includes('syntax') || line.includes('message')) {
                        ctx.fillStyle = '#c586c0'; // keyword
                        const parts = line.split(' ');
                        let x = 10;
                        parts.forEach((part, i) => {
                            if (i === 0) {
                                ctx.fillStyle = '#c586c0';
                            } else if (part.includes('"')) {
                                ctx.fillStyle = '#ce9178';
                            } else {
                                ctx.fillStyle = '#4ec9b0';
                            }
                            ctx.fillText(part + ' ', x, y);
                            x += ctx.measureText(part + ' ').width;
                        });
                    } else if (line.includes('int32') || line.includes('string') || line.includes('repeated')) {
                        const parts = line.trim().split(' ');
                        let x = 20;
                        parts.forEach((part, i) => {
                            if (i === 0) {
                                ctx.fillStyle = '#4ec9b0'; // type
                            } else if (part.includes('=')) {
                                ctx.fillStyle = '#ffffff';
                            } else if (!isNaN(part.replace(';', ''))) {
                                ctx.fillStyle = '#b5cea8'; // number
                            } else {
                                ctx.fillStyle = '#9cdcfe'; // field name
                            }
                            ctx.fillText(part + ' ', x, y);
                            x += ctx.measureText(part + ' ').width;
                        });

                        // Resaltar field number
                        if (line.includes('=')) {
                            const fieldNum = line.match(/= (\d+)/)[1];
                            ctx.fillStyle = '#fbbf24';
                            ctx.font = 'bold 9px Arial';
                            ctx.fillText(`‚Üê Field #${fieldNum}`, width - 80, y);
                        }
                    } else {
                        ctx.fillStyle = '#ffd700';
                        ctx.fillText(line, 10, y);
                    }

                    currentLine++;
                    document.getElementById('protoDefInfo').textContent =
                        `üìù Definiendo l√≠nea ${currentLine}/${protoCode.length}...`;
                }, 200);
            }

            function animateGeneratedCode(lang) {
                const canvas = document.getElementById('generatedCodeCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const codeExamples = {
                    python: [
                        'class User(message.Message):',
                        '    id = proto.Field(',
                        '        proto.INT32, number=1',
                        '    )',
                        '    name = proto.Field(',
                        '        proto.STRING, number=2',
                        '    )',
                        '    email = proto.Field(',
                        '        proto.STRING, number=3',
                        '    )'
                    ],
                    java: [
                        'public class User {',
                        '  private int id;',
                        '  private String name;',
                        '  private String email;',
                        '  ',
                        '  public int getId() {',
                        '    return id;',
                        '  }',
                        '  // setters...',
                        '}'
                    ],
                    go: [
                        'type User struct {',
                        '  Id    int32    `protobuf:"1"`',
                        '  Name  string   `protobuf:"2"`',
                        '  Email string   `protobuf:"3"`',
                        '  Roles []string `protobuf:"4"`',
                        '}',
                        '',
                        'func (u *User) GetId() int32 {',
                        '  return u.Id',
                        '}'
                    ]
                };

                const code = codeExamples[lang];

                // Fondo
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, height);

                // T√≠tulo del lenguaje
                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`Generated ${lang.toUpperCase()} Code`, width / 2, 15);

                let currentLine = 0;
                const lineHeight = 18;

                const interval = setInterval(() => {
                    if (currentLine >= code.length) {
                        clearInterval(interval);
                        document.getElementById('generatedCodeInfo').textContent =
                            `‚úÖ ${lang.toUpperCase()} | ${code.length} l√≠neas generadas`;
                        document.getElementById('protoCodeResult').innerHTML =
                            `<i class="fas fa-magic"></i> Protoc genera c√≥digo <strong>type-safe</strong> autom√°ticamente para ${lang}`;
                        return;
                    }

                    const line = code[currentLine];
                    const y = 35 + currentLine * lineHeight;

                    // Syntax highlighting b√°sico
                    ctx.font = '10px monospace';
                    ctx.textAlign = 'left';

                    if (line.includes('class') || line.includes('public') || line.includes('type') || line.includes('func')) {
                        ctx.fillStyle = '#c586c0';
                    } else if (line.includes('int') || line.includes('string') || line.includes('String')) {
                        ctx.fillStyle = '#4ec9b0';
                    } else if (line.includes('return')) {
                        ctx.fillStyle = '#c586c0';
                    } else {
                        ctx.fillStyle = '#d4d4d4';
                    }

                    ctx.fillText(line, 10, y);

                    currentLine++;
                    document.getElementById('generatedCodeInfo').textContent =
                        `‚öôÔ∏è Generando ${lang}... ${currentLine}/${code.length}`;
                }, 150);
            }

            // ===== DEMO 2: EVOLUCI√ìN DE ESQUEMA =====
            function runProtobufEvolutionDemo() {
                const canvas = document.getElementById('evolutionCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const versions = [
                    {
                        version: 'v1.0',
                        code: [
                            'message User {',
                            '  int32 id = 1;',
                            '  string name = 2;',
                            '}'
                        ],
                        color: '#60a5fa',
                        y: 50
                    },
                    {
                        version: 'v2.0',
                        code: [
                            'message User {',
                            '  int32 id = 1;',
                            '  string name = 2;',
                            '  string email = 3;  // ‚Üê Nuevo campo',
                            '}'
                        ],
                        color: '#fbbf24',
                        y: 180
                    },
                    {
                        version: 'v3.0',
                        code: [
                            'message User {',
                            '  int32 id = 1;',
                            '  string name = 2;',
                            '  string email = 3;',
                            '  repeated string roles = 4;  // ‚Üê Nuevo',
                            '}'
                        ],
                        color: '#4ade80',
                        y: 310
                    }
                ];

                let currentVersion = 0;

                const interval = setInterval(() => {
                    if (currentVersion >= versions.length) {
                        clearInterval(interval);

                        // Dibujar flechas de compatibilidad
                        ctx.strokeStyle = '#22c55e';
                        ctx.lineWidth = 3;
                        ctx.setLineDash([5, 5]);

                        // v1 ‚Üí v2
                        ctx.beginPath();
                        ctx.moveTo(width / 2, 120);
                        ctx.lineTo(width / 2, 180);
                        ctx.stroke();

                        // v2 ‚Üí v3
                        ctx.beginPath();
                        ctx.moveTo(width / 2, 250);
                        ctx.lineTo(width / 2, 310);
                        ctx.stroke();

                        ctx.setLineDash([]);

                        // Etiquetas de compatibilidad
                        ctx.fillStyle = '#22c55e';
                        ctx.font = 'bold 10px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('‚àö Compatible', width / 2 + 60, 150);
                        ctx.fillText('‚àö Compatible', width / 2 + 60, 280);

                        document.getElementById('evolutionInfo').textContent =
                            `‚àö 3 versiones | Compatibilidad retroactiva`;
                        document.getElementById('evolutionResult').innerHTML =
                            `<i class="fas fa-code-branch"></i> Field numbers permiten <strong>evoluci√≥n sin ruptura</strong> - clientes antiguos siguen funcionando`;
                        return;
                    }

                    const ver = versions[currentVersion];

                    // Caja de versi√≥n
                    ctx.fillStyle = ver.color + '30';
                    ctx.fillRect(20, ver.y, width - 40, 100);
                    ctx.strokeStyle = ver.color;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(20, ver.y, width - 40, 100);

                    // Etiqueta de versi√≥n
                    ctx.fillStyle = ver.color;
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(ver.version, 30, ver.y + 20);

                    // C√≥digo
                    ctx.font = '10px monospace';
                    ctx.fillStyle = '#ffffff';
                    ver.code.forEach((line, i) => {
                        const y = ver.y + 40 + i * 15;

                        if (line.includes('// ‚Üê')) {
                            const parts = line.split('// ‚Üê');
                            ctx.fillStyle = '#d4d4d4';
                            ctx.fillText(parts[0], 35, y);
                            ctx.fillStyle = '#22c55e';
                            ctx.font = 'bold 10px Arial';
                            ctx.fillText('// ‚Üê ' + parts[1], 35 + ctx.measureText(parts[0]).width, y);
                            ctx.font = '10px monospace';
                        } else {
                            ctx.fillStyle = '#d4d4d4';
                            ctx.fillText(line, 35, y);
                        }

                        // Resaltar field numbers
                        if (line.includes('=')) {
                            const match = line.match(/= (\d+)/);
                            if (match) {
                                ctx.fillStyle = '#fbbf24';
                                ctx.fillRect(canvas.width - 60, y - 10, 20, 12);
                                ctx.fillStyle = '#0f1419';
                                ctx.font = 'bold 9px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText(match[1], canvas.width - 50, y);
                                ctx.textAlign = 'left';
                                ctx.font = '10px monospace';
                            }
                        }
                    });

                    currentVersion++;
                    document.getElementById('evolutionInfo').textContent =
                        `üì¶ Versi√≥n ${ver.version} | ${currentVersion}/3`;
                }, 1200);
            }
        </script>

        <!-- Slide 10: Protobuf C√≥digo -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-code"></i> Protobuf: Compilador y FieldMask</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Caracter√≠sticas -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Generaci√≥n de c√≥digo para backend Python y sistemas legacy Java"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Proceso</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Definici√≥n</strong>: .proto</li>
                            <li><strong>Compilaci√≥n</strong>: protoc</li>
                            <li><strong>Generaci√≥n</strong>: Stubs</li>
                            <li><strong>Integraci√≥n</strong>: C√≥digo</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Optimiza respuestas m√≥viles
                        </p>
                    </div>

                    <!-- Pesta√±as de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="protoc-tab active" data-demo="compiler"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Compilador
                        </button>
                        <button class="protoc-tab" data-demo="fieldmask"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            FieldMask
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startProtocDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualizaci√≥n -->
                <div id="protocDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Compilador -->
                    <div id="demoCompiler" class="protoc-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-cogs"></i> Flujo del Compilador protoc
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                                <canvas id="compilerFlowCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="compilerFlowInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Paso: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="compilerFlowResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el flujo de compilaci√≥n
                            </div>
                        </div>
                    </div>

                    <!-- Demo FieldMask -->
                    <div id="demoFieldmask" class="protoc-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column; min-height: 0;">
                            <h3
                                style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem; flex-shrink: 0;">
                                <i class="fas fa-filter"></i> FieldMask Interactivo
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; min-height: 0; display: flex; flex-direction: column;">
                                <div style="margin-bottom: 15px; flex-shrink: 0;">
                                    <p style="color: #e2e8f0; font-size: 0.85rem; margin-bottom: 10px;">
                                        <strong>Selecciona los campos que deseas recibir:</strong>
                                    </p>
                                    <div id="fieldMaskCheckboxes"
                                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="id" checked
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>id</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="name" checked
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>name</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="email"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>email</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="age"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>age</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="roles"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>roles</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" class="field-checkbox" value="metadata.created"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>metadata.created</span>
                                        </label>
                                        <label
                                            style="color: #ffffff; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 6px; grid-column: span 2;">
                                            <input type="checkbox" class="field-checkbox" value="metadata.lastLogin"
                                                style="width: 14px; height: 14px; cursor: pointer;">
                                            <span>metadata.lastLogin</span>
                                        </label>
                                    </div>
                                </div>
                                <div style="flex: 1; min-height: 0; position: relative;">
                                    <canvas id="fieldMaskCanvas" style="display: block; width: 100%;"></canvas>
                                </div>
                            </div>
                            <div id="fieldMaskInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa; flex-shrink: 0;">
                                Campos seleccionados: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="fieldMaskResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para aplicar FieldMask
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== PROTOC SIMULACIONES =====
            let currentProtocDemo = 'compiler';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos Protoc
                const protocTabs = document.querySelectorAll('.protoc-tab');
                protocTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchProtocDemo(demoType);
                    });
                });

                // Bot√≥n iniciar demo
                const startProtocDemo = document.getElementById('startProtocDemo');
                if (startProtocDemo) {
                    startProtocDemo.addEventListener('click', function () {
                        if (currentProtocDemo === 'compiler') {
                            runCompilerFlowDemo();
                        } else if (currentProtocDemo === 'fieldmask') {
                            runFieldMaskDemo();
                        }
                    });
                }

                // Checkboxes de FieldMask - actualizar autom√°ticamente
                const checkboxes = document.querySelectorAll('.field-checkbox');
                checkboxes.forEach(cb => {
                    cb.addEventListener('change', function () {
                        if (currentProtocDemo === 'fieldmask') {
                            runFieldMaskDemo();
                        }
                    });
                });
            });

            // ===== DEMO 1: FLUJO DEL COMPILADOR ANIMADO =====
            function runCompilerFlowDemo() {
                const canvas = document.getElementById('compilerFlowCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const steps = [
                    {
                        name: '‚ñ≠ user.proto',
                        desc: 'Definici√≥n del esquema',
                        color: '#a78bfa',
                        x: width / 2,
                        y: 60
                    },
                    {
                        name: '‚öô protoc',
                        desc: 'Compilador Protocol Buffers',
                        color: '#fbbf24',
                        x: width / 2,
                        y: 180
                    },
                    {
                        name: '‚óà user_pb2.py',
                        desc: 'C√≥digo Python',
                        color: '#60a5fa',
                        x: width / 2 - 150,
                        y: 320
                    },
                    {
                        name: '‚óâ User.java',
                        desc: 'C√≥digo Java',
                        color: '#f472b6',
                        x: width / 2,
                        y: 320
                    },
                    {
                        name: 'üî∑ user.pb.go',
                        desc: 'C√≥digo Go',
                        color: '#22c55e',
                        x: width / 2 + 150,
                        y: 320
                    }
                ];

                let currentStep = 0;

                const interval = setInterval(() => {
                    if (currentStep >= steps.length) {
                        clearInterval(interval);

                        // Dibujar flechas finales
                        ctx.strokeStyle = '#4ade80';
                        ctx.lineWidth = 3;
                        ctx.setLineDash([]);

                        // user.proto ‚Üí protoc
                        drawArrow(ctx, steps[0].x, steps[0].y + 40, steps[1].x, steps[1].y - 40, '#4ade80');

                        // protoc ‚Üí outputs
                        drawArrow(ctx, steps[1].x, steps[1].y + 40, steps[2].x, steps[2].y - 40, '#60a5fa');
                        drawArrow(ctx, steps[1].x, steps[1].y + 40, steps[3].x, steps[3].y - 40, '#f472b6');
                        drawArrow(ctx, steps[1].x, steps[1].y + 40, steps[4].x, steps[4].y - 40, '#22c55e');

                        document.getElementById('compilerFlowInfo').textContent =
                            `‚úÖ Compilaci√≥n completa | 3 lenguajes generados`;
                        document.getElementById('compilerFlowResult').innerHTML =
                            `<i class="fas fa-magic"></i> protoc genera <strong>c√≥digo type-safe</strong> autom√°ticamente para m√∫ltiples lenguajes`;
                        return;
                    }

                    const step = steps[currentStep];

                    // Dibujar nodo
                    ctx.fillStyle = step.color;
                    ctx.beginPath();
                    ctx.roundRect(step.x - 80, step.y - 30, 160, 60, 10);
                    ctx.fill();

                    // Borde
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Nombre
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(step.name, step.x, step.y - 5);

                    // Descripci√≥n
                    ctx.font = '10px Arial';
                    ctx.fillText(step.desc, step.x, step.y + 12);

                    // Dibujar flecha desde el paso anterior
                    if (currentStep > 0) {
                        const prevStep = steps[currentStep - 1];
                        if (currentStep === 1) {
                            // user.proto ‚Üí protoc
                            drawArrow(ctx, prevStep.x, prevStep.y + 40, step.x, step.y - 40, '#4ade80');
                        } else if (currentStep >= 2) {
                            // protoc ‚Üí outputs
                            drawArrow(ctx, steps[1].x, steps[1].y + 40, step.x, step.y - 40, step.color);
                        }
                    }

                    currentStep++;

                    document.getElementById('compilerFlowInfo').textContent =
                        `‚öôÔ∏è Paso ${currentStep}/${steps.length} | Generando c√≥digo...`;
                }, 600);
            }

            function drawArrow(ctx, x1, y1, x2, y2, color) {
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.setLineDash([]);

                // L√≠nea
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();

                // Punta de flecha
                const angle = Math.atan2(y2 - y1, x2 - x1);
                const arrowSize = 12;

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(
                    x2 - arrowSize * Math.cos(angle - Math.PI / 6),
                    y2 - arrowSize * Math.sin(angle - Math.PI / 6)
                );
                ctx.lineTo(
                    x2 - arrowSize * Math.cos(angle + Math.PI / 6),
                    y2 - arrowSize * Math.sin(angle + Math.PI / 6)
                );
                ctx.closePath();
                ctx.fill();
            }

            function switchProtocDemo(demoType) {
                currentProtocDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.protoc-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.protoc-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }

                // Mostrar/ocultar bot√≥n seg√∫n demo
                const applyBtn = document.getElementById('applyFieldMask');
                if (applyBtn) {
                    applyBtn.style.display = demoType === 'fieldmask' ? 'block' : 'none';
                }

                // Renderizar Mermaid si es la demo del compilador
                if (demoType === 'compiler') {
                    setTimeout(() => {
                        const mermaidDiv = document.querySelector('#demoCompiler .mermaid');
                        if (mermaidDiv && !mermaidDiv.getAttribute('data-processed')) {
                            mermaid.init(undefined, mermaidDiv);
                        }
                    }, 100);
                }
            }

            // ===== DEMO 2: FIELDMASK INTERACTIVO =====
            function runFieldMaskDemo() {
                const canvas = document.getElementById('fieldMaskCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 10);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                // Obtener campos seleccionados
                const checkboxes = document.querySelectorAll('.field-checkbox');
                const selectedFields = [];
                checkboxes.forEach(cb => {
                    if (cb.checked) {
                        selectedFields.push(cb.value);
                    }
                });

                // Objeto completo
                const fullUser = {
                    id: 12345,
                    name: "Carlos Jim√©nez",
                    email: "carlos.jimenez@example.com",
                    age: 35,
                    roles: ["customer", "premium"],
                    metadata: {
                        created: "2024-01-15",
                        lastLogin: "2024-11-08"
                    }
                };

                // Objeto filtrado
                const filteredUser = {};
                selectedFields.forEach(field => {
                    if (field.includes('.')) {
                        const parts = field.split('.');
                        if (!filteredUser[parts[0]]) filteredUser[parts[0]] = {};
                        filteredUser[parts[0]][parts[1]] = fullUser[parts[0]][parts[1]];
                    } else {
                        filteredUser[field] = fullUser[field];
                    }
                });

                // Dibujar request
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, width, 90);
                ctx.strokeStyle = '#60a5fa';
                ctx.lineWidth = 2;
                ctx.strokeRect(0, 0, width, 90);

                ctx.fillStyle = '#60a5fa';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('üì§ Request con FieldMask:', 10, 15);

                ctx.fillStyle = '#ffffff';
                ctx.font = '9px monospace';
                ctx.fillText('{', 10, 30);
                ctx.fillText('  "fieldMask": "' + selectedFields.join(',') + '",', 10, 45);
                ctx.fillText('  "userId": 12345', 10, 60);
                ctx.fillText('}', 10, 75);

                // Dibujar response
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 100, width, 100);
                ctx.strokeStyle = '#4ade80';
                ctx.lineWidth = 2;
                ctx.strokeRect(0, 100, width, 100);

                ctx.fillStyle = '#4ade80';
                ctx.font = 'bold 11px Arial';
                ctx.fillText('üì• Response (solo campos solicitados):', 10, 115);

                ctx.fillStyle = '#ffffff';
                ctx.font = '9px monospace';
                const responseJson = JSON.stringify(filteredUser, null, 2);
                const lines = responseJson.split('\n').slice(0, 5);
                lines.forEach((line, i) => {
                    ctx.fillText(line, 10, 130 + i * 12);
                });
                if (responseJson.split('\n').length > 5) {
                    ctx.fillStyle = '#94a3b8';
                    ctx.fillText('...', 10, 130 + 5 * 12);
                }

                // Calcular ahorro
                const fullSize = JSON.stringify(fullUser).length;
                const filteredSize = JSON.stringify(filteredUser).length;
                const savings = ((fullSize - filteredSize) / fullSize * 100).toFixed(0);

                document.getElementById('fieldMaskInfo').textContent =
                    `‚úÖ ${selectedFields.length} campos | Ahorro: ${savings}% (${fullSize - filteredSize} bytes)`;
                document.getElementById('fieldMaskResult').innerHTML =
                    `<i class="fas fa-filter"></i> FieldMask reduce payload en <strong>${savings}%</strong> enviando solo campos necesarios`;
            }
        </script>

        <!-- Slide 11: MessagePack -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-box"></i> MessagePack: El Punto Medio</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Caracter√≠sticas -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Cache de sesiones en Redis para autenticaci√≥n r√°pida"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Posicionamiento</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Binario</strong>: M√°s eficiente que JSON</li>
                            <li><strong>Simple</strong>: M√°s f√°cil que Protobuf</li>
                            <li><strong>Sin esquema</strong>: No requiere .proto</li>
                            <li><strong>Multiplataforma</strong>: Amplio soporte</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Cache Redis y colas de mensajes
                        </p>
                    </div>

                    <!-- Pesta√±as de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="msgpack-tab active" data-demo="radar"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Comparaci√≥n
                        </button>
                        <button class="msgpack-tab" data-demo="usecases"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Casos de Uso
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startMsgPackDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualizaci√≥n -->
                <div id="msgpackDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Radar -->
                    <div id="demoRadar" class="msgpack-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #fbbf24; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #fbbf24; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-chart-radar"></i> Gr√°fico de Radar Comparativo
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 300px;">
                                <canvas id="radarCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="radarInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #fbbf24;">
                                Tecnolog√≠as: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="radarResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Comparaci√≥n de rendimiento HTTP/1.1 vs HTTP/2
                            </div>
                        </div>
                    </div>

                    <!-- Demo Casos de Uso -->
                    <div id="demoUsecases" class="msgpack-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #4ade80; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #4ade80; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-sitemap"></i> Casos de Uso por Tecnolog√≠a
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="usecasesCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="usecasesInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #4ade80;">
                                Casos de uso: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="usecasesResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver los casos de uso
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== MESSAGEPACK SIMULACIONES =====
            let currentMsgPackDemo = 'radar';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos MessagePack
                const msgpackTabs = document.querySelectorAll('.msgpack-tab');
                msgpackTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchMsgPackDemo(demoType);
                    });
                });

                // Bot√≥n iniciar demo MessagePack
                const startMsgPackDemo = document.getElementById('startMsgPackDemo');
                if (startMsgPackDemo) {
                    startMsgPackDemo.addEventListener('click', function () {
                        if (currentMsgPackDemo === 'radar') {
                            runRadarDemo();
                        } else if (currentMsgPackDemo === 'usecases') {
                            runUseCasesDemo();
                        }
                    });
                }
            });

            function switchMsgPackDemo(demoType) {
                currentMsgPackDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.msgpack-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.msgpack-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: GR√ÅFICO DE RADAR COMPARATIVO =====
            function runRadarDemo() {
                const canvas = document.getElementById('radarCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const centerX = width / 2;
                const centerY = height / 2;
                const radius = Math.min(width, height) / 2 - 60;

                const axes = [
                    { name: 'Velocidad', angle: -Math.PI / 2 },
                    { name: 'Tama√±o', angle: -Math.PI / 2 + (2 * Math.PI / 5) },
                    { name: 'Complejidad', angle: -Math.PI / 2 + (4 * Math.PI / 5) },
                    { name: 'Interop', angle: -Math.PI / 2 + (6 * Math.PI / 5) },
                    { name: 'Madurez', angle: -Math.PI / 2 + (8 * Math.PI / 5) }
                ];

                const technologies = [
                    {
                        name: 'JSON',
                        color: '#60a5fa',
                        values: [0.6, 0.6, 1.0, 1.0, 1.0] // Velocidad, Tama√±o, Complejidad, Interop, Madurez
                    },
                    {
                        name: 'Protobuf',
                        color: '#22c55e',
                        values: [1.0, 1.0, 0.4, 0.6, 0.8]
                    },
                    {
                        name: 'MessagePack',
                        color: '#fbbf24',
                        values: [0.8, 0.8, 0.8, 0.7, 0.7]
                    }
                ];

                // Dibujar ejes y c√≠rculos conc√©ntricos
                for (let i = 1; i <= 5; i++) {
                    const r = (radius * i) / 5;
                    ctx.strokeStyle = '#94a3b8' + (i === 5 ? 'ff' : '33');
                    ctx.lineWidth = i === 5 ? 2 : 1;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, r, 0, Math.PI * 2);
                    ctx.stroke();
                }

                // Dibujar ejes
                axes.forEach((axis, i) => {
                    const x = centerX + radius * Math.cos(axis.angle);
                    const y = centerY + radius * Math.sin(axis.angle);

                    ctx.strokeStyle = '#94a3b8';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();

                    // Etiquetas
                    const labelX = centerX + (radius + 30) * Math.cos(axis.angle);
                    const labelY = centerY + (radius + 30) * Math.sin(axis.angle);

                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(axis.name, labelX, labelY);
                });

                // Animar tecnolog√≠as
                let currentTech = 0;
                let progress = 0;

                const interval = setInterval(() => {
                    if (currentTech >= technologies.length) {
                        clearInterval(interval);
                        document.getElementById('radarInfo').textContent =
                            `‚ñä 3 tecnolog√≠as comparadas en 5 dimensiones`;
                        document.getElementById('radarResult').innerHTML =
                            `<i class="fas fa-balance-scale"></i> MessagePack es el <strong>punto medio ideal</strong> entre velocidad y simplicidad`;
                        return;
                    }

                    progress += 0.05;
                    if (progress > 1) {
                        progress = 1;
                    }

                    const tech = technologies[currentTech];

                    // Dibujar pol√≠gono
                    ctx.fillStyle = tech.color + '40';
                    ctx.strokeStyle = tech.color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();

                    axes.forEach((axis, i) => {
                        const value = tech.values[i] * progress;
                        const r = radius * value;
                        const x = centerX + r * Math.cos(axis.angle);
                        const y = centerY + r * Math.sin(axis.angle);

                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }

                        // Puntos
                        ctx.fillStyle = tech.color;
                        ctx.beginPath();
                        ctx.arc(x, y, 5, 0, Math.PI * 2);
                        ctx.fill();
                    });

                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    // Leyenda
                    const legendY = 20 + currentTech * 20;
                    ctx.fillStyle = tech.color;
                    ctx.fillRect(20, legendY, 15, 15);
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(tech.name, 40, legendY + 11);

                    if (progress >= 1) {
                        currentTech++;
                        progress = 0;
                    }

                    document.getElementById('radarInfo').textContent =
                        `‚ñä Dibujando ${tech.name}... (${currentTech + 1}/3)`;
                }, 30);
            }

            // ===== DEMO 2: CASOS DE USO =====
            function runUseCasesDemo() {
                const canvas = document.getElementById('usecasesCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const useCases = [
                    {
                        tech: 'JSON',
                        color: '#60a5fa',
                        cases: [
                            '‚óâ API REST para partners',
                            '‚ñØ App m√≥vil Banco de Loja',
                            'üîß Configuraci√≥n de servicios',
                            'üìù Logs y auditor√≠a'
                        ],
                        y: 30
                    },
                    {
                        tech: 'Protobuf',
                        color: '#22c55e',
                        cases: [
                            '‚ö° Microsservicios internos',
                            '‚ñ≤ Procesamiento transacciones',
                            '‚óâ Eventos entre servicios',
                            '‚ä† Datos sensibles encriptados'
                        ],
                        y: 180
                    },
                    {
                        tech: 'MessagePack',
                        color: '#fbbf24',
                        cases: [
                            '‚ñ£ Cache de sesiones (Redis)',
                            '‚óà Cola de transacciones',
                            '‚âà Balance velocidad/simplicidad',
                            '‚Üª Sincronizacion de datos'
                        ],
                        y: 330
                    }
                ];

                let currentCase = 0;

                const interval = setInterval(() => {
                    if (currentCase >= useCases.length) {
                        clearInterval(interval);
                        document.getElementById('usecasesInfo').textContent =
                            `‚úÖ 3 tecnolog√≠as | 12 casos de uso`;
                        document.getElementById('usecasesResult').innerHTML =
                            `<i class="fas fa-lightbulb"></i> Cada tecnolog√≠a tiene su <strong>caso de uso ideal</strong> seg√∫n requisitos`;
                        return;
                    }

                    const useCase = useCases[currentCase];

                    // T√≠tulo de la tecnolog√≠a
                    ctx.fillStyle = useCase.color;
                    ctx.fillRect(10, useCase.y, width - 20, 40);
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(useCase.tech, width / 2, useCase.y + 25);

                    // Casos de uso
                    useCase.cases.forEach((caseText, i) => {
                        const y = useCase.y + 55 + i * 22;

                        // Bullet point
                        ctx.fillStyle = useCase.color;
                        ctx.beginPath();
                        ctx.arc(25, y - 5, 4, 0, Math.PI * 2);
                        ctx.fill();

                        // Texto
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '11px Arial';
                        ctx.textAlign = 'left';
                        ctx.fillText(caseText, 40, y);
                    });

                    currentCase++;

                    document.getElementById('usecasesInfo').textContent =
                        `üìã Mostrando casos de uso (${currentCase}/3)`;
                }, 800);
            }
        </script>

        <!-- Slide 12: XML Fundamentos -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-code"></i> XML: Verbosidad y Overhead</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Caracter√≠sticas -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Integraci√≥n con SRI para facturas electr√≥nicas y reportes"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Costos</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.4; margin: 0; padding-left: 18px;">
                            <li><strong>Verbosidad</strong>: Tags duplicados</li>
                            <li><strong>Overhead</strong>: 2-3x m√°s grande</li>
                            <li><strong>Parsing</strong>: Costoso</li>
                            <li><strong>Metadatos</strong>: Informaci√≥n extra</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(248, 113, 113, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid #f87171; flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-exclamation-triangle"></i> Legacy pero a√∫n usado
                        </p>
                    </div>

                    <!-- Pesta√±as de Demos -->
                    <div style="display: flex; gap: 4px; flex-shrink: 0;">
                        <button class="xml-tab active" data-demo="overhead"
                            style="flex: 1; padding: 6px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            Overhead
                        </button>
                        <button class="xml-tab" data-demo="dom"
                            style="flex: 1; padding: 6px; background: rgba(255,255,255,0.1); color: #e2e8f0; border: none; border-radius: 4px; font-size: 0.7rem; cursor: pointer; font-weight: 600;">
                            √Årbol DOM
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startXmlDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Iniciar Demo
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Visualizaci√≥n -->
                <div id="xmlDemoContainer" style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <!-- Demo Overhead -->
                    <div id="demoOverhead" class="xml-demo-content"
                        style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #f87171; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #f87171; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-chart-bar"></i> Comparaci√≥n de Tama√±os
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                                <canvas id="overheadCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="overheadInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #f87171;">
                                Tama√±os: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="overheadResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el overhead
                            </div>
                        </div>
                    </div>

                    <!-- Demo √Årbol DOM -->
                    <div id="demoDom" class="xml-demo-content"
                        style="display: none; flex-direction: column; gap: 12px; height: 100%;">
                        <div
                            style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem;">
                                <i class="fas fa-sitemap"></i> √Årbol DOM de XML
                            </h3>
                            <div
                                style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                                <canvas id="domCanvas" style="display: block;"></canvas>
                            </div>
                            <div id="domInfo"
                                style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa;">
                                Nodos: -</div>
                        </div>

                        <div
                            style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                            <div id="domResult"
                                style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                                Presiona "Iniciar Demo" para ver el √°rbol DOM
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== XML SIMULACIONES =====
            let currentXmlDemo = 'overhead';

            document.addEventListener('DOMContentLoaded', function () {
                // Tabs de demos XML
                const xmlTabs = document.querySelectorAll('.xml-tab');
                xmlTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const demoType = this.getAttribute('data-demo');
                        switchXmlDemo(demoType);
                    });
                });

                // Bot√≥n iniciar demo XML
                const startXmlDemo = document.getElementById('startXmlDemo');
                if (startXmlDemo) {
                    startXmlDemo.addEventListener('click', function () {
                        if (currentXmlDemo === 'overhead') {
                            runOverheadDemo();
                        } else if (currentXmlDemo === 'dom') {
                            runDomTreeDemo();
                        }
                    });
                }
            });

            function switchXmlDemo(demoType) {
                currentXmlDemo = demoType;

                // Actualizar tabs
                document.querySelectorAll('.xml-tab').forEach(tab => {
                    if (tab.getAttribute('data-demo') === demoType) {
                        tab.style.background = 'var(--uide-accent)';
                        tab.style.color = '#0f1419';
                    } else {
                        tab.style.background = 'rgba(255,255,255,0.1)';
                        tab.style.color = '#e2e8f0';
                    }
                });

                // Mostrar/ocultar contenido
                document.querySelectorAll('.xml-demo-content').forEach(content => {
                    content.style.display = 'none';
                });

                const activeDemo = document.getElementById(`demo${demoType.charAt(0).toUpperCase() + demoType.slice(1)}`);
                if (activeDemo) {
                    activeDemo.style.display = 'flex';
                }
            }

            // ===== DEMO 1: OVERHEAD VISUAL =====
            function runOverheadDemo() {
                const canvas = document.getElementById('overheadCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const formats = [
                    {
                        name: 'JSON',
                        color: '#60a5fa',
                        size: 150,
                        content: '{"transaction": {"id": "TRX001", "amount": 150}}',
                        useful: 35,
                        metadata: 115
                    },
                    {
                        name: 'XML',
                        color: '#f87171',
                        size: 280,
                        content: '<?xml version="1.0"?>\n<transaccion>\n  <id>TRX001</id>\n  <monto>150</monto>\n</transaccion>',
                        useful: 35,
                        metadata: 245
                    },
                    {
                        name: 'Protobuf',
                        color: '#22c55e',
                        size: 45,
                        content: '[binario: 08 01 12 03 96 01]',
                        useful: 35,
                        metadata: 10
                    }
                ];

                let currentFormat = 0;

                const interval = setInterval(() => {
                    if (currentFormat >= formats.length) {
                        clearInterval(interval);

                        // Mostrar comparaci√≥n final
                        const xmlOverhead = ((formats[1].size - formats[0].size) / formats[0].size * 100).toFixed(0);
                        const protobufSavings = ((formats[1].size - formats[2].size) / formats[1].size * 100).toFixed(0);

                        document.getElementById('overheadInfo').textContent =
                            `‚ñä JSON: 150B | XML: 280B (+${xmlOverhead}%) | Protobuf: 45B`;
                        document.getElementById('overheadResult').innerHTML =
                            `<i class="fas fa-exclamation-triangle"></i> XML tiene <strong>${xmlOverhead}% m√°s overhead</strong> que JSON y <strong>${protobufSavings}% m√°s</strong> que Protobuf`;
                        return;
                    }

                    const format = formats[currentFormat];
                    const y = 30 + currentFormat * 140;

                    // T√≠tulo
                    ctx.fillStyle = format.color;
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`${format.name} (${format.size} bytes)`, 20, y);

                    // C√≥digo
                    ctx.fillStyle = '#1e1e1e';
                    ctx.fillRect(20, y + 10, width - 40, 60);
                    ctx.strokeStyle = format.color;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(20, y + 10, width - 40, 60);

                    ctx.fillStyle = '#e2e8f0';
                    ctx.font = '9px monospace';
                    ctx.textAlign = 'left';
                    const lines = format.content.split('\n');
                    lines.forEach((line, i) => {
                        ctx.fillText(line.substring(0, 60), 25, y + 28 + i * 12);
                    });

                    // Gr√°fico de barras (datos √∫tiles vs metadata)
                    const barY = y + 80;
                    const maxWidth = width - 100;
                    const usefulWidth = (maxWidth * format.useful) / format.size;
                    const metadataWidth = (maxWidth * format.metadata) / format.size;

                    // Datos √∫tiles (verde)
                    ctx.fillStyle = '#22c55e';
                    ctx.fillRect(50, barY, usefulWidth, 25);

                    // Metadata (rojo)
                    ctx.fillStyle = '#f87171';
                    ctx.fillRect(50 + usefulWidth, barY, metadataWidth, 25);

                    // Etiquetas
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`Datos: ${format.useful}B`, 50, barY - 5);
                    ctx.fillText(`Metadata: ${format.metadata}B`, 50 + usefulWidth + 5, barY - 5);

                    // Porcentaje de overhead
                    const overheadPct = ((format.metadata / format.size) * 100).toFixed(0);
                    ctx.fillStyle = format.color;
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${overheadPct}% overhead`, width - 20, barY + 17);

                    currentFormat++;

                    document.getElementById('overheadInfo').textContent =
                        `‚ñä Analizando ${format.name}... (${currentFormat}/3)`;
                }, 1000);
            }

            // ===== DEMO 2: √ÅRBOL DOM =====
            function runDomTreeDemo() {
                const canvas = document.getElementById('domCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const tree = {
                    name: 'factura',
                    color: '#a78bfa',
                    x: width / 2,
                    y: 50,
                    children: [
                        {
                            name: 'transaccion',
                            color: '#60a5fa',
                            x: width / 2,
                            y: 150,
                            children: [
                                {
                                    name: 'id',
                                    color: '#22c55e',
                                    x: width / 2 - 100,
                                    y: 250,
                                    value: 'TRX001'
                                },
                                {
                                    name: 'monto',
                                    color: '#22c55e',
                                    x: width / 2 + 100,
                                    y: 250,
                                    value: '$150'
                                }
                            ]
                        }
                    ]
                };

                let currentLevel = 0;
                const maxLevel = 3;

                const interval = setInterval(() => {
                    if (currentLevel >= maxLevel) {
                        clearInterval(interval);
                        document.getElementById('domInfo').textContent =
                            `üå≥ 5 nodos | 3 niveles de profundidad`;
                        document.getElementById('domResult').innerHTML =
                            `<i class="fas fa-sitemap"></i> XML se parsea en un <strong>√°rbol DOM</strong> que consume memoria y tiempo de procesamiento`;
                        return;
                    }

                    // Dibujar nodos seg√∫n el nivel
                    if (currentLevel === 0) {
                        // Ra√≠z
                        drawNode(ctx, tree.name, tree.x, tree.y, tree.color);
                    } else if (currentLevel === 1) {
                        // user
                        const child = tree.children[0];
                        drawArrow(ctx, tree.x, tree.y + 30, child.x, child.y - 30, '#94a3b8');
                        drawNode(ctx, child.name, child.x, child.y, child.color);
                    } else if (currentLevel === 2) {
                        // id y name
                        const parent = tree.children[0];
                        parent.children.forEach(child => {
                            drawArrow(ctx, parent.x, parent.y + 30, child.x, child.y - 30, '#94a3b8');
                            drawNode(ctx, child.name, child.x, child.y, child.color);

                            // Valor
                            ctx.fillStyle = '#fbbf24';
                            ctx.fillRect(child.x - 40, child.y + 40, 80, 30);
                            ctx.strokeStyle = '#fbbf24';
                            ctx.lineWidth = 2;
                            ctx.strokeRect(child.x - 40, child.y + 40, 80, 30);

                            ctx.fillStyle = '#ffffff';
                            ctx.font = 'bold 12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText(child.value, child.x, child.y + 60);

                            // L√≠nea al valor
                            ctx.strokeStyle = '#94a3b8';
                            ctx.lineWidth = 2;
                            ctx.beginPath();
                            ctx.moveTo(child.x, child.y + 30);
                            ctx.lineTo(child.x, child.y + 40);
                            ctx.stroke();
                        });
                    }

                    currentLevel++;

                    document.getElementById('domInfo').textContent =
                        `üå≥ Construyendo √°rbol... Nivel ${currentLevel}/${maxLevel}`;
                }, 800);
            }

            function drawNode(ctx, text, x, y, color) {
                ctx.fillStyle = color;
                ctx.fillRect(x - 50, y - 20, 100, 40);
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(x - 50, y - 20, 100, 40);

                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(text, x, y + 5);
            }
        </script>

        <!-- Slide 13: XML Herramientas -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-tools"></i> XML: XPath Interactivo</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Selectores -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Consultar transacciones del SRI con XPath"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Selectores XPath</h3>
                        <select id="xpathSelector"
                            style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid var(--uide-accent); color: white; border-radius: 4px; font-size: 0.85rem; margin-bottom: 10px;">
                            <option value="//transaccion">Todas las transacciones</option>
                            <option value="//transaccion[@tipo='transferencia']">Solo transferencias</option>
                            <option value="//transaccion[monto>1000]">Montos > $1000</option>
                            <option value="//transaccion[@banco='Pichincha']">Al Banco Pichincha</option>
                            <option value="//cliente/nombre">Nombres de clientes</option>
                            <option value="//transaccion/fecha">Todas las fechas</option>
                        </select>
                    </div>

                    <div
                        style="background: rgba(233, 171, 33, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid var(--uide-accent); flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-info-circle"></i> Herramienta para auditor√≠a
                        </p>
                    </div>

                    <div
                        style="flex: 1; background: rgba(15, 20, 25, 0.6); border-radius: 8px; padding: 10px; overflow-y: auto;">
                        <h3 style="font-size: 0.9rem; margin-bottom: 8px; color: #fbbf24;">üìã Resultado</h3>
                        <div id="xpathResult"
                            style="font-family: monospace; font-size: 0.75rem; color: #4ade80; line-height: 1.6;">
                            Selecciona una consulta XPath...
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="executeXPath"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Ejecutar Consulta
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Documento XML -->
                <div style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <div
                        style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #60a5fa; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                        <h3 style="text-align: center; color: #60a5fa; margin: 0 0 8px 0; font-size: 0.9rem;">
                            <i class="fas fa-file-code"></i> Documento XML - Transacciones Banco de Loja
                        </h3>
                        <div
                            style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow-y: auto; height: 450px;">
                            <canvas id="xpathCanvas" style="display: block;"></canvas>
                        </div>
                        <div id="xpathInfo"
                            style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #60a5fa;">
                            Elementos resaltados: -</div>
                    </div>

                    <div
                        style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                        <div id="xpathSummary" style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                            XPath permite consultas precisas sobre documentos XML
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== XPATH INTERACTIVO =====
            const xmlDocument = `<?xml version="1.0" encoding="UTF-8"?>
<transacciones>
  <transaccion tipo="transferencia" banco="Pichincha">
    <id>TRX-001</id>
    <cliente><nombre>Mar√≠a S√°nchez</nombre></cliente>
    <monto>1500.00</monto>
    <fecha>2024-11-08</fecha>
  </transaccion>
  <transaccion tipo="pago" banco="Produbanco">
    <id>TRX-002</id>
    <cliente><nombre>Carlos Jim√©nez</nombre></cliente>
    <monto>450.00</monto>
    <fecha>2024-11-08</fecha>
  </transaccion>
  <transaccion tipo="transferencia" banco="Guayaquil">
    <id>TRX-003</id>
    <cliente><nombre>Ana Torres</nombre></cliente>
    <monto>2300.00</monto>
    <fecha>2024-11-09</fecha>
  </transaccion>
  <transaccion tipo="transferencia" banco="Pichincha">
    <id>TRX-004</id>
    <cliente><nombre>Luis Morales</nombre></cliente>
    <monto>800.00</monto>
    <fecha>2024-11-09</fecha>
  </transaccion>
</transacciones>`;

            document.addEventListener('DOMContentLoaded', function () {
                const executeBtn = document.getElementById('executeXPath');
                const selector = document.getElementById('xpathSelector');

                if (executeBtn) {
                    executeBtn.addEventListener('click', runXPathDemo);
                }

                if (selector) {
                    selector.addEventListener('change', runXPathDemo);
                }

                // Dibujar XML inicial
                setTimeout(() => drawXMLDocument(), 500);
            });

            function drawXMLDocument(highlightedLines = []) {
                const canvas = document.getElementById('xpathCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const lines = xmlDocument.split('\n');
                const lineHeight = 14;
                let y = 15;

                lines.forEach((line, i) => {
                    // Fondo para l√≠neas resaltadas
                    if (highlightedLines.includes(i)) {
                        ctx.fillStyle = 'rgba(74, 222, 128, 0.2)';
                        ctx.fillRect(0, y - 12, width, lineHeight);
                    }

                    // Texto
                    ctx.fillStyle = highlightedLines.includes(i) ? '#4ade80' : '#e2e8f0';
                    ctx.font = '9px monospace';
                    ctx.textAlign = 'left';
                    ctx.fillText(line, 10, y);

                    y += lineHeight;
                });
            }

            function runXPathDemo() {
                const selector = document.getElementById('xpathSelector').value;
                const resultDiv = document.getElementById('xpathResult');
                const infoDiv = document.getElementById('xpathInfo');
                const summaryDiv = document.getElementById('xpathSummary');

                let result = '';
                let highlightedLines = [];
                let count = 0;

                switch (selector) {
                    case '//transaccion':
                        result = 'Encontradas 4 transacciones:\n';
                        result += '‚Ä¢ TRX-001 (Mar√≠a S√°nchez)\n';
                        result += '‚Ä¢ TRX-002 (Carlos Jim√©nez)\n';
                        result += '‚Ä¢ TRX-003 (Ana Torres)\n';
                        result += '‚Ä¢ TRX-004 (Luis Morales)';
                        highlightedLines = [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23];
                        count = 4;
                        break;

                    case '//transaccion[@tipo=\'transferencia\']':
                        result = 'Encontradas 3 transferencias:\n';
                        result += '‚Ä¢ TRX-001 ‚Üí Pichincha ($1500)\n';
                        result += '‚Ä¢ TRX-003 ‚Üí Guayaquil ($2300)\n';
                        result += '‚Ä¢ TRX-004 ‚Üí Pichincha ($800)';
                        highlightedLines = [2, 3, 4, 5, 6, 7, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23];
                        count = 3;
                        break;

                    case '//transaccion[monto>1000]':
                        result = 'Encontradas 2 transacciones > $1000:\n';
                        result += '‚Ä¢ TRX-001: $1500.00\n';
                        result += '‚Ä¢ TRX-003: $2300.00\n';
                        result += '\n‚ö†Ô∏è Transacciones sospechosas para auditor√≠a';
                        highlightedLines = [2, 3, 4, 5, 6, 7, 13, 14, 15, 16, 17];
                        count = 2;
                        break;

                    case '//transaccion[@banco=\'Pichincha\']':
                        result = 'Encontradas 2 transacciones al Pichincha:\n';
                        result += '‚Ä¢ TRX-001: Mar√≠a S√°nchez ($1500)\n';
                        result += '‚Ä¢ TRX-004: Luis Morales ($800)';
                        highlightedLines = [2, 3, 4, 5, 6, 7, 19, 20, 21, 22, 23];
                        count = 2;
                        break;

                    case '//cliente/nombre':
                        result = 'Encontrados 4 nombres:\n';
                        result += '‚Ä¢ Mar√≠a S√°nchez\n';
                        result += '‚Ä¢ Carlos Jim√©nez\n';
                        result += '‚Ä¢ Ana Torres\n';
                        result += '‚Ä¢ Luis Morales';
                        highlightedLines = [4, 10, 15, 21];
                        count = 4;
                        break;

                    case '//transaccion/fecha':
                        result = 'Encontradas 4 fechas:\n';
                        result += '‚Ä¢ 2024-11-08 (2 transacciones)\n';
                        result += '‚Ä¢ 2024-11-09 (2 transacciones)';
                        highlightedLines = [6, 12, 17, 23];
                        count = 4;
                        break;
                }

                resultDiv.innerHTML = result.replace(/\n/g, '<br>');
                infoDiv.textContent = `‚úÖ ${count} elementos resaltados`;
                summaryDiv.innerHTML = `<i class="fas fa-search"></i> XPath: <strong>${selector}</strong> encontr√≥ ${count} resultado(s)`;

                drawXMLDocument(highlightedLines);
            }
        </script>

        <!-- Slide 14: XML Empresarial -->
        <div class="slide">
            <h2 style="margin-bottom: 0.8rem;"><i class="fas fa-building"></i> XML: SOAP y Sistemas Legacy</h2>

            <div
                style="display: grid; grid-template-columns: 40% 60%; gap: 20px; height: calc(100vh - 200px); max-height: 640px;">
                <!-- Columna Izquierda: Info -->
                <div style="display: flex; flex-direction: column; gap: 10px; height: 100%;">
                    <div class="quote" style="font-size: 0.8rem; padding: 10px; margin: 0;">
                        "Integraci√≥n con IESS y BCE mediante SOAP"
                    </div>

                    <div style="flex-shrink: 0;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 6px;">Casos de Uso Ecuador</h3>
                        <ul style="font-size: 0.8rem; line-height: 1.6; margin: 0; padding-left: 18px;">
                            <li>‚ñ† <strong>BCE</strong>: Tasas de inter√©s</li>
                            <li>üíº <strong>IESS</strong>: Verificaci√≥n aportes</li>
                            <li>‚ñä <strong>SRI</strong>: Facturas electr√≥nicas</li>
                            <li>üèõÔ∏è <strong>Superintendencia</strong>: Reportes</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(248, 113, 113, 0.1); padding: 8px; border-radius: 8px; border-left: 4px solid #f87171; flex-shrink: 0;">
                        <p style="font-size: 0.75rem; margin: 0;">
                            <i class="fas fa-exclamation-triangle"></i> Legacy pero obligatorio
                        </p>
                    </div>

                    <div
                        style="flex: 1; background: rgba(15, 20, 25, 0.6); border-radius: 8px; padding: 10px; overflow-y: auto;">
                        <h3 style="font-size: 0.9rem; margin-bottom: 8px; color: #60a5fa;">üìã REST vs SOAP</h3>
                        <table style="width: 100%; font-size: 0.75rem; color: #e2e8f0;">
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <td style="padding: 6px; font-weight: bold;">Formato</td>
                                <td style="padding: 6px;">JSON</td>
                                <td style="padding: 6px;">XML</td>
                            </tr>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <td style="padding: 6px; font-weight: bold;">Protocolo</td>
                                <td style="padding: 6px;">HTTP</td>
                                <td style="padding: 6px;">HTTP/SMTP</td>
                            </tr>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <td style="padding: 6px; font-weight: bold;">Contrato</td>
                                <td style="padding: 6px;">OpenAPI</td>
                                <td style="padding: 6px;">WSDL</td>
                            </tr>
                            <tr>
                                <td style="padding: 6px; font-weight: bold;">Uso</td>
                                <td style="padding: 6px; color: #4ade80;">Moderno</td>
                                <td style="padding: 6px; color: #f87171;">Legacy</td>
                            </tr>
                        </table>
                    </div>

                    <div style="text-align: center; margin-top: auto; flex-shrink: 0;">
                        <button id="startSoapDemo"
                            style="padding: 8px 12px; background: var(--uide-accent); color: #0f1419; border: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; width: 100%;">
                            <i class="fas fa-play"></i> Ver Flujo SOAP
                        </button>
                    </div>
                </div>

                <!-- Columna Derecha: Diagrama SOAP -->
                <div style="display: flex; flex-direction: column; gap: 12px; height: 100%;">
                    <div
                        style="background: rgba(15, 20, 25, 0.6); border-radius: 8px; border: 2px solid #fbbf24; padding: 10px; flex: 1; display: flex; flex-direction: column;">
                        <h3 style="text-align: center; color: #fbbf24; margin: 0 0 8px 0; font-size: 0.9rem;">
                            <i class="fas fa-sitemap"></i> Arquitectura SOAP - Consulta al IESS
                        </h3>
                        <div
                            style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 12px; overflow: hidden; height: 450px;">
                            <canvas id="soapCanvas" style="display: block;"></canvas>
                        </div>
                        <div id="soapInfo"
                            style="text-align: center; margin-top: 6px; font-size: 0.75rem; font-weight: 600; color: #fbbf24;">
                            Paso: -</div>
                    </div>

                    <div
                        style="text-align: center; padding: 8px; background: rgba(233, 171, 33, 0.1); border-radius: 6px; flex-shrink: 0;">
                        <div id="soapResult" style="font-size: 0.85rem; font-weight: 600; color: var(--uide-accent);">
                            SOAP/XML usado en integraciones gubernamentales obligatorias
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== SOAP DEMO =====
            document.addEventListener('DOMContentLoaded', function () {
                const startSoapBtn = document.getElementById('startSoapDemo');
                if (startSoapBtn) {
                    startSoapBtn.addEventListener('click', runSoapDemo);
                }
            });

            function runSoapDemo() {
                const canvas = document.getElementById('soapCanvas');
                if (!canvas) return;

                const { width, height } = getCanvasDimensions(canvas, 24);
                const ctx = setupHighDPICanvas(canvas, width, height);
                ctx.clearRect(0, 0, width, height);

                const steps = [
                    {
                        name: 'Banco de Loja',
                        desc: 'Cliente SOAP',
                        color: '#60a5fa',
                        x: 80,
                        y: 60
                    },
                    {
                        name: 'SOAP Request',
                        desc: 'XML Envelope',
                        color: '#fbbf24',
                        x: width / 2,
                        y: 140
                    },
                    {
                        name: 'WSDL Contract',
                        desc: 'Definici√≥n servicio',
                        color: '#a78bfa',
                        x: width / 2,
                        y: 220
                    },
                    {
                        name: 'IESS Server',
                        desc: 'Servicio Web',
                        color: '#f472b6',
                        x: width - 80,
                        y: 60
                    },
                    {
                        name: 'SOAP Response',
                        desc: 'Datos aportes',
                        color: '#4ade80',
                        x: width / 2,
                        y: 320
                    }
                ];

                let currentStep = 0;

                const interval = setInterval(() => {
                    if (currentStep >= steps.length) {
                        clearInterval(interval);

                        // Dibujar flechas finales
                        drawArrow(ctx, steps[0].x + 60, steps[0].y, steps[1].x - 60, steps[1].y, '#fbbf24');
                        drawArrow(ctx, steps[1].x, steps[1].y + 30, steps[2].x, steps[2].y - 30, '#a78bfa');
                        drawArrow(ctx, steps[2].x + 60, steps[2].y, steps[3].x - 60, steps[3].y + 40, '#f472b6');
                        drawArrow(ctx, steps[3].x - 60, steps[3].y + 60, steps[4].x + 60, steps[4].y - 30, '#4ade80');
                        drawArrow(ctx, steps[4].x - 60, steps[4].y, steps[0].x + 60, steps[0].y + 40, '#22c55e');

                        document.getElementById('soapInfo').textContent =
                            `‚úÖ Flujo completo | SOAP + WSDL + XML`;
                        document.getElementById('soapResult').innerHTML =
                            `<i class="fas fa-building"></i> SOAP es <strong>obligatorio</strong> para integraciones con entidades gubernamentales en Ecuador`;
                        return;
                    }

                    const step = steps[currentStep];

                    // Dibujar nodo
                    ctx.fillStyle = step.color;
                    ctx.beginPath();
                    ctx.roundRect(step.x - 70, step.y - 25, 140, 50, 10);
                    ctx.fill();

                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Nombre
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(step.name, step.x, step.y - 5);

                    // Descripci√≥n
                    ctx.font = '10px Arial';
                    ctx.fillText(step.desc, step.x, step.y + 12);

                    currentStep++;

                    document.getElementById('soapInfo').textContent =
                        `‚öôÔ∏è Paso ${currentStep}/${steps.length} | Construyendo flujo...`;
                }, 600);
            }
        </script>

        <!-- Slide 15: Comparaci√≥n -->
        <div class="slide">
            <h2><i class="fas fa-balance-scale"></i> Comparaci√≥n de Tecnolog√≠as</h2>
            <table>
                <thead>
                    <tr>
                        <th>Tecnolog√≠a</th>
                        <th>Velocidad</th>
                        <th>Tama√±o</th>
                        <th>Complejidad</th>
                        <th>Interoperabilidad</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>gRPC/Protobuf</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                    </tr>
                    <tr>
                        <td><strong>HTTP/2</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i></td>
                    </tr>
                    <tr>
                        <td><strong>WebSockets</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                    </tr>
                    <tr>
                        <td><strong>JSON</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                    </tr>
                    <tr>
                        <td><strong>XML</strong></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i></td>
                        <td><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Slide 16: Criterios de Selecci√≥n y Casos de Uso -->
        <div class="slide">
            <h2><i class="fas fa-check-circle"></i> Criterios de Selecci√≥n: Casos de Uso</h2>
            <div class="content-grid">
                <div class="feature-card">
                    <h3><i class="fas fa-server"></i> Microsservicios Internos</h3>
                    <p><strong>Recomendaci√≥n</strong>: gRPC + Protobuf</p>
                    <p><strong>Raz√≥n</strong>: M√°ximo rendimiento, latencia cr√≠tica, control de dependencias</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-globe"></i> APIs P√∫blicas</h3>
                    <p><strong>Recomendaci√≥n</strong>: JSON + HTTP/REST</p>
                    <p><strong>Raz√≥n</strong>: Simplicidad, adopci√≥n masiva, desarrollo √°gil</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-clock"></i> Tiempo Real</h3>
                    <p><strong>Recomendaci√≥n</strong>: WebSockets</p>
                    <p><strong>Raz√≥n</strong>: Conexi√≥n persistente bidireccional, streaming eficiente</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-building"></i> Integraci√≥n Empresarial</h3>
                    <p><strong>Recomendaci√≥n</strong>: XML</p>
                    <p><strong>Raz√≥n</strong>: Est√°ndares establecidos, herramientas maduras, interoperabilidad</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-cogs"></i> Sistemas en Evoluci√≥n</h3>
                    <p><strong>Recomendaci√≥n</strong>: Protobuf</p>
                    <p><strong>Raz√≥n</strong>: Versionado sin ruptura, evoluci√≥n r√°pida</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-balance-scale"></i> Balance Eficiencia/Simplicidad</h3>
                    <p><strong>Recomendaci√≥n</strong>: MessagePack</p>
                    <p><strong>Raz√≥n</strong>: M√°s eficiente que JSON, m√°s simple que Protobuf</p>
                </div>
            </div>
        </div>

        <!-- Slide 18: Actividades -->
        <div class="slide">
            <h2><i class="fas fa-clipboard-check"></i> Actividades Calificadas - Semana 3</h2>
            <div class="content-grid">
                <div class="feature-card">
                    <h3><i class="fas fa-poll"></i> Gesti√≥n de Aprendizaje</h3>
                    <p style="color: var(--uide-accent); font-weight: 600; margin-bottom: 1rem;">GA-1.1 (1%)</p>
                    <p><strong>Sondeo: ¬øcu√°ndo usar HTTP/2, WS, gRPC?</strong></p>
                    <p style="margin-top: 1rem; font-size: 0.95rem;">Evaluaci√≥n diagn√≥stica sobre criterios de selecci√≥n
                        de protocolos</p>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-flask"></i> Pr√°ctico Experimental</h3>
                    <p style="color: var(--uide-accent); font-weight: 600; margin-bottom: 1rem;">PE-1.3 (2.25%)</p>
                    <p><strong>Lab: Servicio Eco Multi-formato</strong></p>
                    <ul style="margin-top: 1rem; font-size: 0.95rem;">
                        <li>Servicio Node.js con JSON y Protobuf</li>
                        <li>Testing y comparaci√≥n de performance</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h3><i class="fas fa-file-alt"></i> Trabajo Aut√≥nomo</h3>
                    <p style="color: var(--uide-accent); font-weight: 600; margin-bottom: 1rem;">TA-1.3 (2.25%)</p>
                    <p><strong>Postman Collection + Script Cliente</strong></p>
                    <ul style="margin-top: 1rem; font-size: 0.95rem;">
                        <li>Colecci√≥n con tests automatizados</li>
                        <li>Script consumiendo API p√∫blica</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 19: S√≠ntesis y Reflexiones -->
        <div class="slide title-slide">
            <h1><i class="fas fa-lightbulb"></i> Arquitectura Banco de Loja: S√≠ntesis</h1>
            <div class="quote">
                "Sistema bancario moderno con integraci√≥n legacy - Un caso real ecuatoriano"
            </div>

            <div
                style="margin-top: 1.5rem; background: rgba(15, 20, 25, 0.6); border-radius: 12px; padding: 20px; border: 2px solid var(--uide-accent);">
                <h3 style="color: var(--uide-accent); margin-bottom: 1rem; text-align: center;">
                    <i class="fas fa-sitemap"></i> Stack Tecnol√≥gico Completo
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 1.5rem;">
                    <div
                        style="background: rgba(96, 165, 250, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #60a5fa;">
                        <h4 style="color: #60a5fa; margin-bottom: 8px; font-size: 0.95rem;">‚ñØ Capa de Presentaci√≥n</h4>
                        <p style="font-size: 0.85rem; margin: 0;">
                            <strong>HTTP/2 + JSON</strong><br>
                            App m√≥vil con multiplexaci√≥n<br>
                            <span style="color: #94a3b8;">Dashboard, transacciones, notificaciones</span>
                        </p>
                    </div>

                    <div
                        style="background: rgba(74, 222, 128, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #4ade80;">
                        <h4 style="color: #4ade80; margin-bottom: 8px; font-size: 0.95rem;">‚ö° Tiempo Real</h4>
                        <p style="font-size: 0.85rem; margin: 0;">
                            <strong>WebSockets</strong><br>
                            Notificaciones y soporte en vivo<br>
                            <span style="color: #94a3b8;">Alertas de transacciones, chat</span>
                        </p>
                    </div>

                    <div
                        style="background: rgba(34, 197, 94, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #22c55e;">
                        <h4 style="color: #22c55e; margin-bottom: 8px; font-size: 0.95rem;">‚ñ≤ Microsservicios</h4>
                        <p style="font-size: 0.85rem; margin: 0;">
                            <strong>gRPC + Protobuf</strong><br>
                            Comunicaci√≥n interna de alta velocidad<br>
                            <span style="color: #94a3b8;">Cuentas, transacciones, reportes</span>
                        </p>
                    </div>

                    <div
                        style="background: rgba(251, 191, 36, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #fbbf24;">
                        <h4 style="color: #fbbf24; margin-bottom: 8px; font-size: 0.95rem;">‚ñ£ Cache y Colas</h4>
                        <p style="font-size: 0.85rem; margin: 0;">
                            <strong>MessagePack + Redis</strong><br>
                            Sesiones y transacciones pendientes<br>
                            <span style="color: #94a3b8;">Autenticaci√≥n r√°pida, queues</span>
                        </p>
                    </div>
                </div>

                <div
                    style="background: rgba(248, 113, 113, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #f87171;">
                    <h4 style="color: #f87171; margin-bottom: 8px; font-size: 0.95rem;">üèõÔ∏è Integraciones Legacy</h4>
                    <p style="font-size: 0.85rem; margin: 0;">
                        <strong>SOAP + XML</strong><br>
                        SRI (facturas), IESS (aportes), BCE (tasas), Superintendencia (reportes)<br>
                        <span style="color: #94a3b8;">‚ö†Ô∏è Obligatorio por regulaci√≥n ecuatoriana</span>
                    </p>
                </div>
            </div>

            <div style="margin-top: 1.5rem; background: rgba(233, 171, 33, 0.1); padding: 15px; border-radius: 10px;">
                <h3 style="color: var(--uide-accent); margin-bottom: 10px; text-align: center;">
                    <i class="fas fa-check-circle"></i> Reglas de Oro
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.85rem;">
                    <div>‚úÖ HTTP/2 para app m√≥vil</div>
                    <div>‚úÖ WebSockets solo para notificaciones</div>
                    <div>‚úÖ gRPC entre microsservicios</div>
                    <div>‚úÖ JSON para APIs p√∫blicas</div>
                    <div>‚ö†Ô∏è XML/SOAP cuando sea obligatorio</div>
                    <div>‚ñ£ MessagePack para cache</div>
                </div>
            </div>

            <div style="margin-top: 1rem; text-align: center; font-style: italic; color: #e2e8f0; font-size: 0.95rem;">
                <i class="fas fa-graduation-cap"></i> Cada tecnolog√≠a tiene su lugar en una arquitectura moderna
            </div>
        </div>

        <!-- Slide 21: Referencias Bibliogr√°ficas -->
        <div class="slide">
            <h2><i class="fas fa-book"></i> Referencias Bibliogr√°ficas</h2>
            <div style="max-width: 1000px; margin: 0 auto;">
                <h3 style="margin-bottom: 1.5rem;">Bibliograf√≠a B√°sica</h3>
                <ul style="font-size: 1rem; line-height: 1.8; margin-bottom: 2rem;">
                    <li><strong>Beynon-Davies, P. (2018).</strong> <em>Sistemas de Bases de Datos</em>. Editorial
                        Revert√©. <a
                            href="https://www.proquest.com/books/sistemas-de-bases-datos/docview/2590135108/se-2"
                            style="color: var(--uide-accent);" target="_blank">Enlace</a></li>
                </ul>

                <h3 style="margin-bottom: 1.5rem;">Bibliograf√≠a Complementaria</h3>
                <ul style="font-size: 0.95rem; line-height: 1.7;">
                    <li><strong>Tanenbaum, A. S., & Van Steen, M. (2023).</strong> <em>Distributed Systems: Principles
                            and Paradigms</em> (3rd ed.). Pearson. <a
                            href="https://alex-nguyen.github.io/vinhtngu/CSCourses/Spring2020/CS5352/Distributed_Systems_3-200225.pdf"
                            style="color: var(--uide-accent);" target="_blank">Enlace</a></li>
                    <li><strong>Newman, S. (2021).</strong> <em>Building Microservices: Designing Fine-Grained
                            Systems</em> (2nd ed.). O'Reilly Media. <a
                            href="https://www.oreilly.com/library/view/building-microservices-2nd/9781492034018/"
                            style="color: var(--uide-accent);" target="_blank">Enlace</a></li>
                    <li><strong>Kleppmann, M. (2023).</strong> <em>Designing Data-Intensive Applications: The Big Ideas
                            Behind Reliable, Scalable, and Maintainable Systems</em> (2nd ed.). O'Reilly Media. <a
                            href="https://www.oreilly.com/library/view/designing-data-intensive-applications/9781098119058/"
                            style="color: var(--uide-accent);" target="_blank">Enlace</a></li>
                </ul>

                <h3 style="margin-bottom: 1.5rem; margin-top: 2rem;">Fuente ASU</h3>
                <ul style="font-size: 0.95rem; line-height: 1.7;">
                    <li><strong>Arizona State University. (2024).</strong> <em>CSE445 (Distributed Software
                            Development)</em>. Computer Science and Engineering Program. Online</li>
                    <li><strong>Arizona State University. (2024).</strong> <em>Master Class: A Practitioner's Guide to
                            Generative AI</em> - April 2024</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Navigation Controls -->
    <div class="nav-controls">
        <button class="nav-btn" id="prevBtn"><i class="fas fa-chevron-left"></i></button>
        <button class="nav-btn" id="nextBtn"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- Slide Counter -->
    <div class="slide-counter">
        <span id="currentSlide">1</span> / <span id="totalSlides">19</span>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar"></div>

    <!-- External JavaScript -->
    <script src="presentacion.js"></script>
</body>

</html>